///////////////////////////////////////////////////////////////////////////////
//                                                                            /
// IAR C/C++ Compiler V8.20.1.40829 for 8051            10/Jul/2014  13:44:11 /
// Copyright 2004-2012 IAR Systems AB.                                        /
//                                                                            /
//    Core               =  plain                                             /
//    Code model         =  banked                                            /
//    Data model         =  large                                             /
//    Calling convention =  xdata reentrant                                   /
//    Constant location  =  data_rom                                          /
//    Dptr setup         =  1,16                                              /
//                                                                            /
//    Source file        =  D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Component /
//                          s\hal\target\CC2540EB\hal_led.c                   /
//    Command line       =  -f D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabC /
//                          loud\NewEcoExec\codegenerator\Device\EcoBT\Projec /
//                          t\ble\CodeGenerator\CC2541DB\..\..\config\buildCo /
//                          mponents.cfg (-DBROADCASTER_CFG=0x01              /
//                          -DOBSERVER_CFG=0x02 -DPERIPHERAL_CFG=0x04         /
//                          -DCENTRAL_CFG=0x08 -DADV_NCONN_CFG=0x01           /
//                          -DADV_CONN_CFG=0x02 -DSCAN_CFG=0x04               /
//                          -DINIT_CFG=0x08 -DADV_CFG=ADV_NCONN_CFG+ADV_CONN_ /
//                          CFG -DLINK_CFG=ADV_CONN_CFG+INIT_CFG              /
//                          -DFULL_CFG=INIT_CFG+SCAN_CFG+ADV_NCONN_CFG+ADV_CO /
//                          NN_CFG) -f D:\NTHU\¬ã¨s\Important\ThesisCode\Code /
//                          \GitLabCloud\NewEcoExec\codegenerator\Device\EcoB /
//                          T\Project\ble\CodeGenerator\CC2541DB\buildConfig. /
//                          cfg (-DHOST_CONFIG=PERIPHERAL_CFG                 /
//                          -DGAP_PRIVACY_RECONNECT -DCC2541                  /
//                          -DOAD_IMAGE_VERSION=0x0000                        /
//                          "-DOAD_IMAGE_A_USER_ID='A', 'A', 'A', 'A'"        /
//                          "-DOAD_IMAGE_B_USER_ID='B', 'B', 'B', 'B'")       /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Component /
//                          s\hal\target\CC2540EB\hal_led.c -D                /
//                          INT_HEAP_LEN=900 -D HALNODEBUG -D                 /
//                          OSAL_CBTIMER_NUM_TASKS=1 -D HAL_AES_DMA=TRUE -D   /
//                          HAL_DMA=TRUE -D xPOWER_SAVING -D                  /
//                          xPLUS_BROADCASTER -D HAL_LCD=FALSE -D             /
//                          HAL_LED=TRUE -D HAL_ADC=TRUE -lB                  /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\CC2541\List\ -o         /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\CC2541\Obj\ -e --debug  /
//                          --core=plain --dptr=16,1 --data_model=large       /
//                          --code_model=banked --calling_convention=xdata_re /
//                          entrant --place_constants=data_rom                /
//                          --nr_virtual_regs 16 -I                           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\common\ -I        /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\include\ -I       /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\..\..\Components\ /
//                          hal\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCode /
//                          \Code\GitLabCloud\NewEcoExec\codegenerator\Device /
//                          \EcoBT\Project\ble\CodeGenerator\CC2541DB\..\..\. /
//                          .\..\Components\hal\target\CC2540EB\ -I           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\..\..\Components\ /
//                          osal\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCod /
//                          e\Code\GitLabCloud\NewEcoExec\codegenerator\Devic /
//                          e\EcoBT\Project\ble\CodeGenerator\CC2541DB\..\..\ /
//                          ..\..\Components\services\saddr\ -I               /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\..\..\Components\ /
//                          ble\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCode /
//                          \Code\GitLabCloud\NewEcoExec\codegenerator\Device /
//                          \EcoBT\Project\ble\CodeGenerator\CC2541DB\..\..\. /
//                          .\..\Components\ble\controller\phy\ -I            /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\..\..\Components\ /
//                          ble\controller\include\ -I                        /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\..\..\Components\ /
//                          ble\hci\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Cod /
//                          e\GitLabCloud\NewEcoExec\codegenerator\Device\Eco /
//                          BT\Project\ble\CodeGenerator\CC2541DB\..\..\..\.. /
//                          \Components\ble\host\ -I                          /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\common\cc2540\    /
//                          -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabC /
//                          loud\NewEcoExec\codegenerator\Device\EcoBT\Projec /
//                          t\ble\CodeGenerator\CC2541DB\..\..\common\npi\npi /
//                          _np\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\Gi /
//                          tLabCloud\NewEcoExec\codegenerator\Device\EcoBT\P /
//                          roject\ble\CodeGenerator\CC2541DB\..\..\Profiles\ /
//                          Roles\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\ /
//                          GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT /
//                          \Project\ble\CodeGenerator\CC2541DB\..\..\Profile /
//                          s\SimpleProfile\ -I D:\NTHU\¬ã¨s\Important\Thesis /
//                          Code\Code\GitLabCloud\NewEcoExec\codegenerator\De /
//                          vice\EcoBT\Project\ble\CodeGenerator\CC2541DB\..\ /
//                          ..\Profiles\DevInfo\ -I                           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\Profiles\Accelero /
//                          meter\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\ /
//                          GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT /
//                          \Project\ble\CodeGenerator\CC2541DB\..\..\Profile /
//                          s\EcoExecGATTProfile\ -I                          /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\..\..\Profiles\timeserv /
//                          ice\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\Gi /
//                          tLabCloud\NewEcoExec\codegenerator\Device\EcoBT\P /
//                          roject\ble\CodeGenerator\CC2541DB\..\..\Profiles\ /
//                          Batt\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\G /
//                          itLabCloud\NewEcoExec\codegenerator\Device\EcoBT\ /
//                          Project\ble\CodeGenerator\CC2541DB\..\..\Profiles /
//                          \HIDDev\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Cod /
//                          e\GitLabCloud\NewEcoExec\codegenerator\Device\Eco /
//                          BT\Project\ble\CodeGenerator\CC2541DB\..\..\Profi /
//                          les\ScanParam\ -Ohz                               /
//    List file          =  D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2541DB\CC2541\List\hal_led.s51 /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME hal_led

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)

        EXTERN ?ALLOC_XSTACK8
        EXTERN ?BANKED_ENTER_XDATA
        EXTERN ?BANKED_LEAVE_XDATA
        EXTERN ?BDISPATCH
        EXTERN ?BRET
        EXTERN ?DEALLOC_XSTACK8
        EXTERN ?L_ADD
        EXTERN ?L_MOV_X
        EXTERN ?L_MUL
        EXTERN ?PUSH_XSTACK_I_FOUR
        EXTERN ?UL_DIV_MOD
        EXTERN ?UL_GT
        EXTERN ?V0
        EXTERN ?XSP
        EXTERN ?XSTORE_R2345
        EXTERN __INIT_XDATA_Z

        PUBLIC ??HalLedBlink?relay
        PUBLIC ??HalLedEnterSleep?relay
        PUBLIC ??HalLedExitSleep?relay
        PUBLIC ??HalLedGetState?relay
        PUBLIC ??HalLedInit?relay
        PUBLIC ??HalLedOnOff?relay
        PUBLIC ??HalLedSet?relay
        PUBLIC ??HalLedUpdate?relay
        PUBLIC HalLedBlink
        PUBLIC HalLedEnterSleep
        PUBLIC HalLedExitSleep
        PUBLIC HalLedGetState
        PUBLIC HalLedInit
        PUBLIC HalLedOnOff
        PUBLIC HalLedSet
        PUBLIC HalLedUpdate
        PUBWEAK P2DIR
        PUBWEAK _A_P2
        PUBWEAK __Constant_64

osal_GetSystemClock SYMBOL "osal_GetSystemClock"
??osal_GetSystemClock?relay SYMBOL "?relay", osal_GetSystemClock
osal_set_event      SYMBOL "osal_set_event"
??osal_set_event?relay SYMBOL "?relay", osal_set_event
osal_start_timerEx  SYMBOL "osal_start_timerEx"
??osal_start_timerEx?relay SYMBOL "?relay", osal_start_timerEx
osal_stop_timerEx   SYMBOL "osal_stop_timerEx"
??osal_stop_timerEx?relay SYMBOL "?relay", osal_stop_timerEx
HalLedBlink         SYMBOL "HalLedBlink"
??HalLedBlink?relay SYMBOL "?relay", HalLedBlink
HalLedEnterSleep    SYMBOL "HalLedEnterSleep"
??HalLedEnterSleep?relay SYMBOL "?relay", HalLedEnterSleep
HalLedExitSleep     SYMBOL "HalLedExitSleep"
??HalLedExitSleep?relay SYMBOL "?relay", HalLedExitSleep
HalLedGetState      SYMBOL "HalLedGetState"
??HalLedGetState?relay SYMBOL "?relay", HalLedGetState
HalLedInit          SYMBOL "HalLedInit"
??HalLedInit?relay  SYMBOL "?relay", HalLedInit
HalLedOnOff         SYMBOL "HalLedOnOff"
??HalLedOnOff?relay SYMBOL "?relay", HalLedOnOff
HalLedSet           SYMBOL "HalLedSet"
??HalLedSet?relay   SYMBOL "?relay", HalLedSet
HalLedUpdate        SYMBOL "HalLedUpdate"
??HalLedUpdate?relay SYMBOL "?relay", HalLedUpdate

        EXTERN ??osal_GetSystemClock?relay
        EXTERN ??osal_set_event?relay
        EXTERN ??osal_start_timerEx?relay
        EXTERN ??osal_stop_timerEx?relay
        EXTERN Hal_TaskID
        EXTERN osal_GetSystemClock
        EXTERN osal_set_event
        EXTERN osal_start_timerEx
        EXTERN osal_stop_timerEx

// D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT\Components\hal\target\CC2540EB\hal_led.c
//    1 /**************************************************************************************************
//    2   Filename:       hal_led.c
//    3   Revised:        $Date: 2012-10-26 14:09:08 -0700 (Fri, 26 Oct 2012) $
//    4   Revision:       $Revision: 31932 $
//    5 
//    6   Description:    This file contains the interface to the HAL LED Service.
//    7 
//    8 
//    9   Copyright 2006-2012 Texas Instruments Incorporated. All rights reserved.
//   10 
//   11   IMPORTANT: Your use of this Software is limited to those specific rights
//   12   granted under the terms of a software license agreement between the user
//   13   who downloaded the software, his/her employer (which must be your employer)
//   14   and Texas Instruments Incorporated (the "License").  You may not use this
//   15   Software unless you agree to abide by the terms of the License. The License
//   16   limits your use, and you acknowledge, that the Software may not be modified,
//   17   copied or distributed unless embedded on a Texas Instruments microcontroller
//   18   or used solely and exclusively in conjunction with a Texas Instruments radio
//   19   frequency transceiver, which is integrated into your product.  Other than for
//   20   the foregoing purpose, you may not use, reproduce, copy, prepare derivative
//   21   works of, modify, distribute, perform, display or sell this Software and/or
//   22   its documentation for any purpose.
//   23 
//   24   YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
//   25   PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
//   26   INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
//   27   NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
//   28   TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
//   29   NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
//   30   LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
//   31   INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
//   32   OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
//   33   OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
//   34   (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
//   35 
//   36   Should you have any questions regarding your right to use this Software,
//   37   contact Texas Instruments Incorporated at www.TI.com.
//   38 **************************************************************************************************/
//   39 
//   40 /***************************************************************************************************
//   41  *                                             INCLUDES
//   42  ***************************************************************************************************/
//   43 
//   44 #include "hal_mcu.h"

        ASEGN SFR_AN:DATA:NOROOT,0a0H
// union <unnamed> volatile __sfr _A_P2
_A_P2:
        DATA8
        DS 1

        ASEGN SFR_AN:DATA:NOROOT,0ffH
// unsigned char volatile __sfr P2DIR
P2DIR:
        DATA8
        DS 1
//   45 #include "hal_defs.h"
//   46 #include "hal_types.h"
//   47 #include "hal_drivers.h"
//   48 #include "hal_led.h"
//   49 #include "osal.h"
//   50 #include "hal_board.h"
//   51 
//   52 /***************************************************************************************************
//   53  *                                              TYPEDEFS
//   54  ***************************************************************************************************/
//   55 
//   56 /* LED control structure */
//   57 typedef struct {
//   58   uint8 mode;       /* Operation mode */
//   59   uint8 left;       /* Blink cycles left */
//   60   uint8 onPct;      /* On cycle percentage */
//   61   uint16 time;      /* On/off cycle time (msec) */
//   62   uint32 next;      /* Time for next change */
//   63 } HalLedControl_t;
//   64 
//   65 typedef struct
//   66 {
//   67   HalLedControl_t HalLedControlTable[HAL_LED_DEFAULT_MAX_LEDS];
//   68   uint8           sleepActive;
//   69 } HalLedStatus_t;
//   70 
//   71 /***************************************************************************************************
//   72  *                                           GLOBAL VARIABLES
//   73  ***************************************************************************************************/
//   74 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   75 static uint8 HalLedState;              // LED state at last set/clr/blink update
HalLedState:
        DS 1
        REQUIRE __INIT_XDATA_Z
//   76 
//   77 #if HAL_LED == TRUE

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   78 static uint8 HalSleepLedState;         // LED state at last set/clr/blink update
HalSleepLedState:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   79 static uint8 preBlinkState;            // Original State before going to blink mode
preBlinkState:
        DS 1
        REQUIRE __INIT_XDATA_Z
//   80                                        // bit 0, 1, 2, 3 represent led 0, 1, 2, 3
//   81 #endif
//   82 
//   83 #ifdef BLINK_LEDS

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//   84   static HalLedStatus_t HalLedStatusControl;
HalLedStatusControl:
        DS 37
        REQUIRE __INIT_XDATA_Z
//   85 #endif
//   86 
//   87 /***************************************************************************************************
//   88  *                                            LOCAL FUNCTION
//   89  ***************************************************************************************************/
//   90 
//   91 #if (HAL_LED == TRUE)
//   92 void HalLedUpdate (void);
//   93 void HalLedOnOff (uint8 leds, uint8 mode);
//   94 #endif /* HAL_LED */
//   95 
//   96 /***************************************************************************************************
//   97  *                                            FUNCTIONS - API
//   98  ***************************************************************************************************/
//   99 
//  100 /***************************************************************************************************
//  101  * @fn      HalLedInit
//  102  *
//  103  * @brief   Initialize LED Service
//  104  *
//  105  * @param   init - pointer to void that contains the initialized value
//  106  *
//  107  * @return  None
//  108  ***************************************************************************************************/

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  109 void HalLedInit (void)
HalLedInit:
        CODE
//  110 {
        PUSH    DPL
        PUSH    DPH
        ; Saved register size: 2
        ; Auto size: 0
//  111 #if (HAL_LED == TRUE)
//  112   HalLedSet(HAL_LED_ALL, HAL_LED_MODE_OFF);  // Initialize all LEDs to OFF.
        ; Setup parameters for call to function HalLedSet
        MOV     R2,#0x0
        MOV     R1,#0xf
        LCALL   ??HalLedSet?relay
//  113 
//  114   // Set LED GPIOs to outputs.
//  115   LED1_DDR |= LED1_BV;
        ORL     0xff,#0x2
//  116 #if (!defined HAL_PA_LNA && !defined HAL_PA_LNA_CC2590)
//  117   LED2_DDR |= LED2_BV;
        ORL     0xff,#0x4
//  118 #if (!defined CC2540_MINIDK && !defined HAL_BOARD_CC2540USB)
//  119   LED3_DDR |= LED3_BV;
        ORL     0xff,#0x2
//  120 #endif
//  121 #endif
//  122 #if defined BLINK_LEDS
//  123   HalLedStatusControl.sleepActive = FALSE;  // Initialize sleepActive to FALSE.
        LJMP    ?Subroutine0 & 0xFFFF
        REQUIRE P2DIR
//  124 #endif
//  125 #endif
//  126 }
//  127 
//  128 /***************************************************************************************************
//  129  * @fn      HalLedSet
//  130  *
//  131  * @brief   Tun ON/OFF/TOGGLE given LEDs
//  132  *
//  133  * @param   led - bit mask value of leds to be turned ON/OFF/TOGGLE
//  134  *          mode - BLINK, FLASH, TOGGLE, ON, OFF
//  135  * @return  None
//  136  ***************************************************************************************************/

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  137 uint8 HalLedSet (uint8 leds, uint8 mode)
HalLedSet:
        CODE
//  138 {
        MOV     A,#-0xb
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 11
        ; Auto size: 0
        MOV     ?V0 + 0,R1
        MOV     ?V0 + 2,R2
//  139 
//  140 #if (defined (BLINK_LEDS)) && (HAL_LED == TRUE)
//  141   uint8 led;
//  142   HalLedControl_t *sts;
//  143 
//  144   switch (mode)
        MOV     A,R2
        JZ      ??HalLedSet_0
        DEC     A
        JZ      ??HalLedSet_0
        DEC     A
        JZ      ??HalLedSet_1
        ADD     A,#-0x2
        JZ      ??HalLedSet_2
        ADD     A,#-0x4
        JZ      ??HalLedSet_0
        SJMP    ??HalLedSet_3
//  145   {
//  146     case HAL_LED_MODE_BLINK:
//  147       /* Default blink, 1 time, D% duty cycle */
//  148       HalLedBlink (leds, 1, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME);
??HalLedSet_1:
        ; Setup parameters for call to function HalLedBlink
        MOV     R4,#-0x18
        MOV     R5,#0x3
        MOV     R3,#0x5
        MOV     R2,#0x1
??HalLedSet_4:
        LCALL   ??HalLedBlink?relay
//  149       break;
//  150 
//  151     case HAL_LED_MODE_FLASH:
//  152       /* Default flash, N times, D% duty cycle */
//  153       HalLedBlink (leds, HAL_LED_DEFAULT_FLASH_COUNT, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME);
//  154       break;
//  155 
//  156     case HAL_LED_MODE_ON:
//  157     case HAL_LED_MODE_OFF:
//  158     case HAL_LED_MODE_TOGGLE:
//  159 
//  160       led = HAL_LED_1;
//  161       leds &= HAL_LED_ALL;
//  162       sts = HalLedStatusControl.HalLedControlTable;
//  163 
//  164       while (leds)
//  165       {
//  166         if (leds & led)
//  167         {
//  168           if (mode != HAL_LED_MODE_TOGGLE)
//  169           {
//  170             sts->mode = mode;  /* ON or OFF */
//  171           }
//  172           else
//  173           {
//  174             sts->mode ^= HAL_LED_MODE_ON;  /* Toggle */
//  175           }
//  176           HalLedOnOff (led, sts->mode);
//  177           leds ^= led;
//  178         }
//  179         led <<= 1;
//  180         sts++;
//  181       }
//  182       break;
//  183 
//  184     default:
//  185       break;
//  186   }
//  187 
//  188 #elif (HAL_LED == TRUE)
//  189   LedOnOff(leds, mode);
//  190 #else
//  191   // HAL LED is disabled, suppress unused argument warnings
//  192   (void) leds;
//  193   (void) mode;
//  194 #endif /* BLINK_LEDS && HAL_LED   */
//  195 
//  196   return ( HalLedState );
??HalLedSet_3:
        MOV     DPTR,#HalLedState
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     R7,#0x3
        LJMP    ?BANKED_LEAVE_XDATA
??HalLedSet_2:
        ; Setup parameters for call to function HalLedBlink
        MOV     R4,#-0x18
        MOV     R5,#0x3
        MOV     R3,#0x5
        MOV     R2,#0x32
        SJMP    ??HalLedSet_4
??HalLedSet_0:
        MOV     ?V0 + 1,#0x1
        ANL     ?V0 + 0,#0xf
        MOV     R6,#HalLedStatusControl & 0xff
        MOV     R7,#(HalLedStatusControl >> 8) & 0xff
        SJMP    ??HalLedSet_5
??HalLedSet_6:
        MOVX    A,@DPTR
        XRL     A,#0x1
??HalLedSet_7:
        MOVX    @DPTR,A
        ; Setup parameters for call to function HalLedOnOff
        MOVX    A,@DPTR
        MOV     R2,A
        MOV     R1,?V0 + 1
        LCALL   ??HalLedOnOff?relay
        MOV     A,?V0 + 1
        XRL     ?V0 + 0,A
??HalLedSet_8:
        MOV     A,?V0 + 1
        CLR     C
        RLC     A
        MOV     ?V0 + 1,A
        MOV     A,R6
        ADD     A,#0x9
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
??HalLedSet_5:
        MOV     A,?V0 + 0
        JZ      ??HalLedSet_3
        ANL     A,?V0 + 1
        JZ      ??HalLedSet_8
        MOV     A,#0x8
        XRL     A,?V0 + 2
        MOV     DPL,R6
        MOV     DPH,R7
        JZ      ??HalLedSet_6
        MOV     A,?V0 + 2
        SJMP    ??HalLedSet_7
//  197 }
//  198 
//  199 /***************************************************************************************************
//  200  * @fn      HalLedBlink
//  201  *
//  202  * @brief   Blink the leds
//  203  *
//  204  * @param   leds       - bit mask value of leds to be blinked
//  205  *          numBlinks  - number of blinks
//  206  *          percent    - the percentage in each period where the led
//  207  *                       will be on
//  208  *          period     - length of each cycle in milliseconds
//  209  *
//  210  * @return  None
//  211  ***************************************************************************************************/

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  212 void HalLedBlink (uint8 leds, uint8 numBlinks, uint8 percent, uint16 period)
HalLedBlink:
        CODE
//  213 {
        MOV     A,#-0xe
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 14
        ; Auto size: 0
        MOV     ?V0 + 2,R1
        MOV     ?V0 + 3,R2
        MOV     ?V0 + 4,R3
        MOV     A,R4
        MOV     R6,A
        MOV     A,R5
        MOV     R7,A
//  214 #if (defined (BLINK_LEDS)) && (HAL_LED == TRUE)
//  215   uint8 led;
//  216   HalLedControl_t *sts;
//  217 
//  218   if (leds && percent && period)
        MOV     A,R1
        JNZ     $+5
        LJMP    ??HalLedBlink_0 & 0xFFFF
        MOV     A,R3
        JNZ     $+5
        LJMP    ??HalLedBlink_0 & 0xFFFF
        MOV     A,R6
        ORL     A,R7
        JNZ     $+5
        LJMP    ??HalLedBlink_0 & 0xFFFF
//  219   {
//  220     if (percent < 100)
        MOV     A,R3
        CLR     C
        SUBB    A,#0x64
        JC      $+5
        LJMP    ??HalLedBlink_1 & 0xFFFF
//  221     {
//  222       led = HAL_LED_1;
        MOV     ?V0 + 5,#0x1
//  223       leds &= HAL_LED_ALL;
        ANL     ?V0 + 2,#0xf
//  224       sts = HalLedStatusControl.HalLedControlTable;
        MOV     ?V0 + 0,#HalLedStatusControl & 0xff
        MOV     ?V0 + 1,#(HalLedStatusControl >> 8) & 0xff
        SJMP    ??HalLedBlink_2
//  225 
//  226       while (leds)
//  227       {
//  228         if (leds & led)
??HalLedBlink_3:
        ANL     A,?V0 + 5
        JZ      ??HalLedBlink_4
//  229         {
//  230           /* Store the current state of the led before going to blinking if not already blinking */
//  231           if(sts->mode < HAL_LED_MODE_BLINK )
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        CLR     C
        SUBB    A,#0x2
        JNC     ??HalLedBlink_5
//  232           	preBlinkState |= (led & HalLedState);
        MOV     DPTR,#HalLedState
        MOVX    A,@DPTR
        ANL     A,?V0 + 5
        MOV     R0,A
        MOV     DPTR,#preBlinkState
        MOVX    A,@DPTR
        ORL     A,R0
        MOVX    @DPTR,A
//  233 
//  234           sts->mode  = HAL_LED_MODE_OFF;                    /* Stop previous blink */
??HalLedBlink_5:
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        CLR     A
        MOVX    @DPTR,A
//  235           sts->time  = period;                              /* Time for one on/off cycle */
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOV     A,R6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R7
        LCALL   ?Subroutine1 & 0xFFFF
//  236           sts->onPct = percent;                             /* % of cycle LED is on */
??CrossCallReturnLabel_0:
        INC     DPTR
        MOV     A,?V0 + 4
        LCALL   ?Subroutine1 & 0xFFFF
//  237           sts->left  = numBlinks;                           /* Number of blink cycles */
??CrossCallReturnLabel_1:
        MOV     A,?V0 + 3
        MOVX    @DPTR,A
//  238           if (!numBlinks) sts->mode |= HAL_LED_MODE_FLASH;  /* Continuous */
        JNZ     ??HalLedBlink_6
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOV     A,#0x4
        MOVX    @DPTR,A
//  239           sts->next = osal_GetSystemClock();                /* Start now */
??HalLedBlink_6:
        ; Setup parameters for call to function osal_GetSystemClock
        LCALL   ??osal_GetSystemClock?relay
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        LCALL   ?XSTORE_R2345
//  240           sts->mode |= HAL_LED_MODE_BLINK;                  /* Enable blinking */
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        SETB    0xE0 /* A   */.1
        MOVX    @DPTR,A
//  241           leds ^= led;
        MOV     A,?V0 + 5
        XRL     ?V0 + 2,A
//  242         }
//  243         led <<= 1;
??HalLedBlink_4:
        MOV     A,?V0 + 5
        CLR     C
        RLC     A
        MOV     ?V0 + 5,A
//  244         sts++;
        MOV     A,?V0 + 0
        ADD     A,#0x9
        MOV     R0,A
        MOV     A,?V0 + 1
        ADDC    A,#0x0
        MOV     R1,A
        MOV     ?V0 + 0,R0
        MOV     ?V0 + 1,R1
//  245       }
??HalLedBlink_2:
        MOV     A,?V0 + 2
        JNZ     ??HalLedBlink_3
//  246       // Cancel any overlapping timer for blink events
//  247       osal_stop_timerEx(Hal_TaskID, HAL_LED_BLINK_EVENT);
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x20
        MOV     R3,#0x0
        MOV     DPTR,#Hal_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
//  248       osal_set_event (Hal_TaskID, HAL_LED_BLINK_EVENT);
        ; Setup parameters for call to function osal_set_event
        MOV     R2,#0x20
        MOV     R3,#0x0
        MOV     DPTR,#Hal_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_set_event?relay
        SJMP    ??HalLedBlink_7
//  249     }
//  250     else
//  251     {
//  252       HalLedSet (leds, HAL_LED_MODE_ON);                    /* >= 100%, turn on */
??HalLedBlink_1:
        ; Setup parameters for call to function HalLedSet
        MOV     R2,#0x1
        SJMP    ??HalLedBlink_8
//  253     }
//  254   }
//  255   else
//  256   {
//  257     HalLedSet (leds, HAL_LED_MODE_OFF);                     /* No on time, turn off */
??HalLedBlink_0:
        ; Setup parameters for call to function HalLedSet
        MOV     R2,#0x0
??HalLedBlink_8:
        LCALL   ??HalLedSet?relay
//  258   }
//  259 #elif (HAL_LED == TRUE)
//  260   percent = (leds & HalLedState) ? HAL_LED_MODE_OFF : HAL_LED_MODE_ON;
//  261   HalLedOnOff (leds, percent);                              /* Toggle */
//  262 #else
//  263   // HAL LED is disabled, suppress unused argument warnings
//  264   (void) leds;
//  265   (void) numBlinks;
//  266   (void) percent;
//  267   (void) period;
//  268 #endif /* BLINK_LEDS && HAL_LED */
//  269 }
??HalLedBlink_7:
        MOV     R7,#0x6
        LJMP    ?BANKED_LEAVE_XDATA

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine1:
        MOVX    @DPTR,A
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        RET
//  270 
//  271 #if (HAL_LED == TRUE)
//  272 /***************************************************************************************************
//  273  * @fn      HalLedUpdate
//  274  *
//  275  * @brief   Update leds to work with blink
//  276  *
//  277  * @param   none
//  278  *
//  279  * @return  none
//  280  ***************************************************************************************************/

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  281 void HalLedUpdate (void)
HalLedUpdate:
        CODE
//  282 {
        MOV     A,#-0x18
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 24
        ; Auto size: 1
        MOV     A,#-0x1
        LCALL   ?ALLOC_XSTACK8
//  283   uint8 led;
//  284   uint8 pct;
//  285   uint8 leds;
//  286   HalLedControl_t *sts;
//  287   uint32 time;
//  288   uint16 next;
//  289   uint16 wait;
//  290 
//  291   next = 0;
        MOV     ?V0 + 12,#0x0
        MOV     ?V0 + 13,#0x0
//  292   led  = HAL_LED_1;
        MOV     ?V0 + 14,#0x1
//  293   leds = HAL_LED_ALL;
        MOV     ?V0 + 15,#0xf
//  294   sts = HalLedStatusControl.HalLedControlTable;
        MOV     R6,#HalLedStatusControl & 0xff
        MOV     R7,#(HalLedStatusControl >> 8) & 0xff
//  295 
//  296   /* Check if sleep is active or not */
//  297   if (!HalLedStatusControl.sleepActive)
        MOV     DPTR,#HalLedStatusControl + 36
        MOVX    A,@DPTR
        JZ      $+5
        LJMP    ??HalLedUpdate_0 & 0xFFFF
//  298   {
//  299     while (leds)
//  300     {
//  301       if (leds & led)
??HalLedUpdate_1:
        MOV     A,?V0 + 15
        ANL     A,?V0 + 14
        JNZ     $+5
        LJMP    ??HalLedUpdate_2 & 0xFFFF
//  302       {
//  303         if (sts->mode & HAL_LED_MODE_BLINK)
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     C,0xE0 /* A   */.1
        JC      $+5
        LJMP    ??HalLedUpdate_3 & 0xFFFF
//  304         {
//  305           time = osal_GetSystemClock();
        ; Setup parameters for call to function osal_GetSystemClock
        LCALL   ??osal_GetSystemClock?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     ?V0 + 6,R4
        MOV     ?V0 + 7,R5
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOV     R0,#?V0 + 0
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 0
        MOV     R1,#?V0 + 4
        LCALL   ?UL_GT
        JNC     $+5
        LJMP    ??HalLedUpdate_4 & 0xFFFF
//  306           if (time >= sts->next)
//  307           {
//  308             if (sts->mode & HAL_LED_MODE_ON)
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     ?V0 + 0,DPL
        MOV     ?V0 + 1,DPH
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     C,0xE0 /* A   */.0
        JNC     ??HalLedUpdate_5
//  309             {
//  310               pct = 100 - sts->onPct;               /* Percentage of cycle for off */
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x64
        CLR     C
        SUBB    A,R0
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOVX    @DPTR,A
//  311               sts->mode &= ~HAL_LED_MODE_ON;        /* Say it's not on */
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        CLR     0xE0 /* A   */.0
        MOVX    @DPTR,A
//  312               HalLedOnOff (led, HAL_LED_MODE_OFF);  /* Turn it off */
        ; Setup parameters for call to function HalLedOnOff
        MOV     R2,#0x0
        MOV     R1,?V0 + 14
        LCALL   ??HalLedOnOff?relay
//  313 
//  314               if ( !(sts->mode & HAL_LED_MODE_FLASH) )
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     C,0xE0 /* A   */.2
        JC      ??HalLedUpdate_6
//  315               {
//  316                 sts->left--;                         // Not continuous, reduce count
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        DEC     A
        SJMP    ??HalLedUpdate_7
//  317               }
//  318             }
//  319             else if ( !(sts->left) && !(sts->mode & HAL_LED_MODE_FLASH) )
??HalLedUpdate_5:
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        JNZ     ??HalLedUpdate_8
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     C,0xE0 /* A   */.2
        JC      ??HalLedUpdate_8
//  320             {
//  321               sts->mode ^= HAL_LED_MODE_BLINK;       // No more blinks
        XRL     A,#0x2
??HalLedUpdate_7:
        MOVX    @DPTR,A
        SJMP    ??HalLedUpdate_6
//  322             }
//  323             else
//  324             {
//  325               pct = sts->onPct;                      // Percentage of cycle for on
??HalLedUpdate_8:
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOVX    @DPTR,A
//  326               sts->mode |= HAL_LED_MODE_ON;          // Say it's on
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        SETB    0xE0 /* A   */.0
        MOVX    @DPTR,A
//  327               HalLedOnOff( led, HAL_LED_MODE_ON );   // Turn it on
        ; Setup parameters for call to function HalLedOnOff
        MOV     R2,#0x1
        MOV     R1,?V0 + 14
        LCALL   ??HalLedOnOff?relay
//  328             }
//  329             if (sts->mode & HAL_LED_MODE_BLINK)
??HalLedUpdate_6:
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     C,0xE0 /* A   */.1
        JNC     ??HalLedUpdate_9
//  330             {
//  331               wait = (((uint32)pct * (uint32)sts->time) / 100);
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOVX    A,@DPTR
        MOV     ?V0 + 0,A
        CLR     A
        MOV     ?V0 + 1,A
        MOV     ?V0 + 2,A
        MOV     ?V0 + 3,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 8,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 9,A
        CLR     A
        MOV     ?V0 + 10,A
        MOV     ?V0 + 11,A
        MOV     R0,#?V0 + 0
        MOV     R1,#?V0 + 8
        LCALL   ?L_MUL
        MOV     DPTR,#__Constant_64
        MOV     R0,#?V0 + 8
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 0
        MOV     R1,#?V0 + 8
        LCALL   ?UL_DIV_MOD
//  332               sts->next = time + wait;
        MOV     ?V0 + 8,?V0 + 0
        MOV     ?V0 + 9,?V0 + 1
        CLR     A
        MOV     ?V0 + 10,A
        MOV     ?V0 + 11,A
        MOV     R0,#?V0 + 4
        MOV     R1,#?V0 + 8
        LCALL   ?L_ADD
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOV     A,?V0 + 4
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,?V0 + 5
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,?V0 + 6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,?V0 + 7
        SJMP    ??HalLedUpdate_10
//  333             }
//  334             else
//  335             {
//  336               /* no more blink, no more wait */
//  337               wait = 0;
??HalLedUpdate_9:
        MOV     ?V0 + 0,#0x0
        MOV     ?V0 + 1,#0x0
//  338               /* After blinking, set the LED back to the state before it blinks */
//  339               HalLedSet (led, ((preBlinkState & led)!=0)?HAL_LED_MODE_ON:HAL_LED_MODE_OFF);
        MOV     DPTR,#preBlinkState
        MOVX    A,@DPTR
        ANL     A,?V0 + 14
        JZ      ??HalLedUpdate_11
        MOV     R2,#0x1
        SJMP    ??HalLedUpdate_12
??HalLedUpdate_11:
        MOV     R2,#0x0
??HalLedUpdate_12:
        ; Setup parameters for call to function HalLedSet
        MOV     R1,?V0 + 14
        LCALL   ??HalLedSet?relay
//  340               /* Clear the saved bit */
//  341               preBlinkState &= (led ^ 0xFF);
        MOV     A,#-0x1
        XRL     A,?V0 + 14
        MOV     R0,A
        MOV     DPTR,#preBlinkState
        MOVX    A,@DPTR
        ANL     A,R0
??HalLedUpdate_10:
        MOVX    @DPTR,A
        SJMP    ??HalLedUpdate_13
//  342             }
//  343           }
//  344           else
//  345           {
//  346             wait = sts->next - time;  /* Time left */
??HalLedUpdate_4:
        MOV     A,?V0 + 0
        CLR     C
        SUBB    A,?V0 + 4
        MOV     ?V0 + 0,A
        MOV     A,?V0 + 1
        SUBB    A,?V0 + 5
        MOV     ?V0 + 1,A
//  347           }
//  348 
//  349           if (!next || ( wait && (wait < next) ))
??HalLedUpdate_13:
        MOV     A,?V0 + 12
        ORL     A,?V0 + 13
        JZ      ??HalLedUpdate_14
        MOV     A,?V0 + 0
        ORL     A,?V0 + 1
        JZ      ??HalLedUpdate_3
        CLR     C
        MOV     A,?V0 + 0
        SUBB    A,?V0 + 12
        MOV     A,?V0 + 1
        SUBB    A,?V0 + 13
        JNC     ??HalLedUpdate_3
//  350           {
//  351             next = wait;
??HalLedUpdate_14:
        MOV     ?V0 + 12,?V0 + 0
        MOV     ?V0 + 13,?V0 + 1
//  352           }
//  353         }
//  354         leds ^= led;
??HalLedUpdate_3:
        MOV     A,?V0 + 14
        XRL     ?V0 + 15,A
//  355       }
//  356       led <<= 1;
??HalLedUpdate_2:
        MOV     A,?V0 + 14
        CLR     C
        RLC     A
        MOV     ?V0 + 14,A
//  357       sts++;
        MOV     A,R6
        ADD     A,#0x9
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
//  358     }
        MOV     A,?V0 + 15
        JZ      $+5
        LJMP    ??HalLedUpdate_1 & 0xFFFF
//  359 
//  360     if (next)
        MOV     A,?V0 + 12
        ORL     A,?V0 + 13
        JZ      ??HalLedUpdate_0
//  361     {
//  362       osal_start_timerEx(Hal_TaskID, HAL_LED_BLINK_EVENT, next);   /* Schedule event */
        ; Setup parameters for call to function osal_start_timerEx
        CLR     A
        MOV     ?V0 + 14,A
        MOV     ?V0 + 15,A
        MOV     R0,#?V0 + 12
        LCALL   ?PUSH_XSTACK_I_FOUR
        MOV     R2,#0x20
        MOV     R3,#0x0
        MOV     DPTR,#Hal_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_timerEx?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
//  363     }
//  364   }
//  365 }
??HalLedUpdate_0:
        MOV     A,#0x1
        LCALL   ?DEALLOC_XSTACK8
        MOV     R7,#0x10
        LJMP    ?BANKED_LEAVE_XDATA
//  366 
//  367 /***************************************************************************************************
//  368  * @fn      HalLedOnOff
//  369  *
//  370  * @brief   Turns specified LED ON or OFF
//  371  *
//  372  * @param   leds - LED bit mask
//  373  *          mode - LED_ON,LED_OFF,
//  374  *
//  375  * @return  none
//  376  ***************************************************************************************************/

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  377 void HalLedOnOff (uint8 leds, uint8 mode)
HalLedOnOff:
        CODE
//  378 {
        PUSH    DPL
        PUSH    DPH
        ; Saved register size: 2
        ; Auto size: 0
//  379   if (leds & HAL_LED_1)
        MOV     A,R1
        MOV     C,0xE0 /* A   */.0
        JNC     ??HalLedOnOff_0
//  380   {
//  381     if (mode == HAL_LED_MODE_ON)
        MOV     A,#0x1
        XRL     A,R2
        JNZ     ??HalLedOnOff_1
//  382     {
//  383       HAL_TURN_ON_LED1();
        CLR     0xa0.1
        SJMP    ??HalLedOnOff_0
//  384     }
//  385     else
//  386     {
//  387       HAL_TURN_OFF_LED1();
??HalLedOnOff_1:
        SETB    0xa0.1
//  388     }
//  389   }
//  390 
//  391   if (leds & HAL_LED_2)
??HalLedOnOff_0:
        MOV     A,R1
        MOV     C,0xE0 /* A   */.1
        JNC     ??HalLedOnOff_2
//  392   {
//  393     if (mode == HAL_LED_MODE_ON)
        MOV     A,#0x1
        XRL     A,R2
        JNZ     ??HalLedOnOff_3
//  394     {
//  395       HAL_TURN_ON_LED2();
        CLR     0xa0.2
        SJMP    ??HalLedOnOff_2
//  396     }
//  397     else
//  398     {
//  399       HAL_TURN_OFF_LED2();
??HalLedOnOff_3:
        SETB    0xa0.2
//  400     }
//  401   }
//  402 
//  403   if (leds & HAL_LED_3)
??HalLedOnOff_2:
        MOV     A,R1
        MOV     C,0xE0 /* A   */.2
        JNC     ??HalLedOnOff_4
//  404   {
//  405     if (mode == HAL_LED_MODE_ON)
        MOV     A,#0x1
        XRL     A,R2
        JNZ     ??HalLedOnOff_5
//  406     {
//  407       HAL_TURN_ON_LED3();
        CLR     0xa0.1
        SJMP    ??HalLedOnOff_4
//  408     }
//  409     else
//  410     {
//  411       HAL_TURN_OFF_LED3();
??HalLedOnOff_5:
        SETB    0xa0.1
//  412     }
//  413   }
//  414 
//  415   if (leds & HAL_LED_4)
??HalLedOnOff_4:
        MOV     A,R1
        MOV     C,0xE0 /* A   */.3
        JNC     ??HalLedOnOff_6
//  416   {
//  417     if (mode == HAL_LED_MODE_ON)
        MOV     A,#0x1
        XRL     A,R2
        JNZ     ??HalLedOnOff_7
//  418     {
//  419       HAL_TURN_ON_LED4();
        CLR     0xa0.1
        SJMP    ??HalLedOnOff_8
//  420     }
//  421     else
//  422     {
//  423       HAL_TURN_OFF_LED4();
??HalLedOnOff_7:
        SETB    0xa0.1
//  424     }
//  425   }
//  426 
//  427   /* Remember current state */
//  428   if (mode)
??HalLedOnOff_6:
        MOV     A,R2
        JZ      ??HalLedOnOff_9
//  429   {
//  430     HalLedState |= leds;
??HalLedOnOff_8:
        MOV     DPTR,#HalLedState
        MOVX    A,@DPTR
        ORL     A,R1
        SJMP    ??HalLedOnOff_10
//  431   }
//  432   else
//  433   {
//  434     HalLedState &= (leds ^ 0xFF);
??HalLedOnOff_9:
        MOV     A,#-0x1
        XRL     A,R1
        MOV     R0,A
        MOV     DPTR,#HalLedState
        MOVX    A,@DPTR
        ANL     A,R0
//  435   }
??HalLedOnOff_10:
        SJMP    ??Subroutine2_0
        REQUIRE _A_P2
//  436 }

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine0:
        MOV     DPTR,#HalLedStatusControl + 36
        CLR     A
        REQUIRE ??Subroutine2_0
        ; // Fall through to label ??Subroutine2_0

        RSEG BANKED_CODE:CODE:NOROOT(0)
??Subroutine2_0:
        MOVX    @DPTR,A
        REQUIRE ??Subroutine3_0
        ; // Fall through to label ??Subroutine3_0

        RSEG BANKED_CODE:CODE:NOROOT(0)
??Subroutine3_0:
        POP     DPH
        POP     DPL
        LJMP    ?BRET
//  437 #endif /* HAL_LED */
//  438 
//  439 /***************************************************************************************************
//  440  * @fn      HalGetLedState
//  441  *
//  442  * @brief   Dim LED2 - Dim (set level) of LED2
//  443  *
//  444  * @param   none
//  445  *
//  446  * @return  led state
//  447  ***************************************************************************************************/

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  448 uint8 HalLedGetState ()
HalLedGetState:
        CODE
//  449 {
        PUSH    DPL
        PUSH    DPH
        ; Saved register size: 2
        ; Auto size: 0
//  450 #if (HAL_LED == TRUE)
//  451   return HalLedState;
        MOV     DPTR,#HalLedState
        MOVX    A,@DPTR
        MOV     R1,A
        SJMP    ??Subroutine3_0
//  452 #else
//  453   return 0;
//  454 #endif
//  455 }
//  456 
//  457 /***************************************************************************************************
//  458  * @fn      HalLedEnterSleep
//  459  *
//  460  * @brief   Store current LEDs state before sleep
//  461  *
//  462  * @param   none
//  463  *
//  464  * @return  none
//  465  ***************************************************************************************************/

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  466 void HalLedEnterSleep( void )
HalLedEnterSleep:
        CODE
//  467 {
        PUSH    DPL
        PUSH    DPH
        ; Saved register size: 2
        ; Auto size: 0
//  468 #ifdef BLINK_LEDS
//  469   /* Sleep ON */
//  470   HalLedStatusControl.sleepActive = TRUE;
        MOV     DPTR,#HalLedStatusControl + 36
        MOV     A,#0x1
        MOVX    @DPTR,A
//  471 #endif /* BLINK_LEDS */
//  472 
//  473 #if (HAL_LED == TRUE)
//  474   /* Save the state of each led */
//  475   HalSleepLedState = 0;
//  476   HalSleepLedState |= HAL_STATE_LED1();
        MOV     A,0xa0
        MOV     R3,A
//  477   HalSleepLedState |= HAL_STATE_LED2() << 1;
        MOV     A,0xa0
        MOV     R0,A
//  478   HalSleepLedState |= HAL_STATE_LED3() << 2;
        MOV     A,0xa0
        MOV     R1,A
//  479   HalSleepLedState |= HAL_STATE_LED4() << 3;
        MOV     C,0xa0.1
        CLR     A
        RLC     A
        RLC     A
        RLC     A
        RLC     A
        XRL     A,#0x8
        MOV     R2,A
        MOV     A,R1
        MOV     C,0xE0 /* A   */.1
        CLR     A
        RLC     A
        RLC     A
        RLC     A
        XRL     A,#0x4
        MOV     R1,A
        MOV     A,R0
        MOV     C,0xE0 /* A   */.2
        CLR     A
        RLC     A
        RLC     A
        XRL     A,#0x2
        MOV     R0,A
        SETB    B.0
        MOV     A,R3
        MOV     C,0xE0 /* A   */.1
        JNB     B.0,??HalLedEnterSleep_0
        CPL     C
??HalLedEnterSleep_0:
        CLR     A
        RLC     A
        ORL     A,R0
        ORL     A,R1
        ORL     A,R2
        MOV     DPTR,#HalSleepLedState
        MOVX    @DPTR,A
//  480 
//  481   /* TURN OFF all LEDs to save power */
//  482   HalLedOnOff (HAL_LED_ALL, HAL_LED_MODE_OFF);
        ; Setup parameters for call to function HalLedOnOff
        MOV     R2,#0x0
        MOV     R1,#0xf
        LCALL   ??HalLedOnOff?relay
//  483 #endif /* HAL_LED */
//  484 
//  485 }
        SJMP    ??Subroutine3_0
        REQUIRE _A_P2
//  486 
//  487 /***************************************************************************************************
//  488  * @fn      HalLedExitSleep
//  489  *
//  490  * @brief   Restore current LEDs state after sleep
//  491  *
//  492  * @param   none
//  493  *
//  494  * @return  none
//  495  ***************************************************************************************************/

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  496 void HalLedExitSleep( void )
HalLedExitSleep:
        CODE
//  497 {
        PUSH    DPL
        PUSH    DPH
        ; Saved register size: 2
        ; Auto size: 0
//  498 #if (HAL_LED == TRUE)
//  499   /* Load back the saved state */
//  500   HalLedOnOff(HalSleepLedState, HAL_LED_MODE_ON);
        ; Setup parameters for call to function HalLedOnOff
        MOV     R2,#0x1
        MOV     DPTR,#HalSleepLedState
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??HalLedOnOff?relay
//  501 
//  502   /* Restart - This takes care BLINKING LEDS */
//  503   HalLedUpdate();
        ; Setup parameters for call to function HalLedUpdate
        LCALL   ??HalLedUpdate?relay
//  504 #endif /* HAL_LED */
//  505 
//  506 #ifdef BLINK_LEDS
//  507   /* Sleep OFF */
//  508   HalLedStatusControl.sleepActive = FALSE;
        SJMP    ?Subroutine0
//  509 #endif /* BLINK_LEDS */
//  510 }

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_64:
        DD 100

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??HalLedInit?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    HalLedInit

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??HalLedSet?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    HalLedSet

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??HalLedBlink?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    HalLedBlink

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??HalLedUpdate?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    HalLedUpdate

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??HalLedOnOff?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    HalLedOnOff

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??HalLedGetState?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    HalLedGetState

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??HalLedEnterSleep?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    HalLedEnterSleep

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??HalLedExitSleep?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    HalLedExitSleep

        END
//  511 
//  512 /***************************************************************************************************
//  513 ***************************************************************************************************/
//  514 
//  515 
//  516 
//  517 
// 
// 1 050 bytes in segment BANKED_CODE
//    48 bytes in segment BANK_RELAYS
//     2 bytes in segment SFR_AN
//     4 bytes in segment XDATA_ROM_C
//    40 bytes in segment XDATA_Z
// 
// 1 098 bytes of CODE  memory
//     0 bytes of CONST memory (+ 4 bytes shared)
//     0 bytes of DATA  memory (+ 2 bytes shared)
//    40 bytes of XDATA memory
//
//Errors: none
//Warnings: none
