///////////////////////////////////////////////////////////////////////////////
//                                                                            /
// IAR C/C++ Compiler V8.20.1.40829 for 8051            18/Jun/2014  16:46:23 /
// Copyright 2004-2012 IAR Systems AB.                                        /
//                                                                            /
//    Core               =  plain                                             /
//    Code model         =  banked                                            /
//    Data model         =  large                                             /
//    Calling convention =  xdata reentrant                                   /
//    Constant location  =  data_rom                                          /
//    Dptr setup         =  1,16                                              /
//                                                                            /
//    Source file        =  D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Component /
//                          s\osal\common\OSAL_ClockBLE.c                     /
//    Command line       =  -f D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabC /
//                          loud\NewEcoExec\codegenerator\Device\EcoBT\Projec /
//                          t\ble\CodeGenerator\CC2540DB\..\..\config\buildCo /
//                          mponents.cfg (-DBROADCASTER_CFG=0x01              /
//                          -DOBSERVER_CFG=0x02 -DPERIPHERAL_CFG=0x04         /
//                          -DCENTRAL_CFG=0x08 -DADV_NCONN_CFG=0x01           /
//                          -DADV_CONN_CFG=0x02 -DSCAN_CFG=0x04               /
//                          -DINIT_CFG=0x08 -DADV_CFG=ADV_NCONN_CFG+ADV_CONN_ /
//                          CFG -DLINK_CFG=ADV_CONN_CFG+INIT_CFG              /
//                          -DFULL_CFG=INIT_CFG+SCAN_CFG+ADV_NCONN_CFG+ADV_CO /
//                          NN_CFG) -f D:\NTHU\¬ã¨s\Important\ThesisCode\Code /
//                          \GitLabCloud\NewEcoExec\codegenerator\Device\EcoB /
//                          T\Project\ble\CodeGenerator\CC2540DB\buildConfig. /
//                          cfg (-DHOST_CONFIG=PERIPHERAL_CFG                 /
//                          -DGAP_PRIVACY_RECONNECT)                          /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Component /
//                          s\osal\common\OSAL_ClockBLE.c -D                  /
//                          INT_HEAP_LEN=900 -D HALNODEBUG -D                 /
//                          OSAL_CBTIMER_NUM_TASKS=1 -D HAL_AES_DMA=TRUE -D   /
//                          HAL_DMA=TRUE -D xPOWER_SAVING -D                  /
//                          xPLUS_BROADCASTER -D HAL_LCD=FALSE -D             /
//                          HAL_LED=TRUE -D HAL_ADC=TRUE -lB                  /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\CC2540\List\ -o         /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\CC2540\Obj\ -e --debug  /
//                          --core=plain --dptr=16,1 --data_model=large       /
//                          --code_model=banked --calling_convention=xdata_re /
//                          entrant --place_constants=data_rom                /
//                          --nr_virtual_regs 16 -I                           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\common\ -I        /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\include\ -I       /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          hal\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCode /
//                          \Code\GitLabCloud\NewEcoExec\codegenerator\Device /
//                          \EcoBT\Project\ble\CodeGenerator\CC2540DB\..\..\. /
//                          .\..\Components\hal\target\CC2540EB\ -I           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          osal\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCod /
//                          e\Code\GitLabCloud\NewEcoExec\codegenerator\Devic /
//                          e\EcoBT\Project\ble\CodeGenerator\CC2540DB\..\..\ /
//                          ..\..\Components\services\saddr\ -I               /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          ble\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCode /
//                          \Code\GitLabCloud\NewEcoExec\codegenerator\Device /
//                          \EcoBT\Project\ble\CodeGenerator\CC2540DB\..\..\. /
//                          .\..\Components\ble\controller\phy\ -I            /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          ble\controller\include\ -I                        /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          ble\hci\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Cod /
//                          e\GitLabCloud\NewEcoExec\codegenerator\Device\Eco /
//                          BT\Project\ble\CodeGenerator\CC2540DB\..\..\..\.. /
//                          \Components\ble\host\ -I                          /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\common\cc2540\    /
//                          -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabC /
//                          loud\NewEcoExec\codegenerator\Device\EcoBT\Projec /
//                          t\ble\CodeGenerator\CC2540DB\..\..\common\npi\npi /
//                          _np\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\Gi /
//                          tLabCloud\NewEcoExec\codegenerator\Device\EcoBT\P /
//                          roject\ble\CodeGenerator\CC2540DB\..\..\Profiles\ /
//                          Roles\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\ /
//                          GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT /
//                          \Project\ble\CodeGenerator\CC2540DB\..\..\Profile /
//                          s\SimpleProfile\ -I D:\NTHU\¬ã¨s\Important\Thesis /
//                          Code\Code\GitLabCloud\NewEcoExec\codegenerator\De /
//                          vice\EcoBT\Project\ble\CodeGenerator\CC2540DB\..\ /
//                          ..\Profiles\DevInfo\ -I                           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\Profiles\Accelero /
//                          meter\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\ /
//                          GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT /
//                          \Project\ble\CodeGenerator\CC2540DB\..\..\Profile /
//                          s\EcoExecGATTProfile\ -I                          /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\Profiles\Batt\    /
//                          -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabC /
//                          loud\NewEcoExec\codegenerator\Device\EcoBT\Projec /
//                          t\ble\CodeGenerator\CC2540DB\..\..\Profiles\HIDDe /
//                          v\ -Ohz                                           /
//    List file          =  D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\CC2540\List\OSAL_ClockB /
//                          LE.s51                                            /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME OSAL_ClockBLE

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)

        EXTERN ?ALLOC_XSTACK8
        EXTERN ?BANKED_ENTER_XDATA
        EXTERN ?BANKED_LEAVE_XDATA
        EXTERN ?BDISPATCH
        EXTERN ?BRET
        EXTERN ?DEALLOC_XSTACK8
        EXTERN ?L_ADD
        EXTERN ?L_ADD_TO_X
        EXTERN ?L_MOV_TO_X
        EXTERN ?L_MOV_X
        EXTERN ?L_MUL
        EXTERN ?UL_DIV_MOD
        EXTERN ?US_DIV_MOD
        EXTERN ?US_SHR
        EXTERN ?V0
        EXTERN ?XLOAD_R2345
        EXTERN ?XSP
        EXTERN ?XSTACK_DISP0_8
        EXTERN __INIT_XDATA_Z

        PUBLIC ??osalTimeUpdate?relay
        PUBLIC ??osal_ConvertUTCSecs?relay
        PUBLIC ??osal_ConvertUTCTime?relay
        PUBLIC ??osal_getClock?relay
        PUBLIC ??osal_setClock?relay
        PUBLIC OSAL_timeSeconds
        PUBWEAK __Constant_15180
        PUBWEAK __Constant_3c
        PUBWEAK __Constant_e10
        PUBLIC osalTimeUpdate
        PUBLIC osal_ConvertUTCSecs
        PUBLIC osal_ConvertUTCTime
        PUBLIC osal_getClock
        PUBLIC osal_setClock

ll_McuPrecisionCount SYMBOL "ll_McuPrecisionCount"
??ll_McuPrecisionCount?relay SYMBOL "?relay", ll_McuPrecisionCount
osalTimerUpdate     SYMBOL "osalTimerUpdate"
??osalTimerUpdate?relay SYMBOL "?relay", osalTimerUpdate
osalTimeUpdate      SYMBOL "osalTimeUpdate"
??osalTimeUpdate?relay SYMBOL "?relay", osalTimeUpdate
osal_ConvertUTCSecs SYMBOL "osal_ConvertUTCSecs"
??osal_ConvertUTCSecs?relay SYMBOL "?relay", osal_ConvertUTCSecs
osal_ConvertUTCTime SYMBOL "osal_ConvertUTCTime"
??osal_ConvertUTCTime?relay SYMBOL "?relay", osal_ConvertUTCTime
osal_getClock       SYMBOL "osal_getClock"
??osal_getClock?relay SYMBOL "?relay", osal_getClock
osal_setClock       SYMBOL "osal_setClock"
??osal_setClock?relay SYMBOL "?relay", osal_setClock

        EXTERN ??ll_McuPrecisionCount?relay
        EXTERN ??osalTimerUpdate?relay
        EXTERN ll_McuPrecisionCount
        EXTERN osalTimerUpdate

// D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT\Components\osal\common\OSAL_ClockBLE.c
//    1 /**************************************************************************************************
//    2   Filename:       OSAL_ClockBLE.c
//    3   Revised:        $Date: 2008-12-15 15:42:47 -0800 (Mon, 15 Dec 2008) $
//    4   Revision:       $Revision: 18616 $
//    5 
//    6   Description:    OSAL Clock definition and manipulation functions for BLE projects.
//    7 
//    8   Copyright 2008-2011 Texas Instruments Incorporated. All rights reserved.
//    9 
//   10   IMPORTANT: Your use of this Software is limited to those specific rights
//   11   granted under the terms of a software license agreement between the user
//   12   who downloaded the software, his/her employer (which must be your employer)
//   13   and Texas Instruments Incorporated (the "License"). You may not use this
//   14   Software unless you agree to abide by the terms of the License. The License
//   15   limits your use, and you acknowledge, that the Software may not be modified,
//   16   copied or distributed unless embedded on a Texas Instruments microcontroller
//   17   or used solely and exclusively in conjunction with a Texas Instruments radio
//   18   frequency transceiver, which is integrated into your product. Other than for
//   19   the foregoing purpose, you may not use, reproduce, copy, prepare derivative
//   20   works of, modify, distribute, perform, display or sell this Software and/or
//   21   its documentation for any purpose.
//   22 
//   23   YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
//   24   PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
//   25   INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
//   26   NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
//   27   TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
//   28   NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
//   29   LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
//   30   INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
//   31   OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
//   32   OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
//   33   (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
//   34 
//   35   Should you have any questions regarding your right to use this Software,
//   36   contact Texas Instruments Incorporated at www.TI.com.
//   37 **************************************************************************************************/
//   38 
//   39 /*********************************************************************
//   40  * INCLUDES
//   41  */
//   42 
//   43 #include "comdef.h"
//   44 #include "OnBoard.h"
//   45 #include "OSAL.h"
//   46 #include "OSAL_Clock.h"
//   47 
//   48 /*********************************************************************
//   49  * MACROS
//   50  */
//   51 
//   52 #define	YearLength(yr)	(IsLeapYear(yr) ? 366 : 365)
//   53 
//   54 /*********************************************************************
//   55  * CONSTANTS
//   56  */
//   57 
//   58 // (MAXCALCTICKS * 5) + (max remainder) must be <= (uint16 max),
//   59 // so: (13105 * 5) + 7 <= 65535
//   60 #define MAXCALCTICKS  ((uint16)(13105))
//   61 
//   62 #define	BEGYEAR	        2000     // UTC started at 00:00:00 January 1, 2000
//   63 
//   64 #define	DAY             86400UL  // 24 hours * 60 minutes * 60 seconds
//   65 
//   66 /*********************************************************************
//   67  * TYPEDEFS
//   68  */
//   69 
//   70 /*********************************************************************
//   71  * GLOBAL VARIABLES
//   72  */
//   73 
//   74 /*********************************************************************
//   75  * EXTERNAL VARIABLES
//   76  */
//   77 
//   78 /*********************************************************************
//   79  * EXTERNAL FUNCTIONS
//   80  */
//   81 extern uint16 ll_McuPrecisionCount(void);
//   82 
//   83 /*********************************************************************
//   84  * LOCAL VARIABLES
//   85  */

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//   86 static uint16 previousLLTimerTick = 0;
previousLLTimerTick:
        DS 2
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//   87 static uint16 remUsTicks = 0;
remUsTicks:
        DS 2
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//   88 static uint16 timeMSec = 0;
timeMSec:
        DS 2
        REQUIRE __INIT_XDATA_Z
//   89 
//   90 // number of seconds since 0 hrs, 0 minutes, 0 seconds, on the
//   91 // 1st of January 2000 UTC

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA32
//   92 UTCTime OSAL_timeSeconds = 0;
OSAL_timeSeconds:
        DS 4
        REQUIRE __INIT_XDATA_Z
//   93 
//   94 /*********************************************************************
//   95  * LOCAL FUNCTION PROTOTYPES
//   96  */
//   97 static uint8 monthLength( uint8 lpyr, uint8 mon );
//   98 
//   99 static void osalClockUpdate( uint16 elapsedMSec );
//  100 
//  101 /*********************************************************************
//  102  * FUNCTIONS
//  103  *********************************************************************/
//  104 
//  105 /*********************************************************************
//  106  * @fn      osalTimeUpdate
//  107  *
//  108  * @brief   Uses the free running rollover count of the MAC backoff timer;
//  109  *          this timer runs freely with a constant 320 usec interval.  The
//  110  *          count of 320-usec ticks is converted to msecs and used to update
//  111  *          the OSAL clock and Timers by invoking osalClockUpdate() and
//  112  *          osalTimerUpdate().  This function is intended to be invoked
//  113  *          from the background, not interrupt level.
//  114  *
//  115  * @param   None.
//  116  *
//  117  * @return  None.
//  118  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  119 void osalTimeUpdate( void )
osalTimeUpdate:
        CODE
//  120 {
        MOV     A,#-0xe
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 14
        ; Auto size: 0
//  121   uint16 tmp;
//  122   uint16 ticks625us;
//  123   uint16 elapsedMSec = 0;
        MOV     ?V0 + 4,#0x0
        MOV     ?V0 + 5,#0x0
//  124 
//  125   // Get the free-running count of 625us timer ticks
//  126   tmp = ll_McuPrecisionCount();
        ; Setup parameters for call to function ll_McuPrecisionCount
        LCALL   ??ll_McuPrecisionCount?relay
//  127 
//  128   if ( tmp != previousLLTimerTick )
        MOV     DPTR,#previousLLTimerTick
        MOVX    A,@DPTR
        XRL     A,R2
        JNZ     ??osalTimeUpdate_0
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,R3
??osalTimeUpdate_0:
        JNZ     $+5
        LJMP    ??osalTimeUpdate_1 & 0xFFFF
//  129   {
//  130     // Calculate the elapsed ticks of the free-running timer.
//  131     ticks625us = tmp - previousLLTimerTick;
        MOV     DPTR,#previousLLTimerTick
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     A,R2
        CLR     C
        SUBB    A,R0
        MOV     R0,A
        MOV     A,R3
        SUBB    A,R1
        MOV     R1,A
//  132 
//  133     // Store the LL Timer tick count for the next time through this function.
//  134     previousLLTimerTick = tmp;
        MOV     DPTR,#previousLLTimerTick
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
        SJMP    ??osalTimeUpdate_2
//  135 
//  136     /* It is necessary to loop to convert the usecs to msecs in increments so as
//  137      * not to overflow the 16-bit variables.
//  138      */
//  139     while ( ticks625us > MAXCALCTICKS )
//  140     {
//  141       ticks625us -= MAXCALCTICKS;
??osalTimeUpdate_3:
        ADD     A,#-0x31
        MOV     R0,A
        MOV     A,R1
        ADDC    A,#-0x34
        MOV     R1,A
//  142       elapsedMSec += MAXCALCTICKS * 5 / 8;
        MOV     A,?V0 + 4
        ADD     A,#-0x2
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 5
        ADDC    A,#0x1f
        MOV     ?V0 + 5,A
//  143       remUsTicks += MAXCALCTICKS * 5 % 8;
        MOV     DPTR,#remUsTicks
        MOVX    A,@DPTR
        ADD     A,#0x5
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
??osalTimeUpdate_2:
        MOVX    @DPTR,A
//  144     }
        CLR     C
        MOV     A,R0
        SUBB    A,#0x32
        MOV     A,R1
        SUBB    A,#0x33
        MOV     A,R0
        JNC     ??osalTimeUpdate_3
//  145 
//  146     // update converted number with remaining ticks from loop and the
//  147     // accumulated remainder from loop
//  148     tmp = (ticks625us * 5) + remUsTicks;
        MOV     B,#0x5
        MUL     AB
        MOV     R0,A
        MOV     R2,B
        MOV     B,#0x5
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     DPTR,#remUsTicks
        MOVX    A,@DPTR
        ADD     A,R0
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,R1
        MOV     R3,A
//  149 
//  150     // Convert the 625 us ticks into milliseconds and a remainder
//  151     elapsedMSec += tmp / 8;
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
        MOV     A,#0x3
        MOV     R0,#?V0 + 0
        LCALL   ?US_SHR
        MOV     A,?V0 + 4
        ADD     A,?V0 + 0
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 5
        ADDC    A,?V0 + 1
        MOV     ?V0 + 5,A
//  152     remUsTicks = tmp % 8;
        MOV     A,R2
        ANL     A,#0x7
        MOV     DPTR,#remUsTicks
        MOVX    @DPTR,A
        INC     DPTR
        CLR     A
        MOVX    @DPTR,A
//  153 
//  154     // Update OSAL Clock and Timers
//  155     if ( elapsedMSec )
        MOV     A,?V0 + 4
        ORL     A,?V0 + 5
        JZ      ??osalTimeUpdate_1
//  156     {
//  157       osalClockUpdate( elapsedMSec );
        MOV     DPTR,#timeMSec
        MOVX    A,@DPTR
        ADD     A,?V0 + 4
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,?V0 + 5
        MOVX    @DPTR,A
        MOV     DPTR,#timeMSec
        CLR     C
        MOVX    A,@DPTR
        SUBB    A,#-0x18
        INC     DPTR
        MOVX    A,@DPTR
        SUBB    A,#0x3
        JC      ??osalTimeUpdate_4
        LCALL   ?Subroutine3 & 0xFFFF
??CrossCallReturnLabel_4:
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 0,R0
        MOV     ?V0 + 1,R1
        CLR     A
        MOV     ?V0 + 2,A
        MOV     ?V0 + 3,A
        MOV     DPTR,#OSAL_timeSeconds
        MOV     R0,#?V0 + 0
        LCALL   ?L_ADD_TO_X
        LCALL   ?Subroutine3 & 0xFFFF
??CrossCallReturnLabel_5:
        LCALL   ?US_DIV_MOD
        MOV     DPTR,#timeMSec
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
        MOVX    @DPTR,A
//  158       osalTimerUpdate( elapsedMSec );
??osalTimeUpdate_4:
        ; Setup parameters for call to function osalTimerUpdate
        MOV     R2,?V0 + 4
        MOV     R3,?V0 + 5
        CLR     A
        MOV     R4,A
        MOV     R5,A
        LCALL   ??osalTimerUpdate?relay
//  159     }
//  160   }
//  161 }
??osalTimeUpdate_1:
        MOV     R7,#0x6
        LJMP    ?BANKED_LEAVE_XDATA

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine3:
        MOV     DPTR,#timeMSec
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     R2,#-0x18
        MOV     R3,#0x3
        RET
//  162 
//  163 /*********************************************************************
//  164  * @fn      osalClockUpdate
//  165  *
//  166  * @brief   Updates the OSAL Clock time with elapsed milliseconds.
//  167  *
//  168  * @param   elapsedMSec - elapsed milliseconds
//  169  *
//  170  * @return  none
//  171  */
//  172 static void osalClockUpdate( uint16 elapsedMSec )
//  173 {
//  174   // Add elapsed milliseconds to the saved millisecond portion of time
//  175   timeMSec += elapsedMSec;
//  176 
//  177   // Roll up milliseconds to the number of seconds
//  178   if ( timeMSec >= 1000 )
//  179   {
//  180     OSAL_timeSeconds += timeMSec / 1000;
//  181     timeMSec = timeMSec % 1000;
//  182   }
//  183 }
//  184 
//  185 /*********************************************************************
//  186  * @fn      osal_setClock
//  187  *
//  188  * @brief   Set the new time.  This will only set the seconds portion
//  189  *          of time and doesn't change the factional second counter.
//  190  *
//  191  * @param   newTime - number of seconds since 0 hrs, 0 minutes,
//  192  *                    0 seconds, on the 1st of January 2000 UTC
//  193  *
//  194  * @return  none
//  195  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  196 void osal_setClock( UTCTime newTime )
osal_setClock:
        CODE
//  197 {
        MOV     A,#-0xc
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 12
        ; Auto size: 0
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
        MOV     ?V0 + 2,R4
        MOV     ?V0 + 3,R5
//  198   OSAL_timeSeconds = newTime;
        MOV     DPTR,#OSAL_timeSeconds
        MOV     R0,#?V0 + 0
        LCALL   ?L_MOV_TO_X
//  199 }
        MOV     R7,#0x4
        LJMP    ?BANKED_LEAVE_XDATA
//  200 
//  201 /*********************************************************************
//  202  * @fn      osal_getClock
//  203  *
//  204  * @brief   Gets the current time.  This will only return the seconds
//  205  *          portion of time and doesn't include the factional second
//  206  *          counter.
//  207  *
//  208  * @param   none
//  209  *
//  210  * @return  number of seconds since 0 hrs, 0 minutes, 0 seconds,
//  211  *          on the 1st of January 2000 UTC
//  212  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  213 UTCTime osal_getClock( void )
osal_getClock:
        CODE
//  214 {
        PUSH    DPL
        PUSH    DPH
        ; Saved register size: 2
        ; Auto size: 0
//  215   return ( OSAL_timeSeconds );
        MOV     DPTR,#OSAL_timeSeconds
        LCALL   ?XLOAD_R2345
        POP     DPH
        POP     DPL
        LJMP    ?BRET
//  216 }
//  217 
//  218 /*********************************************************************
//  219  * @fn      osal_ConvertUTCTime
//  220  *
//  221  * @brief   Converts UTCTime to UTCTimeStruct
//  222  *
//  223  * @param   tm - pointer to breakdown struct
//  224  *
//  225  * @param   secTime - number of seconds since 0 hrs, 0 minutes,
//  226  *          0 seconds, on the 1st of January 2000 UTC
//  227  *
//  228  * @return  none
//  229  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  230 void osal_ConvertUTCTime( UTCTimeStruct *tm, UTCTime secTime )
osal_ConvertUTCTime:
        CODE
//  231 {
        MOV     A,#-0x18
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 24
        ; Auto size: 2
        MOV     A,#-0x2
        LCALL   ?ALLOC_XSTACK8
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
        MOVX    @DPTR,A
        MOV     A,#0x1a
        LCALL   ?XSTACK_DISP0_8
        MOV     R0,#?V0 + 4
        LCALL   ?L_MOV_X
//  232   // calculate the time less than a day - hours, minutes, seconds
//  233   {
//  234     uint32 day = secTime % DAY;
        MOV     ?V0 + 0,?V0 + 4
        MOV     ?V0 + 1,?V0 + 5
        MOV     ?V0 + 2,?V0 + 6
        MOV     ?V0 + 3,?V0 + 7
        MOV     DPTR,#__Constant_15180
        MOV     R0,#?V0 + 8
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 0
        MOV     R1,#?V0 + 8
        LCALL   ?UL_DIV_MOD
//  235     tm->seconds = day % 60UL;
        MOV     ?V0 + 12,?V0 + 8
        MOV     ?V0 + 13,?V0 + 9
        MOV     ?V0 + 14,?V0 + 10
        MOV     ?V0 + 15,?V0 + 11
        MOV     DPTR,#__Constant_3c
        MOV     R0,#?V0 + 0
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 12
        MOV     R1,#?V0 + 0
        LCALL   ?UL_DIV_MOD
        LCALL   ?Subroutine4 & 0xFFFF
??CrossCallReturnLabel_6:
        MOV     A,?V0 + 0
        MOVX    @DPTR,A
//  236     tm->minutes = (day % 3600UL) / 60UL;
        MOV     ?V0 + 12,?V0 + 8
        MOV     ?V0 + 13,?V0 + 9
        MOV     ?V0 + 14,?V0 + 10
        MOV     ?V0 + 15,?V0 + 11
        MOV     DPTR,#__Constant_e10
        MOV     R0,#?V0 + 0
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 12
        MOV     R1,#?V0 + 0
        LCALL   ?UL_DIV_MOD
        MOV     DPTR,#__Constant_3c
        MOV     R0,#?V0 + 12
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 0
        MOV     R1,#?V0 + 12
        LCALL   ?UL_DIV_MOD
        LCALL   ?Subroutine4 & 0xFFFF
??CrossCallReturnLabel_7:
        INC     DPTR
        MOV     A,?V0 + 0
        MOVX    @DPTR,A
//  237     tm->hour = day / 3600UL;
        MOV     DPTR,#__Constant_e10
        MOV     R0,#?V0 + 0
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 8
        MOV     R1,#?V0 + 0
        LCALL   ?UL_DIV_MOD
        LCALL   ?Subroutine2 & 0xFFFF
//  238   }
??CrossCallReturnLabel_2:
        MOV     A,?V0 + 8
        MOVX    @DPTR,A
//  239 
//  240   // Fill in the calendar - day, month, year
//  241   {
//  242     uint16 numDays = secTime / DAY;
        MOV     DPTR,#__Constant_15180
        MOV     R0,#?V0 + 0
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 4
        MOV     R1,#?V0 + 0
        LCALL   ?UL_DIV_MOD
        MOV     R6,?V0 + 4
        MOV     R7,?V0 + 5
//  243     tm->year = BEGYEAR;
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOVX    A,@DPTR
        ADD     A,#0x5
        MOV     ?V0 + 0,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     ?V0 + 1,A
        MOV     DPL,?V0 + 0
        MOV     DPH,A
        MOV     A,#-0x30
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,#0x7
        SJMP    ??osal_ConvertUTCTime_0
//  244     while ( numDays >= YearLength( tm->year ) )
//  245     {
//  246       numDays -= YearLength( tm->year );
??osal_ConvertUTCTime_1:
        MOV     R0,#0x6d
??osal_ConvertUTCTime_2:
        CLR     C
        MOV     A,R6
        SUBB    A,R0
        MOV     R6,A
        MOV     A,R7
        SUBB    A,#0x1
        MOV     R7,A
//  247       tm->year++;
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        ADD     A,#0x1
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
??osal_ConvertUTCTime_0:
        LCALL   ?Subroutine0 & 0xFFFF
??CrossCallReturnLabel_10:
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
        MOV     A,R2
        ORL     A,?V0 + 3
        JZ      ??osal_ConvertUTCTime_3
        MOV     A,R4
        MOV     R0,A
        MOV     A,R5
        MOV     R1,A
        MOV     R2,#0x64
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 5,R3
        MOV     A,R2
        ORL     A,?V0 + 5
        JZ      ??osal_ConvertUTCTime_4
        MOV     A,R4
        ANL     A,#0x3
        JNZ     ??osal_ConvertUTCTime_4
??osal_ConvertUTCTime_3:
        MOV     R0,#0x6e
        SJMP    ??osal_ConvertUTCTime_5
??osal_ConvertUTCTime_4:
        MOV     R0,#0x6d
??osal_ConvertUTCTime_5:
        MOV     A,R6
        SUBB    A,R0
        MOV     A,R7
        SUBB    A,#0x1
        JC      ??osal_ConvertUTCTime_6
        MOV     A,?V0 + 2
        ORL     A,?V0 + 3
        JZ      ??osal_ConvertUTCTime_7
        MOV     A,R4
        MOV     R0,A
        MOV     A,R5
        MOV     R1,A
        MOV     R2,#0x64
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 3,R3
        MOV     A,R2
        ORL     A,?V0 + 3
        JZ      ??osal_ConvertUTCTime_1
        MOV     A,R4
        ANL     A,#0x3
        JNZ     ??osal_ConvertUTCTime_1
??osal_ConvertUTCTime_7:
        MOV     R0,#0x6e
        SJMP    ??osal_ConvertUTCTime_2
//  248     }
//  249 
//  250     tm->month = 0;
??osal_ConvertUTCTime_6:
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOVX    A,@DPTR
        ADD     A,#0x4
        MOV     ?V0 + 2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     ?V0 + 3,A
        MOV     DPL,?V0 + 2
        MOV     DPH,A
        CLR     A
        SJMP    ??osal_ConvertUTCTime_8
//  251     while ( numDays >= monthLength( IsLeapYear( tm->year ), tm->month ) )
//  252     {
//  253       numDays -= monthLength( IsLeapYear( tm->year ), tm->month );
??osal_ConvertUTCTime_9:
        MOV     R1,#0x0
??osal_ConvertUTCTime_10:
        ; Setup parameters for call to function monthLength
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        MOV     R2,A
        LCALL   ??monthLength?relay
        MOV     A,R1
        MOV     R0,A
        CLR     C
        MOV     A,R6
        SUBB    A,R0
        MOV     R6,A
        MOV     A,R7
        SUBB    A,#0x0
        MOV     R7,A
//  254       tm->month++;
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        INC     A
??osal_ConvertUTCTime_8:
        LCALL   ?Subroutine0 & 0xFFFF
??CrossCallReturnLabel_11:
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 5,R3
        MOV     A,R2
        ORL     A,?V0 + 5
        JZ      ??osal_ConvertUTCTime_11
        MOV     A,R4
        MOV     R0,A
        MOV     A,R5
        MOV     R1,A
        MOV     R2,#0x64
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 5,R3
        MOV     A,R2
        ORL     A,?V0 + 5
        JZ      ??osal_ConvertUTCTime_12
        MOV     A,R4
        ANL     A,#0x3
        JNZ     ??osal_ConvertUTCTime_12
??osal_ConvertUTCTime_11:
        MOV     R1,#0x1
        SJMP    ??osal_ConvertUTCTime_13
??osal_ConvertUTCTime_12:
        MOV     R1,#0x0
??osal_ConvertUTCTime_13:
        ; Setup parameters for call to function monthLength
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        MOV     R2,A
        LCALL   ??monthLength?relay
        MOV     A,R1
        MOV     R0,A
        CLR     C
        MOV     A,R6
        SUBB    A,R0
        MOV     A,R7
        SUBB    A,#0x0
        JC      ??osal_ConvertUTCTime_14
        LCALL   ??Subroutine6_0 & 0xFFFF
//  255     }
??CrossCallReturnLabel_12:
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 5,R3
        MOV     A,R2
        ORL     A,?V0 + 5
        JZ      ??osal_ConvertUTCTime_15
        MOV     A,R4
        MOV     R0,A
        MOV     A,R5
        MOV     R1,A
        MOV     R2,#0x64
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 5,R3
        MOV     A,R2
        ORL     A,?V0 + 5
        JZ      ??osal_ConvertUTCTime_9
        MOV     A,R4
        ANL     A,#0x3
        JZ      $+5
        LJMP    ??osal_ConvertUTCTime_9 & 0xFFFF
??osal_ConvertUTCTime_15:
        MOV     R1,#0x1
        LJMP    ??osal_ConvertUTCTime_10 & 0xFFFF
//  256 
//  257     tm->day = numDays;
??osal_ConvertUTCTime_14:
        LCALL   ?Subroutine2 & 0xFFFF
//  258   }
??CrossCallReturnLabel_3:
        INC     DPTR
        MOV     A,R6
        MOVX    @DPTR,A
//  259 }
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        MOV     R7,#0x10
        LJMP    ?BANKED_LEAVE_XDATA

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine4:
        LCALL   ?Subroutine5 & 0xFFFF
??CrossCallReturnLabel_9:
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine5:
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine2:
        LCALL   ?Subroutine5 & 0xFFFF
??CrossCallReturnLabel_8:
        INC     DPTR
        INC     DPTR
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine0:
        MOVX    @DPTR,A
        REQUIRE ??Subroutine6_0
        ; // Fall through to label ??Subroutine6_0

        RSEG BANKED_CODE:CODE:NOROOT(0)
??Subroutine6_0:
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R5,A
        MOV     A,R4
        MOV     R0,A
        MOV     A,R5
        MOV     R1,A
        MOV     R2,#-0x70
        MOV     R3,#0x1
        RET
//  260 
//  261 /*********************************************************************
//  262  * @fn      monthLength
//  263  *
//  264  * @param   lpyr - 1 for leap year, 0 if not
//  265  *
//  266  * @param   mon - 0 - 11 (jan - dec)
//  267  *
//  268  * @return  number of days in specified month
//  269  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  270 static uint8 monthLength( uint8 lpyr, uint8 mon )
monthLength:
        CODE
//  271 {
        ; Saved register size: 0
        ; Auto size: 0
        MOV     A,R1
        MOV     R0,A
//  272   uint8 days = 31;
        MOV     R1,#0x1f
//  273 
//  274   if ( mon == 1 ) // feb
        MOV     A,#0x1
        XRL     A,R2
        JNZ     ??monthLength_0
//  275   {
//  276     days = ( 28 + lpyr );
        MOV     A,#0x1c
        ADD     A,R0
        MOV     R1,A
        SJMP    ??monthLength_1
//  277   }
//  278   else
//  279   {
//  280     if ( mon > 6 ) // aug-dec
??monthLength_0:
        MOV     A,R2
        CLR     C
        SUBB    A,#0x7
        JC      ??monthLength_2
//  281     {
//  282       mon--;
        DEC     R2
//  283     }
//  284 
//  285     if ( mon & 1 )
??monthLength_2:
        MOV     A,R2
        MOV     C,0xE0 /* A   */.0
        JNC     ??monthLength_1
//  286     {
//  287       days = 30;
        DEC     R1
//  288     }
//  289   }
//  290 
//  291   return ( days );
??monthLength_1:
        LJMP    ?BRET
//  292 }
//  293 
//  294 /*********************************************************************
//  295  * @fn      osal_ConvertUTCSecs
//  296  *
//  297  * @brief   Converts a UTCTimeStruct to UTCTime
//  298  *
//  299  * @param   tm - pointer to provided struct
//  300  *
//  301  * @return  number of seconds since 00:00:00 on 01/01/2000 (UTC)
//  302  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  303 UTCTime osal_ConvertUTCSecs( UTCTimeStruct *tm )
osal_ConvertUTCSecs:
        CODE
//  304 {
        MOV     A,#-0x14
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 20
        ; Auto size: 0
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
//  305   uint32 seconds;
//  306 
//  307   /* Seconds for the partial day */
//  308   seconds = (((tm->hour * 60UL) + tm->minutes) * 60UL) + tm->seconds;
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        CLR     A
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     DPTR,#__Constant_3c
        MOV     R0,#?V0 + 0
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 4
        MOV     R1,#?V0 + 0
        LCALL   ?L_MUL
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        LCALL   ?Subroutine1 & 0xFFFF
??CrossCallReturnLabel_0:
        LCALL   ?L_ADD
        MOV     DPTR,#__Constant_3c
        MOV     R0,#?V0 + 0
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 4
        MOV     R1,#?V0 + 0
        LCALL   ?L_MUL
        MOV     DPL,R6
        MOV     DPH,R7
        LCALL   ?Subroutine1 & 0xFFFF
??CrossCallReturnLabel_1:
        LCALL   ?L_ADD
//  309 
//  310   /* Account for previous complete days */
//  311   {
//  312     /* Start with complete days in current month */
//  313     uint16 days = tm->day;
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 0,A
//  314 
//  315     /* Next, complete months in current year */
//  316     {
//  317       int8 month = tm->month;
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 8,A
        SJMP    ??osal_ConvertUTCSecs_0
//  318       while ( --month >= 0 )
//  319       {
//  320         days += monthLength( IsLeapYear( tm->year ), month );
??osal_ConvertUTCSecs_1:
        MOV     R1,#0x0
??osal_ConvertUTCSecs_2:
        ; Setup parameters for call to function monthLength
        MOV     R2,?V0 + 8
        LCALL   ??monthLength?relay
        MOV     A,R1
        MOV     R0,A
        MOV     A,?V0 + 0
        ADD     A,R0
        MOV     ?V0 + 0,A
        MOV     A,?V0 + 1
        ADDC    A,#0x0
        MOV     ?V0 + 1,A
??osal_ConvertUTCSecs_0:
        DEC     ?V0 + 8
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 3,A
        MOV     A,?V0 + 8
        CLR     C
        SUBB    A,#0x0
        MOV     C,0xD0 /* PSW */.2
        XRL     A,PSW
        RLC     A
        JC      ??osal_ConvertUTCSecs_3
        MOV     R0,?V0 + 2
        MOV     R1,?V0 + 3
        MOV     R2,#-0x70
        MOV     R3,#0x1
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 11,R3
        MOV     A,R2
        ORL     A,?V0 + 11
        JZ      ??osal_ConvertUTCSecs_4
        MOV     R0,?V0 + 2
        MOV     R1,?V0 + 3
        MOV     R2,#0x64
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 11,R3
        MOV     A,R2
        ORL     A,?V0 + 11
        JZ      ??osal_ConvertUTCSecs_1
        MOV     A,?V0 + 2
        ANL     A,#0x3
        JNZ     ??osal_ConvertUTCSecs_1
??osal_ConvertUTCSecs_4:
        MOV     R1,#0x1
        SJMP    ??osal_ConvertUTCSecs_2
//  321       }
//  322     }
//  323 
//  324     /* Next, complete years before current year */
//  325     {
//  326       uint16 year = tm->year;
??osal_ConvertUTCSecs_3:
        MOV     R4,?V0 + 2
        MOV     R5,?V0 + 3
        SJMP    ??osal_ConvertUTCSecs_5
//  327       while ( --year >= BEGYEAR )
//  328       {
//  329         days += YearLength( year );
??osal_ConvertUTCSecs_6:
        MOV     R0,#0x6d
??osal_ConvertUTCSecs_7:
        MOV     A,?V0 + 0
        ADD     A,R0
        MOV     ?V0 + 0,A
        MOV     A,?V0 + 1
        ADDC    A,#0x1
        MOV     ?V0 + 1,A
??osal_ConvertUTCSecs_5:
        MOV     A,R4
        ADD     A,#-0x1
        DEC     R4
        MOV     A,R5
        ADDC    A,#-0x1
        MOV     R5,A
        CLR     C
        MOV     A,R4
        SUBB    A,#-0x30
        MOV     A,R5
        SUBB    A,#0x7
        JC      ??osal_ConvertUTCSecs_8
        MOV     A,R4
        MOV     R0,A
        MOV     A,R5
        MOV     R1,A
        MOV     R2,#-0x70
        MOV     R3,#0x1
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 3,R3
        MOV     A,R2
        ORL     A,?V0 + 3
        JZ      ??osal_ConvertUTCSecs_9
        MOV     A,R4
        MOV     R0,A
        MOV     A,R5
        MOV     R1,A
        MOV     R2,#0x64
        MOV     R3,#0x0
        LCALL   ?US_DIV_MOD
        MOV     ?V0 + 3,R3
        MOV     A,R2
        ORL     A,?V0 + 3
        JZ      ??osal_ConvertUTCSecs_6
        MOV     A,R4
        ANL     A,#0x3
        JNZ     ??osal_ConvertUTCSecs_6
??osal_ConvertUTCSecs_9:
        MOV     R0,#0x6e
        SJMP    ??osal_ConvertUTCSecs_7
//  330       }
//  331     }
//  332 
//  333     /* Add total seconds before partial day */
//  334     seconds += (days * DAY);
//  335   }
//  336 
//  337   return ( seconds );
??osal_ConvertUTCSecs_8:
        CLR     A
        MOV     ?V0 + 2,A
        MOV     ?V0 + 3,A
        MOV     DPTR,#__Constant_15180
        MOV     R0,#?V0 + 8
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 0
        MOV     R1,#?V0 + 8
        LCALL   ?L_MUL
        MOV     R0,#?V0 + 4
        MOV     R1,#?V0 + 0
        LCALL   ?L_ADD
        MOV     R2,?V0 + 4
        MOV     R3,?V0 + 5
        MOV     R4,?V0 + 6
        MOV     R5,?V0 + 7
        MOV     R7,#0xc
        LJMP    ?BANKED_LEAVE_XDATA
//  338 }

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine1:
        MOVX    A,@DPTR
        MOV     ?V0 + 0,A
        CLR     A
        MOV     ?V0 + 1,A
        MOV     ?V0 + 2,A
        MOV     ?V0 + 3,A
        MOV     R0,#?V0 + 4
        MOV     R1,#?V0 + 0
        RET

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_15180:
        DD 86400

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_3c:
        DD 60

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_e10:
        DD 3600

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??osalTimeUpdate?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    osalTimeUpdate

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??osal_setClock?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    osal_setClock

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??osal_getClock?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    osal_getClock

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??osal_ConvertUTCTime?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    osal_ConvertUTCTime

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??monthLength?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    monthLength

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??osal_ConvertUTCSecs?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    osal_ConvertUTCSecs

        END
// 
// 1 191 bytes in segment BANKED_CODE
//    36 bytes in segment BANK_RELAYS
//    12 bytes in segment XDATA_ROM_C
//    10 bytes in segment XDATA_Z
// 
// 1 227 bytes of CODE  memory
//     0 bytes of CONST memory (+ 12 bytes shared)
//    10 bytes of XDATA memory
//
//Errors: none
//Warnings: none
