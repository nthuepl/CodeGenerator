///////////////////////////////////////////////////////////////////////////////
//                                                                            /
// IAR C/C++ Compiler V8.20.1.40829 for 8051            23/May/2014  20:10:32 /
// Copyright 2004-2012 IAR Systems AB.                                        /
//                                                                            /
//    Core               =  plain                                             /
//    Code model         =  banked                                            /
//    Data model         =  large                                             /
//    Calling convention =  xdata reentrant                                   /
//    Constant location  =  data_rom                                          /
//    Dptr setup         =  1,16                                              /
//                                                                            /
//    Source file        =  D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\Profiles\Roles\peripheral.c                    /
//    Command line       =  -f D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabC /
//                          loud\NewEcoExec\codegenerator\Device\EcoBT\Projec /
//                          t\ble\CodeGenerator\CC2540DB\..\..\config\buildCo /
//                          mponents.cfg (-DBROADCASTER_CFG=0x01              /
//                          -DOBSERVER_CFG=0x02 -DPERIPHERAL_CFG=0x04         /
//                          -DCENTRAL_CFG=0x08 -DADV_NCONN_CFG=0x01           /
//                          -DADV_CONN_CFG=0x02 -DSCAN_CFG=0x04               /
//                          -DINIT_CFG=0x08 -DADV_CFG=ADV_NCONN_CFG+ADV_CONN_ /
//                          CFG -DLINK_CFG=ADV_CONN_CFG+INIT_CFG              /
//                          -DFULL_CFG=INIT_CFG+SCAN_CFG+ADV_NCONN_CFG+ADV_CO /
//                          NN_CFG) -f D:\NTHU\¬ã¨s\Important\ThesisCode\Code /
//                          \GitLabCloud\NewEcoExec\codegenerator\Device\EcoB /
//                          T\Project\ble\CodeGenerator\CC2540DB\buildConfig. /
//                          cfg (-DHOST_CONFIG=PERIPHERAL_CFG                 /
//                          -DGAP_PRIVACY_RECONNECT)                          /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\Profiles\Roles\peripheral.c -D                 /
//                          INT_HEAP_LEN=900 -D HALNODEBUG -D                 /
//                          OSAL_CBTIMER_NUM_TASKS=1 -D HAL_AES_DMA=TRUE -D   /
//                          HAL_DMA=TRUE -D xPOWER_SAVING -D                  /
//                          xPLUS_BROADCASTER -D HAL_LCD=FALSE -D             /
//                          HAL_LED=TRUE -D HAL_ADC=TRUE -lB                  /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\CC2540\List\ -o         /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\CC2540\Obj\ -e --debug  /
//                          --core=plain --dptr=16,1 --data_model=large       /
//                          --code_model=banked --calling_convention=xdata_re /
//                          entrant --place_constants=data_rom                /
//                          --nr_virtual_regs 16 -I                           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\common\ -I        /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\include\ -I       /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          hal\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCode /
//                          \Code\GitLabCloud\NewEcoExec\codegenerator\Device /
//                          \EcoBT\Project\ble\CodeGenerator\CC2540DB\..\..\. /
//                          .\..\Components\hal\target\CC2540EB\ -I           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          osal\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCod /
//                          e\Code\GitLabCloud\NewEcoExec\codegenerator\Devic /
//                          e\EcoBT\Project\ble\CodeGenerator\CC2540DB\..\..\ /
//                          ..\..\Components\services\saddr\ -I               /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          ble\include\ -I D:\NTHU\¬ã¨s\Important\ThesisCode /
//                          \Code\GitLabCloud\NewEcoExec\codegenerator\Device /
//                          \EcoBT\Project\ble\CodeGenerator\CC2540DB\..\..\. /
//                          .\..\Components\ble\controller\phy\ -I            /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          ble\controller\include\ -I                        /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\..\..\Components\ /
//                          ble\hci\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Cod /
//                          e\GitLabCloud\NewEcoExec\codegenerator\Device\Eco /
//                          BT\Project\ble\CodeGenerator\CC2540DB\..\..\..\.. /
//                          \Components\ble\host\ -I                          /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\common\cc2540\    /
//                          -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabC /
//                          loud\NewEcoExec\codegenerator\Device\EcoBT\Projec /
//                          t\ble\CodeGenerator\CC2540DB\..\..\common\npi\npi /
//                          _np\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\Gi /
//                          tLabCloud\NewEcoExec\codegenerator\Device\EcoBT\P /
//                          roject\ble\CodeGenerator\CC2540DB\..\..\Profiles\ /
//                          Roles\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\ /
//                          GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT /
//                          \Project\ble\CodeGenerator\CC2540DB\..\..\Profile /
//                          s\SimpleProfile\ -I D:\NTHU\¬ã¨s\Important\Thesis /
//                          Code\Code\GitLabCloud\NewEcoExec\codegenerator\De /
//                          vice\EcoBT\Project\ble\CodeGenerator\CC2540DB\..\ /
//                          ..\Profiles\DevInfo\ -I                           /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\Profiles\Accelero /
//                          meter\ -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\ /
//                          GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT /
//                          \Project\ble\CodeGenerator\CC2540DB\..\..\Profile /
//                          s\EcoExecGATTProfile\ -I                          /
//                          D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\..\..\Profiles\Batt\    /
//                          -I D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabC /
//                          loud\NewEcoExec\codegenerator\Device\EcoBT\Projec /
//                          t\ble\CodeGenerator\CC2540DB\..\..\Profiles\HIDDe /
//                          v\ -Ohz                                           /
//    List file          =  D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabClou /
//                          d\NewEcoExec\codegenerator\Device\EcoBT\Project\b /
//                          le\CodeGenerator\CC2540DB\CC2540\List\peripheral. /
//                          s51                                               /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME peripheral

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)

        EXTERN ?ALLOC_XSTACK8
        EXTERN ?BANKED_ENTER_XDATA
        EXTERN ?BANKED_LEAVE_XDATA
        EXTERN ?BDISPATCH
        EXTERN ?BRET
        EXTERN ?CALL_IND
        EXTERN ?DEALLOC_XSTACK8
        EXTERN ?L_MOV_X
        EXTERN ?L_MUL
        EXTERN ?PUSH_XSTACK8_X_TWO
        EXTERN ?PUSH_XSTACK_I_FOUR
        EXTERN ?PUSH_XSTACK_I_ONE
        EXTERN ?PUSH_XSTACK_I_TWO
        EXTERN ?UL_GE_X
        EXTERN ?US_SWITCH_DENSE
        EXTERN ?V0
        EXTERN ?XLOAD_R2345
        EXTERN ?XSP
        EXTERN ?XSTACK_DISP0_8
        EXTERN ?XSTORE_R2345
        EXTERN __INIT_XDATA_I
        EXTERN __INIT_XDATA_Z

        PUBLIC ??GAPRole_GetParameter?relay
        PUBLIC ??GAPRole_Init?relay
        PUBLIC ??GAPRole_ProcessEvent?relay
        PUBLIC ??GAPRole_SendUpdateParam?relay
        PUBLIC ??GAPRole_SetParameter?relay
        PUBLIC ??GAPRole_StartDevice?relay
        PUBLIC ??GAPRole_TerminateConnection?relay
        PUBLIC GAPRole_GetParameter
        PUBLIC GAPRole_Init
        PUBLIC GAPRole_ProcessEvent
        PUBLIC GAPRole_SendUpdateParam
        PUBLIC GAPRole_SetParameter
        PUBLIC GAPRole_StartDevice
        PUBLIC GAPRole_TerminateConnection
        PUBWEAK __Constant_10000
        PUBWEAK __Constant_6

GAPBondMgr_LinkEst  SYMBOL "GAPBondMgr_LinkEst"
??GAPBondMgr_LinkEst?relay SYMBOL "?relay", GAPBondMgr_LinkEst
GAPBondMgr_ProcessGAPMsg SYMBOL "GAPBondMgr_ProcessGAPMsg"
??GAPBondMgr_ProcessGAPMsg?relay SYMBOL "?relay", GAPBondMgr_ProcessGAPMsg
GAP_DeviceInit      SYMBOL "GAP_DeviceInit"
??GAP_DeviceInit?relay SYMBOL "?relay", GAP_DeviceInit
GAP_EndDiscoverable SYMBOL "GAP_EndDiscoverable"
??GAP_EndDiscoverable?relay SYMBOL "?relay", GAP_EndDiscoverable
GAP_GetParamValue   SYMBOL "GAP_GetParamValue"
??GAP_GetParamValue?relay SYMBOL "?relay", GAP_GetParamValue
GAP_MakeDiscoverable SYMBOL "GAP_MakeDiscoverable"
??GAP_MakeDiscoverable?relay SYMBOL "?relay", GAP_MakeDiscoverable
GAP_RegisterForHCIMsgs SYMBOL "GAP_RegisterForHCIMsgs"
??GAP_RegisterForHCIMsgs?relay SYMBOL "?relay", GAP_RegisterForHCIMsgs
GAP_SetParamValue   SYMBOL "GAP_SetParamValue"
??GAP_SetParamValue?relay SYMBOL "?relay", GAP_SetParamValue
GAP_TerminateLinkReq SYMBOL "GAP_TerminateLinkReq"
??GAP_TerminateLinkReq?relay SYMBOL "?relay", GAP_TerminateLinkReq
GAP_UpdateAdvertisingData SYMBOL "GAP_UpdateAdvertisingData"
??GAP_UpdateAdvertisingData?relay SYMBOL "?relay", GAP_UpdateAdvertisingData
HCI_ReadRssiCmd     SYMBOL "HCI_ReadRssiCmd"
??HCI_ReadRssiCmd?relay SYMBOL "?relay", HCI_ReadRssiCmd
L2CAP_ConnParamUpdateReq SYMBOL "L2CAP_ConnParamUpdateReq"
??L2CAP_ConnParamUpdateReq?relay SYMBOL "?relay", L2CAP_ConnParamUpdateReq
osal_get_timeoutEx  SYMBOL "osal_get_timeoutEx"
??osal_get_timeoutEx?relay SYMBOL "?relay", osal_get_timeoutEx
osal_memcpy         SYMBOL "osal_memcpy"
??osal_memcpy?relay SYMBOL "?relay", osal_memcpy
osal_memset         SYMBOL "osal_memset"
??osal_memset?relay SYMBOL "?relay", osal_memset
osal_msg_deallocate SYMBOL "osal_msg_deallocate"
??osal_msg_deallocate?relay SYMBOL "?relay", osal_msg_deallocate
osal_msg_receive    SYMBOL "osal_msg_receive"
??osal_msg_receive?relay SYMBOL "?relay", osal_msg_receive
osal_set_event      SYMBOL "osal_set_event"
??osal_set_event?relay SYMBOL "?relay", osal_set_event
osal_snv_read       SYMBOL "osal_snv_read"
??osal_snv_read?relay SYMBOL "?relay", osal_snv_read
osal_snv_write      SYMBOL "osal_snv_write"
??osal_snv_write?relay SYMBOL "?relay", osal_snv_write
osal_start_timerEx  SYMBOL "osal_start_timerEx"
??osal_start_timerEx?relay SYMBOL "?relay", osal_start_timerEx
osal_stop_timerEx   SYMBOL "osal_stop_timerEx"
??osal_stop_timerEx?relay SYMBOL "?relay", osal_stop_timerEx
GAPRole_GetParameter SYMBOL "GAPRole_GetParameter"
??GAPRole_GetParameter?relay SYMBOL "?relay", GAPRole_GetParameter
GAPRole_Init        SYMBOL "GAPRole_Init"
??GAPRole_Init?relay SYMBOL "?relay", GAPRole_Init
GAPRole_ProcessEvent SYMBOL "GAPRole_ProcessEvent"
??GAPRole_ProcessEvent?relay SYMBOL "?relay", GAPRole_ProcessEvent
GAPRole_SendUpdateParam SYMBOL "GAPRole_SendUpdateParam"
??GAPRole_SendUpdateParam?relay SYMBOL "?relay", GAPRole_SendUpdateParam
GAPRole_SetParameter SYMBOL "GAPRole_SetParameter"
??GAPRole_SetParameter?relay SYMBOL "?relay", GAPRole_SetParameter
GAPRole_StartDevice SYMBOL "GAPRole_StartDevice"
??GAPRole_StartDevice?relay SYMBOL "?relay", GAPRole_StartDevice
GAPRole_TerminateConnection SYMBOL "GAPRole_TerminateConnection"
??GAPRole_TerminateConnection?relay SYMBOL "?relay", GAPRole_TerminateConnection

        EXTERN ??GAPBondMgr_LinkEst?relay
        EXTERN ??GAPBondMgr_ProcessGAPMsg?relay
        EXTERN ??GAP_DeviceInit?relay
        EXTERN ??GAP_EndDiscoverable?relay
        EXTERN ??GAP_GetParamValue?relay
        EXTERN ??GAP_MakeDiscoverable?relay
        EXTERN ??GAP_RegisterForHCIMsgs?relay
        EXTERN ??GAP_SetParamValue?relay
        EXTERN ??GAP_TerminateLinkReq?relay
        EXTERN ??GAP_UpdateAdvertisingData?relay
        EXTERN ??HCI_ReadRssiCmd?relay
        EXTERN ??L2CAP_ConnParamUpdateReq?relay
        EXTERN ??osal_get_timeoutEx?relay
        EXTERN ??osal_memcpy?relay
        EXTERN ??osal_memset?relay
        EXTERN ??osal_msg_deallocate?relay
        EXTERN ??osal_msg_receive?relay
        EXTERN ??osal_set_event?relay
        EXTERN ??osal_snv_read?relay
        EXTERN ??osal_snv_write?relay
        EXTERN ??osal_start_timerEx?relay
        EXTERN ??osal_stop_timerEx?relay
        EXTERN GAPBondMgr_LinkEst
        EXTERN GAPBondMgr_ProcessGAPMsg
        EXTERN GAP_DeviceInit
        EXTERN GAP_EndDiscoverable
        EXTERN GAP_GetParamValue
        EXTERN GAP_MakeDiscoverable
        EXTERN GAP_RegisterForHCIMsgs
        EXTERN GAP_SetParamValue
        EXTERN GAP_TerminateLinkReq
        EXTERN GAP_UpdateAdvertisingData
        EXTERN HCI_ReadRssiCmd
        EXTERN L2CAP_ConnParamUpdateReq
        EXTERN osal_get_timeoutEx
        EXTERN osal_memcpy
        EXTERN osal_memset
        EXTERN osal_msg_deallocate
        EXTERN osal_msg_receive
        EXTERN osal_set_event
        EXTERN osal_snv_read
        EXTERN osal_snv_write
        EXTERN osal_start_timerEx
        EXTERN osal_stop_timerEx

// D:\NTHU\¬ã¨s\Important\ThesisCode\Code\GitLabCloud\NewEcoExec\codegenerator\Device\EcoBT\Project\ble\Profiles\Roles\peripheral.c
//    1 /**************************************************************************************************
//    2   Filename:       peripheral.c
//    3   Revised:        $Date: 2012-11-14 13:15:48 -0800 (Wed, 14 Nov 2012) $
//    4   Revision:       $Revision: 32186 $
//    5 
//    6   Description:    GAP Peripheral Role
//    7 
//    8 
//    9   Copyright 2009 - 2012 Texas Instruments Incorporated. All rights reserved.
//   10 
//   11   IMPORTANT: Your use of this Software is limited to those specific rights
//   12   granted under the terms of a software license agreement between the user
//   13   who downloaded the software, his/her employer (which must be your employer)
//   14   and Texas Instruments Incorporated (the "License").  You may not use this
//   15   Software unless you agree to abide by the terms of the License. The License
//   16   limits your use, and you acknowledge, that the Software may not be modified,
//   17   copied or distributed unless embedded on a Texas Instruments microcontroller
//   18   or used solely and exclusively in conjunction with a Texas Instruments radio
//   19   frequency transceiver, which is integrated into your product.  Other than for
//   20   the foregoing purpose, you may not use, reproduce, copy, prepare derivative
//   21   works of, modify, distribute, perform, display or sell this Software and/or
//   22   its documentation for any purpose.
//   23 
//   24   YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
//   25   PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
//   26   INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
//   27   NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
//   28   TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
//   29   NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
//   30   LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
//   31   INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
//   32   OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
//   33   OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
//   34   (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
//   35 
//   36   Should you have any questions regarding your right to use this Software,
//   37   contact Texas Instruments Incorporated at www.TI.com.
//   38 **************************************************************************************************/
//   39 
//   40 /*********************************************************************
//   41  * INCLUDES
//   42  */
//   43 #include "bcomdef.h"
//   44 #include "OSAL.h"
//   45 #include "hci_tl.h"
//   46 #include "l2cap.h"
//   47 #include "gap.h"
//   48 #include "linkdb.h"
//   49 #include "att.h"
//   50 #include "gatt.h"
//   51 #include "osal_snv.h"
//   52 
//   53 #include "peripheral.h"
//   54 #include "gapbondmgr.h"
//   55 
//   56 /*********************************************************************
//   57  * MACROS
//   58  */
//   59 
//   60 /*********************************************************************
//   61  * CONSTANTS
//   62  */
//   63 // Profile Events
//   64 #define START_ADVERTISING_EVT         0x0001
//   65 #define RSSI_READ_EVT                 0x0002
//   66 #define UPDATE_PARAMS_TIMEOUT_EVT     0x0004
//   67 
//   68 #define DEFAULT_ADVERT_OFF_TIME       30000   // 30 seconds
//   69 
//   70 #define RSSI_NOT_AVAILABLE            127
//   71 
//   72 #define DEFAULT_MIN_CONN_INTERVAL     0x0006  // 100 milliseconds
//   73 #define DEFAULT_MAX_CONN_INTERVAL     0x0C80  // 4 seconds
//   74 
//   75 #define MIN_CONN_INTERVAL             0x0006
//   76 #define MAX_CONN_INTERVAL             0x0C80
//   77 
//   78 #define DEFAULT_TIMEOUT_MULTIPLIER    1000
//   79 
//   80 #define CONN_INTERVAL_MULTIPLIER      6
//   81 
//   82 #define MIN_SLAVE_LATENCY             0
//   83 #define MAX_SLAVE_LATENCY             500
//   84 
//   85 #define MIN_TIMEOUT_MULTIPLIER        0x000a
//   86 #define MAX_TIMEOUT_MULTIPLIER        0x0c80
//   87 
//   88 #define MAX_TIMEOUT_VALUE             0xFFFF
//   89 
//   90 /*********************************************************************
//   91  * TYPEDEFS
//   92  */
//   93 
//   94 /*********************************************************************
//   95  * GLOBAL VARIABLES
//   96  */
//   97 
//   98 /*********************************************************************
//   99  * EXTERNAL VARIABLES
//  100  */
//  101 
//  102 /*********************************************************************
//  103  * EXTERNAL FUNCTIONS
//  104  */
//  105 
//  106 /*********************************************************************
//  107  * LOCAL VARIABLES
//  108  */

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  109 static uint8 gapRole_TaskID;   // Task ID for internal task/event processing
gapRole_TaskID:
        DS 1
        REQUIRE __INIT_XDATA_Z
//  110 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  111 static gaprole_States_t gapRole_state;
gapRole_state:
        DS 1
        REQUIRE __INIT_XDATA_Z
//  112 
//  113 /*********************************************************************
//  114  * Profile Parameters - reference GAPROLE_PROFILE_PARAMETERS for
//  115  * descriptions
//  116  */
//  117 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  118 static uint8  gapRole_profileRole;
gapRole_profileRole:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  119 static uint8  gapRole_IRK[KEYLEN];
gapRole_IRK:
        DS 16
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  120 static uint8  gapRole_SRK[KEYLEN];
gapRole_SRK:
        DS 16
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA32
//  121 static uint32 gapRole_signCounter;
gapRole_signCounter:
        DS 4
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  122 static uint8  gapRole_bdAddr[B_ADDR_LEN];
gapRole_bdAddr:
        DS 6
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_I:XDATA:NOROOT(0)
//  123 static uint8  gapRole_AdvEnabled = TRUE;
gapRole_AdvEnabled:
        DATA8
        DS 1
        REQUIRE `?<Initializer for gapRole_AdvEnabled>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
//  124 static uint16 gapRole_AdvertOffTime = DEFAULT_ADVERT_OFF_TIME;
gapRole_AdvertOffTime:
        DATA16
        DS 2
        REQUIRE `?<Initializer for gapRole_AdvertOffTime>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
//  125 static uint8  gapRole_AdvertDataLen = 3;
gapRole_AdvertDataLen:
        DATA8
        DS 1
        REQUIRE `?<Initializer for gapRole_AdvertDataLen>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
//  126 static uint8  gapRole_AdvertData[B_MAX_ADV_LEN] =
gapRole_AdvertData:
        DATA8
        DS 31
        REQUIRE `?<Initializer for gapRole_AdvertData>`
        REQUIRE __INIT_XDATA_I
//  127 {
//  128   0x02,   // length of this data
//  129   GAP_ADTYPE_FLAGS,   // AD Type = Flags
//  130   // Limited Discoverable & BR/EDR not supported
//  131   (GAP_ADTYPE_FLAGS_GENERAL | GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED),
//  132   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
//  133 };

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  134 static uint8  gapRole_ScanRspDataLen = 0;
gapRole_ScanRspDataLen:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  135 static uint8  gapRole_ScanRspData[B_MAX_ADV_LEN] = {0};
gapRole_ScanRspData:
        DS 31
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  136 static uint8  gapRole_AdvEventType;
gapRole_AdvEventType:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  137 static uint8  gapRole_AdvDirectType;
gapRole_AdvDirectType:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  138 static uint8  gapRole_AdvDirectAddr[B_ADDR_LEN] = {0};
gapRole_AdvDirectAddr:
        DS 6
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  139 static uint8  gapRole_AdvChanMap;
gapRole_AdvChanMap:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  140 static uint8  gapRole_AdvFilterPolicy;
gapRole_AdvFilterPolicy:
        DS 1
        REQUIRE __INIT_XDATA_Z
//  141 

        RSEG XDATA_I:XDATA:NOROOT(0)
//  142 static uint16 gapRole_ConnectionHandle = INVALID_CONNHANDLE;
gapRole_ConnectionHandle:
        DATA16
        DS 2
        REQUIRE `?<Initializer for gapRole_ConnectionHandle>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//  143 static uint16 gapRole_RSSIReadRate = 0;
gapRole_RSSIReadRate:
        DS 2
        REQUIRE __INIT_XDATA_Z
//  144 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//  145 static gapRolesCBs_t *pGapRoles_AppCGs = NULL;
pGapRoles_AppCGs:
        DS 2
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  146 static uint8  gapRole_ConnectedDevAddr[B_ADDR_LEN] = {0};
gapRole_ConnectedDevAddr:
        DS 6
        REQUIRE __INIT_XDATA_Z
//  147 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  148 static uint8  gapRole_ParamUpdateEnable = FALSE;
gapRole_ParamUpdateEnable:
        DS 1
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_I:XDATA:NOROOT(0)
//  149 static uint16 gapRole_MinConnInterval = DEFAULT_MIN_CONN_INTERVAL;
gapRole_MinConnInterval:
        DATA16
        DS 2
        REQUIRE `?<Initializer for gapRole_MinConnInterval>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
//  150 static uint16 gapRole_MaxConnInterval = DEFAULT_MAX_CONN_INTERVAL;
gapRole_MaxConnInterval:
        DATA16
        DS 2
        REQUIRE `?<Initializer for gapRole_MaxConnInterval>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//  151 static uint16 gapRole_SlaveLatency = MIN_SLAVE_LATENCY;
gapRole_SlaveLatency:
        DS 2
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_I:XDATA:NOROOT(0)
//  152 static uint16 gapRole_TimeoutMultiplier = DEFAULT_TIMEOUT_MULTIPLIER;
gapRole_TimeoutMultiplier:
        DATA16
        DS 2
        REQUIRE `?<Initializer for gapRole_TimeoutMultiplier>`
        REQUIRE __INIT_XDATA_I
//  153 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//  154 static uint16 gapRole_ConnInterval = 0;
gapRole_ConnInterval:
        DS 2
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//  155 static uint16 gapRole_ConnSlaveLatency = 0;
gapRole_ConnSlaveLatency:
        DS 2
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//  156 static uint16 gapRole_ConnTimeout = 0;
gapRole_ConnTimeout:
        DS 2
        REQUIRE __INIT_XDATA_Z
//  157 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  158 static uint8 ParamUpdateNoSuccessOption = GAPROLE_NO_ACTION;
ParamUpdateNoSuccessOption:
        DS 1
        REQUIRE __INIT_XDATA_Z
//  159 
//  160 /*********************************************************************
//  161  * Profile Attributes - variables
//  162  */
//  163 
//  164 /*********************************************************************
//  165  * Profile Attributes - Table
//  166  */
//  167 
//  168 /*********************************************************************
//  169  * LOCAL FUNCTIONS
//  170  */
//  171 static void gapRole_ProcessOSALMsg( osal_event_hdr_t *pMsg );
//  172 static void gapRole_ProcessGAPMsg( gapEventHdr_t *pMsg );
//  173 static void gapRole_SetupGAP( void );
//  174 
//  175 /*********************************************************************
//  176  * NETWORK LAYER CALLBACKS
//  177  */
//  178 
//  179 /*********************************************************************
//  180  * PUBLIC FUNCTIONS
//  181  */
//  182 
//  183 /*********************************************************************
//  184  * @brief   Set a GAP Role parameter.
//  185  *
//  186  * Public function defined in peripheral.h.
//  187  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  188 bStatus_t GAPRole_SetParameter( uint16 param, uint8 len, void *pValue )
GAPRole_SetParameter:
        CODE
//  189 {
        MOV     A,#-0x10
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 16
        ; Auto size: 0
        MOV     ?V0 + 0,R1
        MOV     A,R4
        MOV     R6,A
        MOV     A,R5
        MOV     R7,A
//  190   bStatus_t ret = SUCCESS;
        MOV     ?V0 + 1,#0x0
//  191   switch ( param )
        MOV     DPL,R1
        MOV     ?V0 + 2,DPL
        MOV     ?V0 + 3,#0x0
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,#?V0 + 4
        LCALL   ?US_SWITCH_DENSE
`?<Jumptable for GAPRole_SetParameter>_0`:
        DATA
        DATA16
        DATA
        DATA16
        DW        769
        DATA
        DATA8
        DATA
        DATA8
        DB        24
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_0
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_1
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_2
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_3
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_0
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_4
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_5
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_6
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_7
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_8
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_9
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_10
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_11
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_12
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_0
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_13
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_14
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_15
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_16
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_17
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_18
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_0
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_0
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_0
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_0
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_SetParameter_19
        CODE
//  192   {
//  193     case GAPROLE_IRK:
//  194       if ( len == KEYLEN )
??GAPRole_SetParameter_1:
        MOV     A,#0x10
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  195       {
//  196         VOID osal_memcpy( gapRole_IRK, pValue, KEYLEN ) ;
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x10
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R2,#gapRole_IRK & 0xff
        MOV     R3,#(gapRole_IRK >> 8) & 0xff
        LJMP    ??GAPRole_SetParameter_21 & 0xFFFF
//  197       }
//  198       else
//  199       {
//  200         ret = bleInvalidRange;
//  201       }
//  202       break;
//  203 
//  204     case GAPROLE_SRK:
//  205       if ( len == KEYLEN )
??GAPRole_SetParameter_2:
        MOV     A,#0x10
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  206       {
//  207         VOID osal_memcpy( gapRole_SRK, pValue, KEYLEN ) ;
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x10
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R2,#gapRole_SRK & 0xff
        MOV     R3,#(gapRole_SRK >> 8) & 0xff
        LJMP    ??GAPRole_SetParameter_21 & 0xFFFF
//  208       }
//  209       else
//  210       {
//  211         ret = bleInvalidRange;
//  212       }
//  213       break;
//  214 
//  215     case GAPROLE_SIGNCOUNTER:
//  216       if ( len == sizeof ( uint32 ) )
??GAPRole_SetParameter_3:
        MOV     A,#0x4
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  217       {
//  218         gapRole_signCounter = *((uint32*)pValue);
        MOV     DPL,R6
        MOV     DPH,R7
        LCALL   ?XLOAD_R2345
        MOV     DPTR,#gapRole_signCounter
        LCALL   ?XSTORE_R2345
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  219       }
//  220       else
//  221       {
//  222         ret = bleInvalidRange;
//  223       }
//  224       break;
//  225 
//  226     case GAPROLE_ADVERT_ENABLED:
//  227       if ( len == sizeof( uint8 ) )
??GAPRole_SetParameter_4:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  228       {
//  229         uint8 oldAdvEnabled = gapRole_AdvEnabled;
        MOV     DPTR,#gapRole_AdvEnabled
        MOVX    A,@DPTR
        MOV     R0,A
//  230         gapRole_AdvEnabled = *((uint8*)pValue);
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     DPTR,#gapRole_AdvEnabled
        MOVX    @DPTR,A
//  231 
//  232         if ( (oldAdvEnabled) && (gapRole_AdvEnabled == FALSE) )
        MOV     A,R0
        JZ      ??GAPRole_SetParameter_23
        MOVX    A,@DPTR
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  233         {
//  234           // Turn off Advertising
//  235           if ( gapRole_state == GAPROLE_ADVERTISING )
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        XRL     A,#0x2
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  236           {
//  237             VOID GAP_EndDiscoverable( gapRole_TaskID );
        ; Setup parameters for call to function GAP_EndDiscoverable
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??GAP_EndDiscoverable?relay
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  238           }
//  239         }
??GAPRole_SetParameter_23:
        MOVX    A,@DPTR
        JNZ     $+5
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  240         else if ( (oldAdvEnabled == FALSE) && (gapRole_AdvEnabled) )
//  241         {
//  242           // Turn on Advertising
//  243           if ( (gapRole_state == GAPROLE_STARTED)
//  244               || (gapRole_state == GAPROLE_WAITING)
//  245               || (gapRole_state == GAPROLE_WAITING_AFTER_TIMEOUT) )
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        XRL     A,#0x1
        JZ      ??GAPRole_SetParameter_24
        MOVX    A,@DPTR
        XRL     A,#0x3
        JZ      ??GAPRole_SetParameter_24
        MOVX    A,@DPTR
        XRL     A,#0x4
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  246           {
//  247             VOID osal_set_event( gapRole_TaskID, START_ADVERTISING_EVT );
??GAPRole_SetParameter_24:
        ; Setup parameters for call to function osal_set_event
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_set_event?relay
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  248           }
//  249         }
//  250       }
//  251       else
//  252       {
//  253         ret = bleInvalidRange;
//  254       }
//  255       break;
//  256 
//  257     case GAPROLE_ADVERT_OFF_TIME:
//  258       if ( len == sizeof ( uint16 ) )
??GAPRole_SetParameter_5:
        MOV     A,#0x2
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  259       {
//  260         gapRole_AdvertOffTime = *((uint16*)pValue);
        LCALL   ?Subroutine8 & 0xFFFF
//  261       }
??CrossCallReturnLabel_41:
        MOV     DPTR,#gapRole_AdvertOffTime
        LJMP    ??GAPRole_SetParameter_25 & 0xFFFF
//  262       else
//  263       {
//  264         ret = bleInvalidRange;
//  265       }
//  266       break;
//  267 
//  268     case GAPROLE_ADVERT_DATA:
//  269       if ( len <= B_MAX_ADV_LEN )
??GAPRole_SetParameter_6:
        MOV     A,R1
        CLR     C
        SUBB    A,#0x20
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  270       {
//  271         VOID osal_memset( gapRole_AdvertData, 0, B_MAX_ADV_LEN );
        ; Setup parameters for call to function osal_memset
        MOV     R4,#0x1f
        MOV     R5,#0x0
        MOV     R1,#0x0
        MOV     R2,#gapRole_AdvertData & 0xff
        MOV     R3,#(gapRole_AdvertData >> 8) & 0xff
        LCALL   ??osal_memset?relay
//  272         VOID osal_memcpy( gapRole_AdvertData, pValue, len );
        ; Setup parameters for call to function osal_memcpy
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     A,R6
        MOV     R4,A
        MOV     A,R7
        MOV     R5,A
        MOV     R2,#gapRole_AdvertData & 0xff
        MOV     R3,#(gapRole_AdvertData >> 8) & 0xff
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
//  273         gapRole_AdvertDataLen = len;
        MOV     A,?V0 + 0
        MOV     DPTR,#gapRole_AdvertDataLen
        MOVX    @DPTR,A
//  274         /* update advertising data */
//  275         GAP_UpdateAdvertisingData( gapRole_TaskID, TRUE, B_MAX_ADV_LEN, gapRole_AdvertData );
        ; Setup parameters for call to function GAP_UpdateAdvertisingData
        MOV     R4,#gapRole_AdvertData & 0xff
        MOV     R5,#(gapRole_AdvertData >> 8) & 0xff
        MOV     R3,#0x1f
        MOV     R2,#0x1
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??GAP_UpdateAdvertisingData?relay
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  276       }
//  277       else
//  278       {
//  279         ret = bleInvalidRange;
//  280       }
//  281       break;
//  282 
//  283     case GAPROLE_SCAN_RSP_DATA:
//  284       if ( len <= B_MAX_ADV_LEN )
??GAPRole_SetParameter_7:
        MOV     A,R1
        CLR     C
        SUBB    A,#0x20
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  285       {
//  286         VOID osal_memset( gapRole_ScanRspData, 0, B_MAX_ADV_LEN );
        ; Setup parameters for call to function osal_memset
        MOV     R4,#0x1f
        MOV     R5,#0x0
        MOV     R1,#0x0
        MOV     R2,#gapRole_ScanRspData & 0xff
        MOV     R3,#(gapRole_ScanRspData >> 8) & 0xff
        LCALL   ??osal_memset?relay
//  287         VOID osal_memcpy( gapRole_ScanRspData, pValue, len );
        ; Setup parameters for call to function osal_memcpy
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     A,R6
        MOV     R4,A
        MOV     A,R7
        MOV     R5,A
        MOV     R2,#gapRole_ScanRspData & 0xff
        MOV     R3,#(gapRole_ScanRspData >> 8) & 0xff
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
//  288         gapRole_ScanRspDataLen = len;
        MOV     A,?V0 + 0
        MOV     DPTR,#gapRole_ScanRspDataLen
        LJMP    ??GAPRole_SetParameter_26 & 0xFFFF
//  289       }
//  290       else
//  291       {
//  292         ret = bleInvalidRange;
//  293       }
//  294       break;
//  295 
//  296     case GAPROLE_ADV_EVENT_TYPE:
//  297       if ( (len == sizeof ( uint8 )) && (*((uint8*)pValue) <= GAP_ADTYPE_ADV_NONCONN_IND) )
??GAPRole_SetParameter_8:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     R0,A
        CLR     C
        SUBB    A,#0x4
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  298       {
//  299         gapRole_AdvEventType = *((uint8*)pValue);
        MOV     A,R0
        MOV     DPTR,#gapRole_AdvEventType
        LJMP    ??GAPRole_SetParameter_26 & 0xFFFF
//  300       }
//  301       else
//  302       {
//  303         ret = bleInvalidRange;
//  304       }
//  305       break;
//  306 
//  307     case GAPROLE_ADV_DIRECT_TYPE:
//  308       if ( (len == sizeof ( uint8 )) && (*((uint8*)pValue) <= ADDRTYPE_PRIVATE_RESOLVE) )
??GAPRole_SetParameter_9:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     R0,A
        CLR     C
        SUBB    A,#0x4
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  309       {
//  310         gapRole_AdvDirectType = *((uint8*)pValue);
        MOV     A,R0
        MOV     DPTR,#gapRole_AdvDirectType
        LJMP    ??GAPRole_SetParameter_26 & 0xFFFF
//  311       }
//  312       else
//  313       {
//  314         ret = bleInvalidRange;
//  315       }
//  316       break;
//  317 
//  318     case GAPROLE_ADV_DIRECT_ADDR:
//  319       if ( len == B_ADDR_LEN )
??GAPRole_SetParameter_10:
        MOV     A,#0x6
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  320       {
//  321         VOID osal_memcpy( gapRole_AdvDirectAddr, pValue, B_ADDR_LEN ) ;
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x6
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R2,#gapRole_AdvDirectAddr & 0xff
        MOV     R3,#(gapRole_AdvDirectAddr >> 8) & 0xff
??GAPRole_SetParameter_21:
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  322       }
//  323       else
//  324       {
//  325         ret = bleInvalidRange;
//  326       }
//  327       break;
//  328 
//  329     case GAPROLE_ADV_CHANNEL_MAP:
//  330       if ( (len == sizeof ( uint8 )) && (*((uint8*)pValue) <= 0x07) )
??GAPRole_SetParameter_11:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     R0,A
        CLR     C
        SUBB    A,#0x8
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  331       {
//  332         gapRole_AdvChanMap = *((uint8*)pValue);
        MOV     A,R0
        MOV     DPTR,#gapRole_AdvChanMap
        LJMP    ??GAPRole_SetParameter_26 & 0xFFFF
//  333       }
//  334       else
//  335       {
//  336         ret = bleInvalidRange;
//  337       }
//  338       break;
//  339 
//  340     case GAPROLE_ADV_FILTER_POLICY:
//  341       if ( (len == sizeof ( uint8 )) && (*((uint8*)pValue) <= GAP_FILTER_POLICY_WHITE) )
??GAPRole_SetParameter_12:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     R0,A
        CLR     C
        SUBB    A,#0x4
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  342       {
//  343         gapRole_AdvFilterPolicy = *((uint8*)pValue);
        MOV     A,R0
        MOV     DPTR,#gapRole_AdvFilterPolicy
        LJMP    ??GAPRole_SetParameter_26 & 0xFFFF
//  344       }
//  345       else
//  346       {
//  347         ret = bleInvalidRange;
//  348       }
//  349       break;
//  350 
//  351     case GAPROLE_RSSI_READ_RATE:
//  352       if ( len == sizeof ( uint16 ) )
??GAPRole_SetParameter_13:
        MOV     A,#0x2
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  353       {
//  354         gapRole_RSSIReadRate = *((uint16*)pValue);
        LCALL   ?Subroutine8 & 0xFFFF
??CrossCallReturnLabel_42:
        MOV     DPTR,#gapRole_RSSIReadRate
        LCALL   ?Subroutine13 & 0xFFFF
//  355 
//  356         if ( (gapRole_RSSIReadRate) && (gapRole_state == GAPROLE_CONNECTED) )
??CrossCallReturnLabel_17:
        MOV     A,R0
        ORL     A,R1
        JNZ     $+5
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        XRL     A,#0x5
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  357         {
//  358           // Start the RSSI Reads
//  359           VOID osal_start_timerEx( gapRole_TaskID, RSSI_READ_EVT, gapRole_RSSIReadRate );
        ; Setup parameters for call to function osal_start_timerEx
        LCALL   ?Subroutine4 & 0xFFFF
//  360         }
//  361       }
??CrossCallReturnLabel_3:
        LCALL   ?PUSH_XSTACK_I_FOUR
        MOV     R2,#0x2
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_timerEx?relay
        LJMP    ??GAPRole_SetParameter_27 & 0xFFFF
//  362       else
//  363       {
//  364         ret = bleInvalidRange;
//  365       }
//  366       break;
//  367 
//  368     case GAPROLE_PARAM_UPDATE_ENABLE:
//  369       if ( (len == sizeof ( uint8 )) && (*((uint8*)pValue) <= TRUE) )
??GAPRole_SetParameter_14:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        MOV     R0,A
        CLR     C
        SUBB    A,#0x2
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  370       {
//  371         gapRole_ParamUpdateEnable = *((uint8*)pValue);
        MOV     A,R0
        MOV     DPTR,#gapRole_ParamUpdateEnable
        SJMP    ??GAPRole_SetParameter_26
//  372       }
//  373       else
//  374       {
//  375         ret = bleInvalidRange;
//  376       }
//  377       break;
//  378 
//  379     case GAPROLE_MIN_CONN_INTERVAL:
//  380       {
//  381         uint16 newInterval = *((uint16*)pValue);
??GAPRole_SetParameter_15:
        LCALL   ?Subroutine3 & 0xFFFF
//  382         if (   len == sizeof ( uint16 )           &&
//  383              ( newInterval >= MIN_CONN_INTERVAL ) &&
//  384              ( newInterval <= MAX_CONN_INTERVAL ) )
??CrossCallReturnLabel_0:
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        LCALL   ?Subroutine14 & 0xFFFF
??CrossCallReturnLabel_24:
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  385         {
//  386           gapRole_MinConnInterval = newInterval;
        MOV     DPTR,#gapRole_MinConnInterval
        SJMP    ??GAPRole_SetParameter_28
//  387         }
//  388         else
//  389         {
//  390           ret = bleInvalidRange;
//  391         }
//  392       }
//  393       break;
//  394 
//  395     case GAPROLE_MAX_CONN_INTERVAL:
//  396       {
//  397         uint16 newInterval = *((uint16*)pValue);
??GAPRole_SetParameter_16:
        LCALL   ?Subroutine3 & 0xFFFF
//  398         if (   len == sizeof ( uint16 )          &&
//  399              ( newInterval >= MIN_CONN_INTERVAL) &&
//  400              ( newInterval <= MAX_CONN_INTERVAL) )
??CrossCallReturnLabel_1:
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        LCALL   ?Subroutine14 & 0xFFFF
??CrossCallReturnLabel_25:
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  401         {
//  402           gapRole_MaxConnInterval = newInterval;
        MOV     DPTR,#gapRole_MaxConnInterval
        SJMP    ??GAPRole_SetParameter_28
//  403         }
//  404         else
//  405         {
//  406           ret = bleInvalidRange;
//  407         }
//  408       }
//  409       break;
//  410 
//  411     case GAPROLE_SLAVE_LATENCY:
//  412       {
//  413         uint16 latency = *((uint16*)pValue);
??GAPRole_SetParameter_17:
        LCALL   ?Subroutine8 & 0xFFFF
//  414         if ( len == sizeof ( uint16 ) && (latency < MAX_SLAVE_LATENCY) )
??CrossCallReturnLabel_43:
        MOV     A,#0x2
        XRL     A,?V0 + 0
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        CLR     C
        MOV     A,R0
        SUBB    A,#-0xc
        MOV     A,R1
        SUBB    A,#0x1
        JC      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
//  415         {
//  416           gapRole_SlaveLatency = latency;
        MOV     DPTR,#gapRole_SlaveLatency
??GAPRole_SetParameter_25:
        MOV     A,R0
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R1
        SJMP    ??GAPRole_SetParameter_26
//  417         }
//  418         else
//  419         {
//  420           ret = bleInvalidRange;
//  421         }
//  422       }
//  423       break;
//  424 
//  425     case GAPROLE_TIMEOUT_MULTIPLIER:
//  426       {
//  427         uint16 newTimeout = *((uint16*)pValue);
??GAPRole_SetParameter_18:
        LCALL   ?Subroutine3 & 0xFFFF
//  428         if ( len == sizeof ( uint16 )
//  429             && (newTimeout >= MIN_TIMEOUT_MULTIPLIER) && (newTimeout <= MAX_TIMEOUT_MULTIPLIER) )
??CrossCallReturnLabel_2:
        JZ      $+5
        LJMP    ??GAPRole_SetParameter_20 & 0xFFFF
        MOV     A,R2
        ADD     A,#-0xa
        MOV     R0,A
        MOV     A,R3
        ADDC    A,#-0x1
        MOV     R1,A
        CLR     C
        MOV     A,R0
        SUBB    A,#0x77
        MOV     A,R1
        SUBB    A,#0xc
        JNC     ??GAPRole_SetParameter_20
//  430         {
//  431           gapRole_TimeoutMultiplier = newTimeout;
        MOV     DPTR,#gapRole_TimeoutMultiplier
??GAPRole_SetParameter_28:
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
??GAPRole_SetParameter_26:
        MOVX    @DPTR,A
        LJMP    ??GAPRole_SetParameter_22 & 0xFFFF
//  432         }
//  433         else
//  434         {
//  435           ret = bleInvalidRange;
//  436         }
//  437       }
//  438       break;
//  439 
//  440       case GAPROLE_PARAM_UPDATE_REQ:
//  441         {
//  442           uint8 req = *((uint8*)pValue);
//  443           if ( len == sizeof ( uint8 ) && (req == TRUE) )
??GAPRole_SetParameter_19:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JNZ     ??GAPRole_SetParameter_20
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    A,@DPTR
        XRL     A,#0x1
        JNZ     ??GAPRole_SetParameter_20
//  444           {
//  445             // Check the connection parameters versus the configured parameters
//  446             if ( (gapRole_ConnInterval < gapRole_MinConnInterval)   ||
//  447                  (gapRole_ConnInterval > gapRole_MaxConnInterval)   ||
//  448                  (gapRole_ConnSlaveLatency != gapRole_SlaveLatency) ||
//  449                  (gapRole_ConnTimeout != gapRole_TimeoutMultiplier) )
        MOV     DPTR,#gapRole_MinConnInterval
        LCALL   ??Subroutine20_0 & 0xFFFF
??CrossCallReturnLabel_31:
        MOV     DPH,#(gapRole_ConnInterval >> 8) & 0xff
        MOV     DPL,#gapRole_ConnInterval & 0xff
        CLR     C
        MOVX    A,@DPTR
        SUBB    A,R0
        INC     DPTR
        MOVX    A,@DPTR
        SUBB    A,R1
        JC      ??GAPRole_SetParameter_29
        MOV     DPTR,#gapRole_ConnInterval
        LCALL   ??Subroutine20_0 & 0xFFFF
??CrossCallReturnLabel_32:
        MOV     DPH,#(gapRole_MaxConnInterval >> 8) & 0xff
        MOV     DPL,#gapRole_MaxConnInterval & 0xff
        CLR     C
        MOVX    A,@DPTR
        SUBB    A,R0
        INC     DPTR
        MOVX    A,@DPTR
        SUBB    A,R1
        JC      ??GAPRole_SetParameter_29
        MOV     DPTR,#gapRole_ConnSlaveLatency
        LCALL   ??Subroutine20_0 & 0xFFFF
??CrossCallReturnLabel_33:
        MOV     DPTR,#gapRole_SlaveLatency
        MOVX    A,@DPTR
        XRL     A,R0
        JNZ     ??GAPRole_SetParameter_30
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,R1
??GAPRole_SetParameter_30:
        JNZ     ??GAPRole_SetParameter_29
        MOV     DPTR,#gapRole_ConnTimeout
        LCALL   ?Subroutine7 & 0xFFFF
??CrossCallReturnLabel_9:
        JNZ     ??GAPRole_SetParameter_31
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,R1
??GAPRole_SetParameter_31:
        JZ      ??GAPRole_SetParameter_22
//  450             {
//  451               GAPRole_SendUpdateParam( gapRole_MinConnInterval, gapRole_MaxConnInterval,
//  452                                        gapRole_SlaveLatency, gapRole_TimeoutMultiplier, GAPROLE_NO_ACTION );
??GAPRole_SetParameter_29:
        ; Setup parameters for call to function GAPRole_SendUpdateParam
        MOV     DPTR,#gapRole_TimeoutMultiplier
        LCALL   ?PUSH_XSTACK8_X_TWO
        MOV     DPTR,#gapRole_SlaveLatency
        LCALL   ?PUSH_XSTACK8_X_TWO
        LCALL   ?Subroutine2 & 0xFFFF
//  453             }
//  454           }
??CrossCallReturnLabel_29:
        LCALL   ??GAPRole_SendUpdateParam?relay
??GAPRole_SetParameter_27:
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
        SJMP    ??GAPRole_SetParameter_22
//  455           else
//  456           {
//  457             ret = bleInvalidRange;
??GAPRole_SetParameter_20:
        MOV     ?V0 + 1,#0x18
        SJMP    ??GAPRole_SetParameter_22
//  458           }
//  459         }
//  460         break;
//  461 
//  462     default:
//  463       // The param value isn't part of this profile, try the GAP.
//  464       if ( (param < TGAP_PARAMID_MAX) && (len == sizeof ( uint16 )) )
??GAPRole_SetParameter_0:
        CLR     C
        MOV     A,R2
        SUBB    A,#0x24
        MOV     A,R3
        SUBB    A,#0x0
        JNC     ??GAPRole_SetParameter_32
        MOV     A,#0x2
        XRL     A,?V0 + 0
        JNZ     ??GAPRole_SetParameter_32
//  465       {
//  466         ret = GAP_SetParamValue( param, *((uint16*)pValue) );
        ; Setup parameters for call to function GAP_SetParamValue
        LCALL   ?Subroutine17 & 0xFFFF
//  467       }
??CrossCallReturnLabel_47:
        LCALL   ??GAP_SetParamValue?relay
        MOV     A,R1
        MOV     ?V0 + 1,A
        SJMP    ??GAPRole_SetParameter_22
//  468       else
//  469       {
//  470         ret = INVALIDPARAMETER;
??GAPRole_SetParameter_32:
        MOV     ?V0 + 1,#0x2
//  471       }
//  472       break;
//  473   }
//  474 
//  475   return ( ret );
??GAPRole_SetParameter_22:
        MOV     R1,?V0 + 1
        MOV     R7,#0x8
        LJMP    ?BANKED_LEAVE_XDATA
//  476 }

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine14:
        MOV     A,R2
        ADD     A,#-0x6
        MOV     R0,A
        MOV     A,R3
        ADDC    A,#-0x1
        MOV     R1,A
        CLR     C
        MOV     A,R0
        SUBB    A,#0x7b
        MOV     A,R1
        SUBB    A,#0xc
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine3:
        MOV     DPL,R6
        MOV     DPH,R7
        LCALL   ?Subroutine18 & 0xFFFF
??CrossCallReturnLabel_57:
        MOV     A,#0x2
        XRL     A,?V0 + 0
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine2:
        MOV     R1,#0x0
        REQUIRE ??Subroutine19_0
        ; // Fall through to label ??Subroutine19_0

        RSEG BANKED_CODE:CODE:NOROOT(0)
??Subroutine19_0:
        MOV     DPTR,#gapRole_MaxConnInterval
        LCALL   ??Subroutine21_0 & 0xFFFF
??CrossCallReturnLabel_49:
        MOV     DPTR,#gapRole_MinConnInterval
        LCALL   ?Subroutine18 & 0xFFFF
??CrossCallReturnLabel_59:
        RET
//  477 
//  478 /*********************************************************************
//  479  * @brief   Get a GAP Role parameter.
//  480  *
//  481  * Public function defined in peripheral.h.
//  482  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  483 bStatus_t GAPRole_GetParameter( uint16 param, void *pValue )
GAPRole_GetParameter:
        CODE
//  484 {
        MOV     A,#-0xc
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 12
        ; Auto size: 0
        MOV     A,R4
        MOV     R6,A
        MOV     A,R5
        MOV     R7,A
//  485   bStatus_t ret = SUCCESS;
        MOV     ?V0 + 0,#0x0
//  486   switch ( param )
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
        MOV     R0,#?V0 + 2
        LCALL   ?US_SWITCH_DENSE
`?<Jumptable for GAPRole_GetParameter>_0`:
        DATA
        DATA16
        DATA
        DATA16
        DW        768
        DATA
        DATA8
        DATA
        DATA8
        DB        24
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_0
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_1
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_2
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_3
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_4
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_5
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_6
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_7
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_8
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_9
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_10
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_11
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_12
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_13
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_14
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_15
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_16
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_17
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_18
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_19
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_20
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_21
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_22
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_23
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_24
        DATA
        DATA16
        DATA
        DATA16
        DW        ??GAPRole_GetParameter_25
        CODE
//  487   {
//  488     case GAPROLE_PROFILEROLE:
//  489       *((uint8*)pValue) = gapRole_profileRole;
??GAPRole_GetParameter_1:
        MOV     DPTR,#gapRole_profileRole
        LJMP    ??GAPRole_GetParameter_26 & 0xFFFF
//  490       break;
//  491 
//  492     case GAPROLE_IRK:
//  493       VOID osal_memcpy( pValue, gapRole_IRK, KEYLEN ) ;
??GAPRole_GetParameter_2:
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x10
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_IRK & 0xff
        MOV     R5,#(gapRole_IRK >> 8) & 0xff
        LJMP    ??GAPRole_GetParameter_27 & 0xFFFF
//  494       break;
//  495 
//  496     case GAPROLE_SRK:
//  497       VOID osal_memcpy( pValue, gapRole_SRK, KEYLEN ) ;
??GAPRole_GetParameter_3:
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x10
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_SRK & 0xff
        MOV     R5,#(gapRole_SRK >> 8) & 0xff
        LJMP    ??GAPRole_GetParameter_27 & 0xFFFF
//  498       break;
//  499 
//  500     case GAPROLE_SIGNCOUNTER:
//  501       *((uint32*)pValue) = gapRole_signCounter;
??GAPRole_GetParameter_4:
        MOV     DPTR,#gapRole_signCounter
        LCALL   ?XLOAD_R2345
        MOV     DPL,R6
        MOV     DPH,R7
        LCALL   ?XSTORE_R2345
//  502       break;
        LJMP    ??GAPRole_GetParameter_28 & 0xFFFF
//  503 
//  504     case GAPROLE_BD_ADDR:
//  505       VOID osal_memcpy( pValue, gapRole_bdAddr, B_ADDR_LEN ) ;
??GAPRole_GetParameter_5:
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x6
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_bdAddr & 0xff
        MOV     R5,#(gapRole_bdAddr >> 8) & 0xff
        LJMP    ??GAPRole_GetParameter_27 & 0xFFFF
//  506       break;
//  507 
//  508     case GAPROLE_ADVERT_ENABLED:
//  509       *((uint8*)pValue) = gapRole_AdvEnabled;
??GAPRole_GetParameter_6:
        MOV     DPTR,#gapRole_AdvEnabled
        SJMP    ??GAPRole_GetParameter_26
//  510       break;
//  511 
//  512     case GAPROLE_ADVERT_OFF_TIME:
//  513       *((uint16*)pValue) = gapRole_AdvertOffTime;
??GAPRole_GetParameter_7:
        MOV     DPTR,#gapRole_AdvertOffTime
        LJMP    ??GAPRole_GetParameter_29 & 0xFFFF
//  514       break;
//  515 
//  516     case GAPROLE_ADVERT_DATA:
//  517       VOID osal_memcpy( pValue , gapRole_AdvertData, gapRole_AdvertDataLen );
??GAPRole_GetParameter_8:
        ; Setup parameters for call to function osal_memcpy
        MOV     DPTR,#gapRole_AdvertDataLen
        LCALL   ?Subroutine12 & 0xFFFF
??CrossCallReturnLabel_15:
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_AdvertData & 0xff
        MOV     R5,#(gapRole_AdvertData >> 8) & 0xff
        SJMP    ??GAPRole_GetParameter_27
//  518       break;
//  519 
//  520     case GAPROLE_SCAN_RSP_DATA:
//  521       VOID osal_memcpy( pValue, gapRole_ScanRspData, gapRole_ScanRspDataLen ) ;
??GAPRole_GetParameter_9:
        ; Setup parameters for call to function osal_memcpy
        MOV     DPTR,#gapRole_ScanRspDataLen
        LCALL   ?Subroutine12 & 0xFFFF
??CrossCallReturnLabel_16:
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_ScanRspData & 0xff
        MOV     R5,#(gapRole_ScanRspData >> 8) & 0xff
        SJMP    ??GAPRole_GetParameter_27
//  522       break;
//  523 
//  524     case GAPROLE_ADV_EVENT_TYPE:
//  525       *((uint8*)pValue) = gapRole_AdvEventType;
??GAPRole_GetParameter_10:
        MOV     DPTR,#gapRole_AdvEventType
        SJMP    ??GAPRole_GetParameter_26
//  526       break;
//  527 
//  528     case GAPROLE_ADV_DIRECT_TYPE:
//  529       *((uint8*)pValue) = gapRole_AdvDirectType;
??GAPRole_GetParameter_11:
        MOV     DPTR,#gapRole_AdvDirectType
        SJMP    ??GAPRole_GetParameter_26
//  530       break;
//  531 
//  532     case GAPROLE_ADV_DIRECT_ADDR:
//  533       VOID osal_memcpy( pValue, gapRole_AdvDirectAddr, B_ADDR_LEN ) ;
??GAPRole_GetParameter_12:
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x6
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_AdvDirectAddr & 0xff
        MOV     R5,#(gapRole_AdvDirectAddr >> 8) & 0xff
        SJMP    ??GAPRole_GetParameter_27
//  534       break;
//  535 
//  536     case GAPROLE_ADV_CHANNEL_MAP:
//  537       *((uint8*)pValue) = gapRole_AdvChanMap;
??GAPRole_GetParameter_13:
        MOV     DPTR,#gapRole_AdvChanMap
        SJMP    ??GAPRole_GetParameter_26
//  538       break;
//  539 
//  540     case GAPROLE_ADV_FILTER_POLICY:
//  541       *((uint8*)pValue) = gapRole_AdvFilterPolicy;
??GAPRole_GetParameter_14:
        MOV     DPTR,#gapRole_AdvFilterPolicy
??GAPRole_GetParameter_26:
        MOVX    A,@DPTR
        MOV     DPL,R6
        MOV     DPH,R7
        SJMP    ??GAPRole_GetParameter_30
//  542       break;
//  543 
//  544     case GAPROLE_CONNHANDLE:
//  545       *((uint16*)pValue) = gapRole_ConnectionHandle;
??GAPRole_GetParameter_15:
        MOV     DPTR,#gapRole_ConnectionHandle
        SJMP    ??GAPRole_GetParameter_29
//  546       break;
//  547 
//  548     case GAPROLE_RSSI_READ_RATE:
//  549       *((uint16*)pValue) = gapRole_RSSIReadRate;
??GAPRole_GetParameter_16:
        MOV     DPTR,#gapRole_RSSIReadRate
        SJMP    ??GAPRole_GetParameter_29
//  550       break;
//  551 
//  552     case GAPROLE_PARAM_UPDATE_ENABLE:
//  553       *((uint16*)pValue) = gapRole_ParamUpdateEnable;
??GAPRole_GetParameter_17:
        MOV     DPTR,#gapRole_ParamUpdateEnable
        MOVX    A,@DPTR
        MOV     DPL,R6
        MOV     DPH,R7
        MOVX    @DPTR,A
        INC     DPTR
        CLR     A
        SJMP    ??GAPRole_GetParameter_30
//  554       break;
//  555 
//  556     case GAPROLE_MIN_CONN_INTERVAL:
//  557       *((uint16*)pValue) = gapRole_MinConnInterval;
??GAPRole_GetParameter_18:
        MOV     DPTR,#gapRole_MinConnInterval
        SJMP    ??GAPRole_GetParameter_29
//  558       break;
//  559 
//  560     case GAPROLE_MAX_CONN_INTERVAL:
//  561       *((uint16*)pValue) = gapRole_MaxConnInterval;
??GAPRole_GetParameter_19:
        MOV     DPTR,#gapRole_MaxConnInterval
        SJMP    ??GAPRole_GetParameter_29
//  562       break;
//  563 
//  564     case GAPROLE_SLAVE_LATENCY:
//  565       *((uint16*)pValue) = gapRole_SlaveLatency;
??GAPRole_GetParameter_20:
        MOV     DPTR,#gapRole_SlaveLatency
        SJMP    ??GAPRole_GetParameter_29
//  566       break;
//  567 
//  568     case GAPROLE_TIMEOUT_MULTIPLIER:
//  569       *((uint16*)pValue) = gapRole_TimeoutMultiplier;
??GAPRole_GetParameter_21:
        MOV     DPTR,#gapRole_TimeoutMultiplier
        SJMP    ??GAPRole_GetParameter_29
//  570       break;
//  571 
//  572     case GAPROLE_CONN_BD_ADDR:
//  573       VOID osal_memcpy( pValue, gapRole_ConnectedDevAddr, B_ADDR_LEN ) ;
??GAPRole_GetParameter_22:
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x6
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_ConnectedDevAddr & 0xff
        MOV     R5,#(gapRole_ConnectedDevAddr >> 8) & 0xff
??GAPRole_GetParameter_27:
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
//  574       break;
        SJMP    ??GAPRole_GetParameter_28
//  575 
//  576     case GAPROLE_CONN_INTERVAL:
//  577       *((uint16*)pValue) = gapRole_ConnInterval;
??GAPRole_GetParameter_23:
        MOV     DPTR,#gapRole_ConnInterval
        SJMP    ??GAPRole_GetParameter_29
//  578       break;
//  579 
//  580     case GAPROLE_CONN_LATENCY:
//  581       *((uint16*)pValue) = gapRole_ConnSlaveLatency;
??GAPRole_GetParameter_24:
        MOV     DPTR,#gapRole_ConnSlaveLatency
        SJMP    ??GAPRole_GetParameter_29
//  582       break;
//  583 
//  584     case GAPROLE_CONN_TIMEOUT:
//  585       *((uint16*)pValue) = gapRole_ConnTimeout;
??GAPRole_GetParameter_25:
        MOV     DPTR,#gapRole_ConnTimeout
??GAPRole_GetParameter_29:
        LCALL   ??Subroutine20_0 & 0xFFFF
??CrossCallReturnLabel_34:
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,R0
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R1
        SJMP    ??GAPRole_GetParameter_30
//  586       break;
//  587 
//  588     default:
//  589       // The param value isn't part of this profile, try the GAP.
//  590       if ( param < TGAP_PARAMID_MAX )
??GAPRole_GetParameter_0:
        CLR     C
        MOV     A,R2
        SUBB    A,#0x24
        MOV     A,R3
        SUBB    A,#0x0
        JNC     ??GAPRole_GetParameter_31
//  591       {
//  592         *((uint16*)pValue) = GAP_GetParamValue( param );
        ; Setup parameters for call to function GAP_GetParamValue
        LCALL   ??GAP_GetParamValue?relay
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
??GAPRole_GetParameter_30:
        MOVX    @DPTR,A
        SJMP    ??GAPRole_GetParameter_28
//  593       }
//  594       else
//  595       {
//  596         ret = INVALIDPARAMETER;
??GAPRole_GetParameter_31:
        MOV     ?V0 + 0,#0x2
//  597       }
//  598       break;
//  599   }
//  600 
//  601   return ( ret );
??GAPRole_GetParameter_28:
        MOV     R1,?V0 + 0
        REQUIRE ?Subroutine0
        ; // Fall through to label ?Subroutine0
//  602 }

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine0:
        MOV     R7,#0x4
        LJMP    ?BANKED_LEAVE_XDATA

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine12:
        MOVX    A,@DPTR
        MOV     ?V0 + 2,A
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        RET
//  603 
//  604 /*********************************************************************
//  605  * @brief   Does the device initialization.
//  606  *
//  607  * Public function defined in peripheral.h.
//  608  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  609 bStatus_t GAPRole_StartDevice( gapRolesCBs_t *pAppCallbacks )
GAPRole_StartDevice:
        CODE
//  610 {
        MOV     A,#-0xa
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 10
        ; Auto size: 0
//  611   if ( gapRole_state == GAPROLE_INIT )
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        JNZ     ??GAPRole_StartDevice_0
//  612   {
//  613     // Clear all of the Application callbacks
//  614     if ( pAppCallbacks )
        MOV     A,R2
        ORL     A,R3
        JZ      ??GAPRole_StartDevice_1
//  615     {
//  616       pGapRoles_AppCGs = pAppCallbacks;
        MOV     DPTR,#pGapRoles_AppCGs
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
        MOVX    @DPTR,A
//  617     }
//  618 
//  619     // Start the GAP
//  620     gapRole_SetupGAP();
??GAPRole_StartDevice_1:
        ; Setup parameters for call to function GAP_DeviceInit
        MOV     ?V0 + 0,#gapRole_signCounter & 0xff
        MOV     ?V0 + 1,#(gapRole_signCounter >> 8) & 0xff
        MOV     R0,#?V0 + 0
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     ?V0 + 0,#gapRole_SRK & 0xff
        MOV     ?V0 + 1,#(gapRole_SRK >> 8) & 0xff
        MOV     R0,#?V0 + 0
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_IRK & 0xff
        MOV     R5,#(gapRole_IRK >> 8) & 0xff
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_profileRole
        MOVX    A,@DPTR
        MOV     R2,A
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??GAP_DeviceInit?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
//  621 
//  622     return ( SUCCESS );
        MOV     R1,#0x0
        SJMP    ??GAPRole_StartDevice_2
//  623   }
//  624   else
//  625   {
//  626     return ( bleAlreadyInRequestedMode );
??GAPRole_StartDevice_0:
        MOV     R1,#0x11
??GAPRole_StartDevice_2:
        MOV     R7,#0x2
        LJMP    ?BANKED_LEAVE_XDATA
//  627   }
//  628 }
//  629 
//  630 /*********************************************************************
//  631  * @brief   Terminates the existing connection.
//  632  *
//  633  * Public function defined in peripheral.h.
//  634  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  635 bStatus_t GAPRole_TerminateConnection( void )
GAPRole_TerminateConnection:
        CODE
//  636 {
        PUSH    DPL
        PUSH    DPH
        ; Saved register size: 2
        ; Auto size: 0
//  637   if ( gapRole_state == GAPROLE_CONNECTED )
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        XRL     A,#0x5
        JNZ     ??GAPRole_TerminateConnection_0
//  638   {
//  639     return ( GAP_TerminateLinkReq( gapRole_TaskID, gapRole_ConnectionHandle ) );
        ; Setup parameters for call to function GAP_TerminateLinkReq
        LCALL   ?Subroutine10 & 0xFFFF
//  640   }
??CrossCallReturnLabel_13:
        LCALL   ??GAP_TerminateLinkReq?relay
        SJMP    ??GAPRole_TerminateConnection_1
//  641   else
//  642   {
//  643     return ( bleIncorrectMode );
??GAPRole_TerminateConnection_0:
        MOV     R1,#0x12
??GAPRole_TerminateConnection_1:
        POP     DPH
        POP     DPL
        LJMP    ?BRET
//  644   }
//  645 }
//  646 
//  647 /*********************************************************************
//  648  * LOCAL FUNCTION PROTOTYPES
//  649  */
//  650 
//  651 /*********************************************************************
//  652  * @brief   Task Initialization function.
//  653  *
//  654  * Internal function defined in peripheral.h.
//  655  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  656 void GAPRole_Init( uint8 task_id )
GAPRole_Init:
        CODE
//  657 {
        MOV     A,#-0x9
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 9
        ; Auto size: 0
        MOV     A,R1
//  658   gapRole_TaskID = task_id;
        MOV     DPTR,#gapRole_TaskID
        MOVX    @DPTR,A
//  659 
//  660   gapRole_state = GAPROLE_INIT;
        MOV     DPTR,#gapRole_state
        CLR     A
        MOVX    @DPTR,A
//  661   gapRole_ConnectionHandle = INVALID_CONNHANDLE;
        MOV     DPTR,#gapRole_ConnectionHandle
        MOV     A,#-0x1
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    @DPTR,A
//  662 
//  663   GAP_RegisterForHCIMsgs( gapRole_TaskID );
        ; Setup parameters for call to function GAP_RegisterForHCIMsgs
        LCALL   ??GAP_RegisterForHCIMsgs?relay
//  664 
//  665   // Initialize the Profile Advertising and Connection Parameters
//  666   gapRole_profileRole = GAP_PROFILE_PERIPHERAL;
        MOV     DPTR,#gapRole_profileRole
        MOV     A,#0x4
        MOVX    @DPTR,A
//  667   VOID osal_memset( gapRole_IRK, 0, KEYLEN );
        ; Setup parameters for call to function osal_memset
        MOV     R4,#0x10
        MOV     R5,#0x0
        MOV     R1,#0x0
        MOV     R2,#gapRole_IRK & 0xff
        MOV     R3,#(gapRole_IRK >> 8) & 0xff
        LCALL   ??osal_memset?relay
//  668   VOID osal_memset( gapRole_SRK, 0, KEYLEN );
        ; Setup parameters for call to function osal_memset
        MOV     R4,#0x10
        MOV     R5,#0x0
        MOV     R1,#0x0
        MOV     R2,#gapRole_SRK & 0xff
        MOV     R3,#(gapRole_SRK >> 8) & 0xff
        LCALL   ??osal_memset?relay
//  669   gapRole_signCounter = 0;
        MOV     DPTR,#gapRole_signCounter
        CLR     A
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    @DPTR,A
//  670   gapRole_AdvEventType = GAP_ADTYPE_ADV_IND;
        MOV     DPTR,#gapRole_AdvEventType
        MOVX    @DPTR,A
//  671   gapRole_AdvDirectType = ADDRTYPE_PUBLIC;
        MOV     DPTR,#gapRole_AdvDirectType
        MOVX    @DPTR,A
//  672   gapRole_AdvChanMap = GAP_ADVCHAN_ALL;
        MOV     DPTR,#gapRole_AdvChanMap
        MOV     A,#0x7
        MOVX    @DPTR,A
//  673   gapRole_AdvFilterPolicy = GAP_FILTER_POLICY_ALL;
        MOV     DPTR,#gapRole_AdvFilterPolicy
        CLR     A
        MOVX    @DPTR,A
//  674 
//  675   // Restore Items from NV
//  676   VOID osal_snv_read( BLE_NVID_IRK, KEYLEN, gapRole_IRK );
        ; Setup parameters for call to function osal_snv_read
        MOV     R4,#gapRole_IRK & 0xff
        MOV     R5,#(gapRole_IRK >> 8) & 0xff
        MOV     R2,#0x10
        MOV     R1,#0x2
        LCALL   ??osal_snv_read?relay
//  677   VOID osal_snv_read( BLE_NVID_CSRK, KEYLEN, gapRole_SRK );
        ; Setup parameters for call to function osal_snv_read
        MOV     R4,#gapRole_SRK & 0xff
        MOV     R5,#(gapRole_SRK >> 8) & 0xff
        MOV     R2,#0x10
        MOV     R1,#0x3
        LCALL   ??osal_snv_read?relay
//  678   VOID osal_snv_read( BLE_NVID_SIGNCOUNTER, sizeof( uint32 ), &gapRole_signCounter );
        ; Setup parameters for call to function osal_snv_read
        MOV     R4,#gapRole_signCounter & 0xff
        MOV     R5,#(gapRole_signCounter >> 8) & 0xff
        MOV     R2,#0x4
        MOV     R1,#0x4
        LCALL   ??osal_snv_read?relay
//  679 }
        MOV     R7,#0x1
        LJMP    ?BANKED_LEAVE_XDATA
//  680 
//  681 /*********************************************************************
//  682  * @brief   Task Event Processor function.
//  683  *
//  684  * Internal function defined in peripheral.h.
//  685  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  686 uint16 GAPRole_ProcessEvent( uint8 task_id, uint16 events )
GAPRole_ProcessEvent:
        CODE
//  687 {
        MOV     A,#-0xc
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 12
        ; Auto size: 10
        MOV     A,#-0xa
        LCALL   ?ALLOC_XSTACK8
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
//  688   VOID task_id; // OSAL required parameter that isn't used in this function
//  689 
//  690   if ( events & SYS_EVENT_MSG )
        ANL     A,#0x80
        JNZ     $+5
        LJMP    ??GAPRole_ProcessEvent_0 & 0xFFFF
//  691   {
//  692     uint8 *pMsg;
//  693 
//  694     if ( (pMsg = osal_msg_receive( gapRole_TaskID )) != NULL )
        ; Setup parameters for call to function osal_msg_receive
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_msg_receive?relay
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
        MOV     A,R2
        ORL     A,?V0 + 1
        JNZ     $+5
        LJMP    ??GAPRole_ProcessEvent_1 & 0xFFFF
//  695     {
//  696       gapRole_ProcessOSALMsg( (osal_event_hdr_t *)pMsg );
        MOV     A,R2
        ADD     A,#0x5
        MOV     R0,A
        MOV     A,R3
        ADDC    A,#0x0
        MOV     R1,A
        MOV     DPL,R2
        MOV     DPH,R3
        MOVX    A,@DPTR
        ADD     A,#0x6f
        JZ      ??GAPRole_ProcessEvent_2
        ADD     A,#-0x11
        JZ      ??GAPRole_ProcessEvent_3
        ADD     A,#-0x2e
        JZ      ??GAPRole_ProcessEvent_4
        SJMP    ??GAPRole_ProcessEvent_5
??GAPRole_ProcessEvent_3:
        MOV     DPL,R0
        MOV     DPH,R1
        MOVX    A,@DPTR
        XRL     A,#0x13
        JNZ     ??GAPRole_ProcessEvent_5
        MOV     DPL,R2
        MOV     DPH,R3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        LCALL   ??Subroutine23_0 & 0xFFFF
??CrossCallReturnLabel_61:
        JNZ     ??GAPRole_ProcessEvent_5
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x4
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
        SJMP    ??GAPRole_ProcessEvent_5
??GAPRole_ProcessEvent_4:
        ; Setup parameters for call to function gapRole_ProcessGAPMsg
        LCALL   ??gapRole_ProcessGAPMsg?relay
        SJMP    ??GAPRole_ProcessEvent_5
??GAPRole_ProcessEvent_2:
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,#0xe
        JNZ     ??GAPRole_ProcessEvent_5
        MOV     DPL,R2
        MOV     DPH,R3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,#0x5
        JNZ     ??GAPRole_ProcessEvent_6
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,#0x14
??GAPRole_ProcessEvent_6:
        JNZ     ??GAPRole_ProcessEvent_5
        MOV     DPL,R0
        MOV     DPH,R1
        LCALL   ?Subroutine9 & 0xFFFF
??CrossCallReturnLabel_11:
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        XRL     A,#0x5
        JNZ     ??GAPRole_ProcessEvent_5
        MOV     A,#0x7f
        XRL     A,R1
        JZ      ??GAPRole_ProcessEvent_5
        MOV     DPTR,#pGapRoles_AppCGs
        LCALL   ??Subroutine22_0 & 0xFFFF
??CrossCallReturnLabel_50:
        MOV     A,R2
        ORL     A,R3
        JZ      ??GAPRole_ProcessEvent_5
        MOV     DPTR,#pGapRoles_AppCGs
        LCALL   ?Subroutine9 & 0xFFFF
??CrossCallReturnLabel_12:
        LCALL   ??Subroutine22_0 & 0xFFFF
??CrossCallReturnLabel_51:
        MOV     DPL,R2
        MOV     DPH,R3
        MOV     A,DPL
        ORL     A,DPH
        JZ      ??GAPRole_ProcessEvent_5
        ; Setup parameters for indirect call
        LCALL   ?CALL_IND
//  697 
//  698       // Release the OSAL message
//  699       VOID osal_msg_deallocate( pMsg );
??GAPRole_ProcessEvent_5:
        ; Setup parameters for call to function osal_msg_deallocate
        MOV     R2,?V0 + 0
        MOV     R3,?V0 + 1
        LCALL   ??osal_msg_deallocate?relay
//  700     }
//  701 
//  702     // return unprocessed events
//  703     return (events ^ SYS_EVENT_MSG);
??GAPRole_ProcessEvent_1:
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        XRL     A,#0x80
        LJMP    ??GAPRole_ProcessEvent_7 & 0xFFFF
//  704   }
//  705 
//  706   if ( events & GAP_EVENT_SIGN_COUNTER_CHANGED )
??GAPRole_ProcessEvent_0:
        MOV     A,R7
        ANL     A,#0x40
        JZ      ??GAPRole_ProcessEvent_8
//  707   {
//  708     // Sign counter changed, save it to NV
//  709     VOID osal_snv_write( BLE_NVID_SIGNCOUNTER, sizeof( uint32 ), &gapRole_signCounter );
        ; Setup parameters for call to function osal_snv_write
        MOV     R4,#gapRole_signCounter & 0xff
        MOV     R5,#(gapRole_signCounter >> 8) & 0xff
        MOV     R2,#0x4
        MOV     R1,#0x4
        LCALL   ??osal_snv_write?relay
//  710 
//  711     return ( events ^ GAP_EVENT_SIGN_COUNTER_CHANGED );
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        XRL     A,#0x40
        LJMP    ??GAPRole_ProcessEvent_7 & 0xFFFF
//  712   }
//  713 
//  714   if ( events & START_ADVERTISING_EVT )
??GAPRole_ProcessEvent_8:
        MOV     A,R6
        MOV     C,0xE0 /* A   */.0
        JC      $+5
        LJMP    ??GAPRole_ProcessEvent_9 & 0xFFFF
//  715   {
//  716     if ( gapRole_AdvEnabled )
        MOV     DPTR,#gapRole_AdvEnabled
        MOVX    A,@DPTR
        JNZ     $+5
        LJMP    ??GAPRole_ProcessEvent_10 & 0xFFFF
//  717     {
//  718       gapAdvertisingParams_t params;
//  719 
//  720       // Setup advertisement parameters
//  721       params.eventType = gapRole_AdvEventType;
        MOV     DPTR,#gapRole_AdvEventType
        MOVX    A,@DPTR
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOVX    @DPTR,A
//  722       params.initiatorAddrType = gapRole_AdvDirectType;
        MOV     DPTR,#gapRole_AdvDirectType
        MOVX    A,@DPTR
        PUSH    A
        MOV     A,#0x1
        LCALL   ?XSTACK_DISP0_8
        POP     A
        MOVX    @DPTR,A
//  723       VOID osal_memcpy( params.initiatorAddr, gapRole_AdvDirectAddr, B_ADDR_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 0,#0x6
        MOV     ?V0 + 1,#0x0
        MOV     R0,#?V0 + 0
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,#gapRole_AdvDirectAddr & 0xff
        MOV     R5,#(gapRole_AdvDirectAddr >> 8) & 0xff
        MOV     A,#0x4
        LCALL   ?XSTACK_DISP0_8
        MOV     R2,DPL
        MOV     R3,DPH
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
//  724       params.channelMap = gapRole_AdvChanMap;
        MOV     DPTR,#gapRole_AdvChanMap
        MOVX    A,@DPTR
        PUSH    A
        MOV     A,#0x8
        LCALL   ?XSTACK_DISP0_8
        POP     A
        MOVX    @DPTR,A
//  725       params.filterPolicy = gapRole_AdvFilterPolicy;
        MOV     DPTR,#gapRole_AdvFilterPolicy
        MOVX    A,@DPTR
        PUSH    A
        MOV     A,#0x9
        LCALL   ?XSTACK_DISP0_8
        POP     A
        MOVX    @DPTR,A
//  726 
//  727       if ( GAP_MakeDiscoverable( gapRole_TaskID, &params ) != SUCCESS )
        ; Setup parameters for call to function GAP_MakeDiscoverable
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R2,DPL
        MOV     R3,DPH
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??GAP_MakeDiscoverable?relay
        MOV     A,R1
        JZ      ??GAPRole_ProcessEvent_10
//  728       {
//  729         gapRole_state = GAPROLE_ERROR;
        MOV     DPTR,#gapRole_state
        MOV     A,#0x6
        MOVX    @DPTR,A
//  730         if ( pGapRoles_AppCGs && pGapRoles_AppCGs->pfnStateChange )
        LCALL   ?Subroutine1 & 0xFFFF
??CrossCallReturnLabel_65:
        JZ      ??GAPRole_ProcessEvent_10
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        LCALL   ??Subroutine20_0 & 0xFFFF
??CrossCallReturnLabel_35:
        MOV     DPL,R0
        MOV     DPH,R1
        MOV     A,DPL
        ORL     A,DPH
        JZ      ??GAPRole_ProcessEvent_10
//  731         {
//  732           pGapRoles_AppCGs->pfnStateChange( gapRole_state );
        ; Setup parameters for indirect call
        MOV     R1,#0x6
        LCALL   ?CALL_IND
//  733         }
//  734       }
//  735     }
//  736     return ( events ^ START_ADVERTISING_EVT );
??GAPRole_ProcessEvent_10:
        MOV     A,R6
        XRL     A,#0x1
        SJMP    ??GAPRole_ProcessEvent_11
//  737   }
//  738 
//  739   if ( events & RSSI_READ_EVT )
??GAPRole_ProcessEvent_9:
        ANL     A,#0x2
        JZ      ??GAPRole_ProcessEvent_12
//  740   {
//  741     // Only get RSSI when in a connection
//  742     if ( gapRole_state == GAPROLE_CONNECTED )
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        XRL     A,#0x5
        JNZ     ??GAPRole_ProcessEvent_13
//  743     {
//  744       // Ask for RSSI
//  745       VOID HCI_ReadRssiCmd( gapRole_ConnectionHandle );
        ; Setup parameters for call to function HCI_ReadRssiCmd
        LCALL   ?Subroutine11 & 0xFFFF
??CrossCallReturnLabel_55:
        LCALL   ??HCI_ReadRssiCmd?relay
//  746 
//  747       // Setup next event
//  748       if ( gapRole_RSSIReadRate )
        MOV     DPTR,#gapRole_RSSIReadRate
        LCALL   ??Subroutine23_0 & 0xFFFF
??CrossCallReturnLabel_62:
        JZ      ??GAPRole_ProcessEvent_13
//  749       {
//  750         VOID osal_start_timerEx( gapRole_TaskID, RSSI_READ_EVT, gapRole_RSSIReadRate );
        ; Setup parameters for call to function osal_start_timerEx
        MOV     DPTR,#gapRole_RSSIReadRate
        LCALL   ?Subroutine5 & 0xFFFF
//  751       }
//  752     }
??CrossCallReturnLabel_5:
        LCALL   ?PUSH_XSTACK_I_FOUR
        MOV     R2,#0x2
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_timerEx?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
//  753     return ( events ^ RSSI_READ_EVT );
??GAPRole_ProcessEvent_13:
        MOV     A,R6
        XRL     A,#0x2
        SJMP    ??GAPRole_ProcessEvent_11
//  754   }
//  755 
//  756   if ( events & UPDATE_PARAMS_TIMEOUT_EVT )
??GAPRole_ProcessEvent_12:
        MOV     A,R6
        ANL     A,#0x4
        JZ      ??GAPRole_ProcessEvent_14
//  757   {
//  758     // Clear an existing timeout
//  759     if ( osal_get_timeoutEx( gapRole_TaskID, UPDATE_PARAMS_TIMEOUT_EVT ) )
        ; Setup parameters for call to function osal_get_timeoutEx
        MOV     R2,#0x4
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_get_timeoutEx?relay
        MOV     A,R2
        ORL     A,R3
        ORL     A,R4
        ORL     A,R5
        JZ      ??GAPRole_ProcessEvent_15
//  760     {
//  761       VOID osal_stop_timerEx( gapRole_TaskID, UPDATE_PARAMS_TIMEOUT_EVT );
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x4
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
//  762     }
//  763 
//  764     // The Update Parameters Timeout occurred - Terminate connection
//  765     VOID GAP_TerminateLinkReq( gapRole_TaskID, gapRole_ConnectionHandle );
??GAPRole_ProcessEvent_15:
        ; Setup parameters for call to function GAP_TerminateLinkReq
        LCALL   ?Subroutine10 & 0xFFFF
??CrossCallReturnLabel_14:
        LCALL   ??GAP_TerminateLinkReq?relay
//  766 
//  767     return ( events ^ UPDATE_PARAMS_TIMEOUT_EVT );
        MOV     A,R6
        XRL     A,#0x4
??GAPRole_ProcessEvent_11:
        MOV     R2,A
        MOV     A,R7
??GAPRole_ProcessEvent_7:
        MOV     R3,A
        SJMP    ??GAPRole_ProcessEvent_16
//  768   }
//  769 
//  770   // Discard unknown events
//  771   return 0;
??GAPRole_ProcessEvent_14:
        MOV     R2,#0x0
        MOV     R3,#0x0
??GAPRole_ProcessEvent_16:
        MOV     A,#0xa
        LCALL   ?DEALLOC_XSTACK8
        LJMP    ?Subroutine0 & 0xFFFF
//  772 }

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine10:
        MOV     DPTR,#gapRole_ConnectionHandle
        LCALL   ?Subroutine18 & 0xFFFF
??CrossCallReturnLabel_58:
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine9:
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine8:
        MOV     DPL,R6
        MOV     DPH,R7
        REQUIRE ??Subroutine20_0
        ; // Fall through to label ??Subroutine20_0

        RSEG BANKED_CODE:CODE:NOROOT(0)
??Subroutine20_0:
        LCALL   ?Subroutine16 & 0xFFFF
??CrossCallReturnLabel_69:
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine16:
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        RET
//  773 
//  774 /*********************************************************************
//  775  * @fn      gapRole_ProcessOSALMsg
//  776  *
//  777  * @brief   Process an incoming task message.
//  778  *
//  779  * @param   pMsg - message to process
//  780  *
//  781  * @return  none
//  782  */
//  783 static void gapRole_ProcessOSALMsg( osal_event_hdr_t *pMsg )
//  784 {
//  785   switch ( pMsg->event )
//  786   {
//  787     case HCI_GAP_EVENT_EVENT:
//  788       if ( pMsg->status == HCI_COMMAND_COMPLETE_EVENT_CODE )
//  789       {
//  790         hciEvt_CmdComplete_t *pPkt = (hciEvt_CmdComplete_t *)pMsg;
//  791 
//  792         if ( pPkt->cmdOpcode == HCI_READ_RSSI )
//  793         {
//  794           int8 rssi = (int8)pPkt->pReturnParam[3];
//  795 
//  796           if ( (gapRole_state == GAPROLE_CONNECTED) && (rssi != RSSI_NOT_AVAILABLE) )
//  797           {
//  798             // Report RSSI to app
//  799             if ( pGapRoles_AppCGs && pGapRoles_AppCGs->pfnRssiRead )
//  800             {
//  801               pGapRoles_AppCGs->pfnRssiRead( rssi );
//  802             }
//  803           }
//  804         }
//  805       }
//  806       break;
//  807 
//  808     case GAP_MSG_EVENT:
//  809       gapRole_ProcessGAPMsg( (gapEventHdr_t *)pMsg );
//  810       break;
//  811 
//  812     case L2CAP_SIGNAL_EVENT:
//  813       {
//  814         l2capSignalEvent_t *pPkt = (l2capSignalEvent_t *)pMsg;
//  815 
//  816         // Process the Parameter Update Response
//  817         if ( pPkt->opcode == L2CAP_PARAM_UPDATE_RSP )
//  818         {
//  819           l2capParamUpdateRsp_t *pRsp = (l2capParamUpdateRsp_t *)&(pPkt->cmd.updateRsp);
//  820           if ( pRsp->result == SUCCESS )
//  821           {
//  822             // All is good stop Update Parameters timeout
//  823             VOID osal_stop_timerEx( gapRole_TaskID, UPDATE_PARAMS_TIMEOUT_EVT );
//  824           }
//  825         }
//  826       }
//  827       break;
//  828 
//  829     default:
//  830       break;
//  831   }
//  832 }
//  833 
//  834 /*********************************************************************
//  835  * @fn      gapRole_ProcessGAPMsg
//  836  *
//  837  * @brief   Process an incoming task message.
//  838  *
//  839  * @param   pMsg - message to process
//  840  *
//  841  * @return  none
//  842  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  843 static void gapRole_ProcessGAPMsg( gapEventHdr_t *pMsg )
gapRole_ProcessGAPMsg:
        CODE
//  844 {
        MOV     A,#-0x12
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 18
        ; Auto size: 0
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
//  845   uint8 notify = FALSE;   // State changed notify the app? (default no)
//  846 
//  847   switch ( pMsg->opcode )
        MOV     DPL,R2
        MOV     DPH,R3
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,R2
        ADD     A,#0x3
        MOV     ?V0 + 0,A
        MOV     A,R3
        ADDC    A,#0x0
        MOV     ?V0 + 1,A
        MOV     A,R2
        ADD     A,#0xa
        MOV     R6,A
        MOV     A,R3
        ADDC    A,#0x0
        MOV     R7,A
        MOV     DPL,R2
        MOV     DPH,R3
        INC     DPTR
        MOV     ?V0 + 4,DPL
        MOV     ?V0 + 5,DPH
        MOV     A,R0
        JZ      ??gapRole_ProcessGAPMsg_0
        ADD     A,#-0x2
        JNZ     $+5
        LJMP    ??gapRole_ProcessGAPMsg_1 & 0xFFFF
        DEC     A
        JNZ     $+5
        LJMP    ??gapRole_ProcessGAPMsg_2 & 0xFFFF
        DEC     A
        JNZ     $+5
        LJMP    ??gapRole_ProcessGAPMsg_2 & 0xFFFF
        DEC     A
        JNZ     $+5
        LJMP    ??gapRole_ProcessGAPMsg_3 & 0xFFFF
        DEC     A
        JNZ     $+5
        LJMP    ??gapRole_ProcessGAPMsg_4 & 0xFFFF
        DEC     A
        JNZ     $+5
        LJMP    ??gapRole_ProcessGAPMsg_5 & 0xFFFF
        SJMP    ??gapRole_ProcessGAPMsg_6
//  848   {
//  849     case GAP_DEVICE_INIT_DONE_EVENT:
//  850       {
//  851         gapDeviceInitDoneEvent_t *pPkt = (gapDeviceInitDoneEvent_t *)pMsg;
//  852         bStatus_t stat = pPkt->hdr.status;
??gapRole_ProcessGAPMsg_0:
        MOVX    A,@DPTR
//  853 
//  854         if ( stat == SUCCESS )
        JNZ     ??gapRole_ProcessGAPMsg_7
//  855         {
//  856           // Save off the generated keys
//  857           VOID osal_snv_write( BLE_NVID_IRK, KEYLEN, gapRole_IRK );
        ; Setup parameters for call to function osal_snv_write
        MOV     R4,#gapRole_IRK & 0xff
        MOV     R5,#(gapRole_IRK >> 8) & 0xff
        MOV     R2,#0x10
        MOV     R1,#0x2
        LCALL   ??osal_snv_write?relay
//  858           VOID osal_snv_write( BLE_NVID_CSRK, KEYLEN, gapRole_SRK );
        ; Setup parameters for call to function osal_snv_write
        MOV     R4,#gapRole_SRK & 0xff
        MOV     R5,#(gapRole_SRK >> 8) & 0xff
        MOV     R2,#0x10
        MOV     R1,#0x3
        LCALL   ??osal_snv_write?relay
//  859 
//  860           // Save off the information
//  861           VOID osal_memcpy( gapRole_bdAddr, pPkt->devAddr, B_ADDR_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 2,#0x6
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,?V0 + 0
        MOV     R5,?V0 + 1
        MOV     R2,#gapRole_bdAddr & 0xff
        MOV     R3,#(gapRole_bdAddr >> 8) & 0xff
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
//  862 
//  863           gapRole_state = GAPROLE_STARTED;
        MOV     DPTR,#gapRole_state
        MOV     A,#0x1
        MOVX    @DPTR,A
//  864 
//  865           // Update the advertising data
//  866           stat = GAP_UpdateAdvertisingData( gapRole_TaskID,
//  867                               TRUE, gapRole_AdvertDataLen, gapRole_AdvertData );
        ; Setup parameters for call to function GAP_UpdateAdvertisingData
        MOV     R4,#gapRole_AdvertData & 0xff
        MOV     R5,#(gapRole_AdvertData >> 8) & 0xff
        MOV     DPTR,#gapRole_AdvertDataLen
        MOVX    A,@DPTR
        MOV     R3,A
        MOV     R2,#0x1
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??GAP_UpdateAdvertisingData?relay
        MOV     A,R1
//  868         }
//  869 
//  870         if ( stat != SUCCESS )
??gapRole_ProcessGAPMsg_7:
        JNZ     ??gapRole_ProcessGAPMsg_8
//  871         {
//  872           gapRole_state = GAPROLE_ERROR;
//  873         }
//  874 
//  875         notify = TRUE;
//  876       }
//  877       break;
//  878 
//  879     case GAP_ADV_DATA_UPDATE_DONE_EVENT:
//  880       {
//  881         gapAdvDataUpdateEvent_t *pPkt = (gapAdvDataUpdateEvent_t *)pMsg;
//  882 
//  883         if ( pPkt->hdr.status == SUCCESS )
//  884         {
//  885           if ( pPkt->adType )
//  886           {
//  887             // Setup the Response Data
//  888             pPkt->hdr.status = GAP_UpdateAdvertisingData( gapRole_TaskID,
//  889                               FALSE, gapRole_ScanRspDataLen, gapRole_ScanRspData );
//  890           }
//  891           else
//  892           {
//  893             // Start advertising
//  894             VOID osal_set_event( gapRole_TaskID, START_ADVERTISING_EVT );
//  895           }
//  896         }
//  897 
//  898         if ( pPkt->hdr.status != SUCCESS )
//  899         {
//  900           // Set into Error state
//  901           gapRole_state = GAPROLE_ERROR;
//  902           notify = TRUE;
//  903         }
//  904       }
//  905       break;
//  906 
//  907     case GAP_MAKE_DISCOVERABLE_DONE_EVENT:
//  908     case GAP_END_DISCOVERABLE_DONE_EVENT:
//  909       {
//  910         gapMakeDiscoverableRspEvent_t *pPkt = (gapMakeDiscoverableRspEvent_t *)pMsg;
//  911 
//  912         if ( pPkt->hdr.status == SUCCESS )
//  913         {
//  914           if ( pMsg->opcode == GAP_MAKE_DISCOVERABLE_DONE_EVENT )
//  915           {
//  916             gapRole_state = GAPROLE_ADVERTISING;
//  917           }
//  918           else // GAP_END_DISCOVERABLE_DONE_EVENT
//  919           {
//  920 
//  921             if ( gapRole_AdvertOffTime != 0 )
//  922             {
//  923               if ( ( gapRole_AdvEnabled ) )
//  924               {
//  925                 VOID osal_start_timerEx( gapRole_TaskID, START_ADVERTISING_EVT, gapRole_AdvertOffTime );
//  926               }
//  927             }
//  928             else
//  929             {
//  930               // Since gapRole_AdvertOffTime is set to 0, the device should not
//  931               // automatically become discoverable again after a period of time.
//  932               // Set enabler to FALSE; device will become discoverable again when
//  933               // this value gets set to TRUE
//  934               gapRole_AdvEnabled = FALSE;
//  935             }
//  936 
//  937             // In the Advertising Off period
//  938             gapRole_state = GAPROLE_WAITING;
//  939 
//  940           }
//  941         }
//  942         else
//  943         {
//  944           gapRole_state = GAPROLE_ERROR;
//  945         }
//  946         notify = TRUE;
//  947       }
//  948       break;
//  949 
//  950     case GAP_LINK_ESTABLISHED_EVENT:
//  951       {
//  952         gapEstLinkReqEvent_t *pPkt = (gapEstLinkReqEvent_t *)pMsg;
//  953 
//  954         if ( pPkt->hdr.status == SUCCESS )
//  955         {
//  956           VOID osal_memcpy( gapRole_ConnectedDevAddr, pPkt->devAddr, B_ADDR_LEN );
//  957           gapRole_ConnectionHandle = pPkt->connectionHandle;
//  958           gapRole_state = GAPROLE_CONNECTED;
//  959 
//  960           if ( gapRole_RSSIReadRate )
//  961           {
//  962             // Start the RSSI Reads
//  963             VOID osal_start_timerEx( gapRole_TaskID, RSSI_READ_EVT, gapRole_RSSIReadRate );
//  964           }
//  965 
//  966           // Store connection information
//  967           gapRole_ConnInterval = pPkt->connInterval;
//  968           gapRole_ConnSlaveLatency = pPkt->connLatency;
//  969           gapRole_ConnTimeout = pPkt->connTimeout;
//  970 
//  971           // Check whether update parameter request is enabled, and check the connection parameters
//  972           if ( ( gapRole_ParamUpdateEnable == TRUE ) &&
//  973                ( (pPkt->connInterval < gapRole_MinConnInterval) ||
//  974                  (pPkt->connInterval > gapRole_MaxConnInterval) ||
//  975                  (pPkt->connLatency != gapRole_SlaveLatency)    ||
//  976                  (pPkt->connTimeout != gapRole_TimeoutMultiplier) ))
//  977           {
//  978             GAPRole_SendUpdateParam( gapRole_MinConnInterval, gapRole_MaxConnInterval,
//  979                                      gapRole_SlaveLatency, gapRole_TimeoutMultiplier, GAPROLE_NO_ACTION );
//  980           }
//  981 
//  982           // Notify the Bond Manager to the connection
//  983           VOID GAPBondMgr_LinkEst( pPkt->devAddrType, pPkt->devAddr, pPkt->connectionHandle, GAP_PROFILE_PERIPHERAL );
//  984         }
//  985         else if ( pPkt->hdr.status == bleGAPConnNotAcceptable )
//  986         {
//  987           // Set enabler to FALSE; device will become discoverable again when
//  988           // this value gets set to TRUE
//  989           gapRole_AdvEnabled = FALSE;
//  990 
//  991           // Go to WAITING state, and then start advertising
//  992           gapRole_state = GAPROLE_WAITING;
//  993         }
//  994         else
//  995         {
//  996           gapRole_state = GAPROLE_ERROR;
//  997         }
//  998         notify = TRUE;
//  999       }
// 1000       break;
// 1001 
// 1002     case GAP_LINK_TERMINATED_EVENT:
// 1003       {
// 1004         gapTerminateLinkEvent_t *pPkt = (gapTerminateLinkEvent_t *)pMsg;
// 1005 
// 1006         GAPBondMgr_ProcessGAPMsg( (gapEventHdr_t *)pMsg );
// 1007         osal_memset( gapRole_ConnectedDevAddr, 0, B_ADDR_LEN );
// 1008 
// 1009         // Erase connection information
// 1010         gapRole_ConnInterval = 0;
// 1011         gapRole_ConnSlaveLatency = 0;
// 1012         gapRole_ConnTimeout = 0;
// 1013 
// 1014         // Go to WAITING state, and then start advertising
// 1015         if( pPkt->reason == LL_SUPERVISION_TIMEOUT_TERM )
// 1016         {
// 1017           gapRole_state = GAPROLE_WAITING_AFTER_TIMEOUT;
// 1018         }
// 1019         else
// 1020         {
// 1021           gapRole_state = GAPROLE_WAITING;
// 1022         }
// 1023 
// 1024         notify = TRUE;
// 1025 
// 1026         VOID osal_set_event( gapRole_TaskID, START_ADVERTISING_EVT );
// 1027 
// 1028         gapRole_ConnectionHandle = INVALID_CONNHANDLE;
// 1029       }
// 1030       break;
// 1031 
// 1032     case GAP_LINK_PARAM_UPDATE_EVENT:
// 1033       {
// 1034         gapLinkUpdateEvent_t *pPkt = (gapLinkUpdateEvent_t *)pMsg;
// 1035 
// 1036         if ( (pPkt->hdr.status != SUCCESS)
// 1037             || (pPkt->connInterval < gapRole_MinConnInterval)
// 1038               || (pPkt->connInterval > gapRole_MaxConnInterval)
// 1039                 || (pPkt->connTimeout != gapRole_TimeoutMultiplier) )
// 1040         {
// 1041           // See which option was choosen for unsuccessful updates
// 1042           switch ( ParamUpdateNoSuccessOption )
// 1043           {
// 1044             case GAPROLE_RESEND_PARAM_UPDATE:
// 1045               GAPRole_SendUpdateParam( gapRole_MinConnInterval, gapRole_MaxConnInterval,
// 1046                                        gapRole_SlaveLatency, gapRole_TimeoutMultiplier, GAPROLE_RESEND_PARAM_UPDATE );
// 1047               break;
// 1048 
// 1049             case GAPROLE_TERMINATE_LINK:
// 1050               GAPRole_TerminateConnection();
// 1051               break;
// 1052 
// 1053             case GAPROLE_NO_ACTION:
// 1054                 // fall through
// 1055             default:
// 1056               //do nothing
// 1057               break;
// 1058           }
// 1059         }
// 1060         else
// 1061         {
// 1062           // All is good, cancel update parameters timeout timer
// 1063           VOID osal_stop_timerEx( gapRole_TaskID, UPDATE_PARAMS_TIMEOUT_EVT );
// 1064 
// 1065           // Store connection information
// 1066           gapRole_ConnInterval = pPkt->connInterval;
// 1067           gapRole_ConnSlaveLatency = pPkt->connLatency;
// 1068           gapRole_ConnTimeout = pPkt->connTimeout;
// 1069         }
// 1070       }
// 1071       break;
// 1072 
// 1073     default:
// 1074       break;
// 1075   }
// 1076 
// 1077   if ( notify == TRUE )
// 1078   {
// 1079     // Notify the application
// 1080     if ( pGapRoles_AppCGs && pGapRoles_AppCGs->pfnStateChange )
??gapRole_ProcessGAPMsg_9:
        LCALL   ?Subroutine1 & 0xFFFF
??CrossCallReturnLabel_66:
        JZ      ??gapRole_ProcessGAPMsg_6
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        LCALL   ??Subroutine20_0 & 0xFFFF
??CrossCallReturnLabel_36:
        MOV     A,R0
        MOV     R2,A
        MOV     A,R1
        MOV     R3,A
        MOV     A,R2
        ORL     A,R3
        JZ      ??gapRole_ProcessGAPMsg_6
// 1081     {
// 1082       pGapRoles_AppCGs->pfnStateChange( gapRole_state );
        ; Setup parameters for indirect call
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     DPL,R2
        MOV     DPH,R3
        LCALL   ?CALL_IND
// 1083     }
// 1084   }
// 1085 }
??gapRole_ProcessGAPMsg_6:
        MOV     R7,#0xa
        LJMP    ?BANKED_LEAVE_XDATA
??gapRole_ProcessGAPMsg_1:
        MOVX    A,@DPTR
        JNZ     ??gapRole_ProcessGAPMsg_10
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        JZ      ??gapRole_ProcessGAPMsg_11
        ; Setup parameters for call to function GAP_UpdateAdvertisingData
        MOV     R4,#gapRole_ScanRspData & 0xff
        MOV     R5,#(gapRole_ScanRspData >> 8) & 0xff
        MOV     DPTR,#gapRole_ScanRspDataLen
        MOVX    A,@DPTR
        MOV     R3,A
        MOV     R2,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??GAP_UpdateAdvertisingData?relay
        MOV     A,R1
        MOV     DPL,?V0 + 4
        MOV     DPH,?V0 + 5
        MOVX    @DPTR,A
        SJMP    ??gapRole_ProcessGAPMsg_10
??gapRole_ProcessGAPMsg_11:
        ; Setup parameters for call to function osal_set_event
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_set_event?relay
??gapRole_ProcessGAPMsg_10:
        MOV     DPL,?V0 + 4
        MOV     DPH,?V0 + 5
        MOVX    A,@DPTR
        JZ      ??gapRole_ProcessGAPMsg_6
??gapRole_ProcessGAPMsg_8:
        MOV     DPTR,#gapRole_state
        MOV     A,#0x6
??gapRole_ProcessGAPMsg_12:
        MOVX    @DPTR,A
        SJMP    ??gapRole_ProcessGAPMsg_9
??gapRole_ProcessGAPMsg_2:
        MOVX    A,@DPTR
        JNZ     ??gapRole_ProcessGAPMsg_8
        MOV     A,#0x3
        XRL     A,R0
        JNZ     ??gapRole_ProcessGAPMsg_13
        MOV     DPTR,#gapRole_state
        MOV     A,#0x2
        SJMP    ??gapRole_ProcessGAPMsg_12
??gapRole_ProcessGAPMsg_13:
        MOV     DPTR,#gapRole_AdvertOffTime
        LCALL   ??Subroutine23_0 & 0xFFFF
??CrossCallReturnLabel_63:
        MOV     DPTR,#gapRole_AdvEnabled
        JZ      ??gapRole_ProcessGAPMsg_14
        MOVX    A,@DPTR
        JZ      ??gapRole_ProcessGAPMsg_15
        ; Setup parameters for call to function osal_start_timerEx
        MOV     DPTR,#gapRole_AdvertOffTime
        LCALL   ?Subroutine5 & 0xFFFF
??CrossCallReturnLabel_6:
        LCALL   ?PUSH_XSTACK_I_FOUR
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_timerEx?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
        SJMP    ??gapRole_ProcessGAPMsg_15
??gapRole_ProcessGAPMsg_14:
        CLR     A
        MOVX    @DPTR,A
??gapRole_ProcessGAPMsg_15:
        MOV     DPTR,#gapRole_state
        MOV     A,#0x3
        SJMP    ??gapRole_ProcessGAPMsg_12
??gapRole_ProcessGAPMsg_3:
        MOVX    A,@DPTR
        MOV     R0,A
        JZ      $+5
        LJMP    ??gapRole_ProcessGAPMsg_16 & 0xFFFF
        MOV     A,R2
        ADD     A,#0x4
        MOV     ?V0 + 8,A
        MOV     A,R3
        ADDC    A,#0x0
        MOV     ?V0 + 9,A
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 4,#0x6
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
        MOV     R4,?V0 + 8
        MOV     R5,?V0 + 9
        MOV     R2,#gapRole_ConnectedDevAddr & 0xff
        MOV     R3,#(gapRole_ConnectedDevAddr >> 8) & 0xff
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
        LCALL   ?Subroutine8 & 0xFFFF
??CrossCallReturnLabel_44:
        MOV     DPTR,#gapRole_ConnectionHandle
        LCALL   ?Subroutine13 & 0xFFFF
??CrossCallReturnLabel_18:
        MOV     DPTR,#gapRole_state
        MOV     A,#0x5
        MOVX    @DPTR,A
        MOV     DPTR,#gapRole_RSSIReadRate
        LCALL   ??Subroutine23_0 & 0xFFFF
??CrossCallReturnLabel_64:
        JZ      ??gapRole_ProcessGAPMsg_17
        ; Setup parameters for call to function osal_start_timerEx
        LCALL   ?Subroutine4 & 0xFFFF
??CrossCallReturnLabel_4:
        LCALL   ?PUSH_XSTACK_I_FOUR
        MOV     R2,#0x2
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_timerEx?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
??gapRole_ProcessGAPMsg_17:
        MOV     A,?V0 + 2
        ADD     A,#0xc
        MOV     DPL,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     DPH,A
        LCALL   ?Subroutine6 & 0xFFFF
??CrossCallReturnLabel_7:
        MOV     A,?V0 + 2
        ADD     A,#0xe
        MOV     DPL,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     DPH,A
        LCALL   ??Subroutine21_0 & 0xFFFF
??CrossCallReturnLabel_46:
        MOV     DPTR,#gapRole_ConnSlaveLatency
        MOV     A,R4
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R5
        MOVX    @DPTR,A
        MOV     A,?V0 + 2
        ADD     A,#0x10
        MOV     DPL,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     ?V0 + 2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 3,A
        MOV     DPTR,#gapRole_ConnTimeout
        MOV     A,?V0 + 2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,?V0 + 3
        MOVX    @DPTR,A
        MOV     DPTR,#gapRole_ParamUpdateEnable
        MOVX    A,@DPTR
        XRL     A,#0x1
        JNZ     ??gapRole_ProcessGAPMsg_18
        MOV     DPTR,#gapRole_MinConnInterval
        LCALL   ??Subroutine22_0 & 0xFFFF
??CrossCallReturnLabel_52:
        CLR     C
        MOV     A,R0
        SUBB    A,R2
        MOV     A,R1
        SUBB    A,R3
        JC      ??gapRole_ProcessGAPMsg_19
        MOV     DPTR,#gapRole_MaxConnInterval
        CLR     C
        MOVX    A,@DPTR
        SUBB    A,R0
        INC     DPTR
        MOVX    A,@DPTR
        SUBB    A,R1
        JC      ??gapRole_ProcessGAPMsg_19
        MOV     DPTR,#gapRole_SlaveLatency
        MOVX    A,@DPTR
        XRL     A,R4
        JNZ     ??gapRole_ProcessGAPMsg_20
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,R5
??gapRole_ProcessGAPMsg_20:
        JNZ     ??gapRole_ProcessGAPMsg_19
        MOV     DPTR,#gapRole_TimeoutMultiplier
        MOVX    A,@DPTR
        XRL     A,?V0 + 2
        JNZ     ??gapRole_ProcessGAPMsg_21
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,?V0 + 3
??gapRole_ProcessGAPMsg_21:
        JZ      ??gapRole_ProcessGAPMsg_18
??gapRole_ProcessGAPMsg_19:
        ; Setup parameters for call to function GAPRole_SendUpdateParam
        MOV     DPTR,#gapRole_TimeoutMultiplier
        LCALL   ?PUSH_XSTACK8_X_TWO
        MOV     DPTR,#gapRole_SlaveLatency
        LCALL   ?PUSH_XSTACK8_X_TWO
        LCALL   ?Subroutine2 & 0xFFFF
??CrossCallReturnLabel_30:
        LCALL   ??GAPRole_SendUpdateParam?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
??gapRole_ProcessGAPMsg_18:
        ; Setup parameters for call to function GAPBondMgr_LinkEst
        MOV     ?V0 + 2,#0x4
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
        LCALL   ?Subroutine17 & 0xFFFF
??CrossCallReturnLabel_48:
        MOV     R2,?V0 + 8
        MOV     R3,?V0 + 9
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??GAPBondMgr_LinkEst?relay
        MOV     A,#0x1
        LCALL   ?DEALLOC_XSTACK8
        LJMP    ??gapRole_ProcessGAPMsg_9 & 0xFFFF
??gapRole_ProcessGAPMsg_16:
        MOV     A,#0x31
        XRL     A,R0
        JZ      $+5
        LJMP    ??gapRole_ProcessGAPMsg_8 & 0xFFFF
        MOV     DPTR,#gapRole_AdvEnabled
        LJMP    ??gapRole_ProcessGAPMsg_14 & 0xFFFF
??gapRole_ProcessGAPMsg_4:
        ; Setup parameters for call to function GAPBondMgr_ProcessGAPMsg
        LCALL   ??GAPBondMgr_ProcessGAPMsg?relay
        ; Setup parameters for call to function osal_memset
        MOV     R4,#0x6
        MOV     R5,#0x0
        MOV     R1,#0x0
        MOV     R2,#gapRole_ConnectedDevAddr & 0xff
        MOV     R3,#(gapRole_ConnectedDevAddr >> 8) & 0xff
        LCALL   ??osal_memset?relay
        MOV     DPTR,#gapRole_ConnInterval
        CLR     A
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    @DPTR,A
        MOV     DPTR,#gapRole_ConnSlaveLatency
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    @DPTR,A
        MOV     DPTR,#gapRole_ConnTimeout
        MOVX    @DPTR,A
        INC     DPTR
        MOVX    @DPTR,A
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,#0x8
        MOV     DPTR,#gapRole_state
        JNZ     ??gapRole_ProcessGAPMsg_22
        MOV     A,#0x4
        SJMP    ??gapRole_ProcessGAPMsg_23
??gapRole_ProcessGAPMsg_22:
        MOV     A,#0x3
??gapRole_ProcessGAPMsg_23:
        MOVX    @DPTR,A
        ; Setup parameters for call to function osal_set_event
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_set_event?relay
        MOV     DPTR,#gapRole_ConnectionHandle
        MOV     A,#-0x1
        MOVX    @DPTR,A
        INC     DPTR
        LJMP    ??gapRole_ProcessGAPMsg_12 & 0xFFFF
??gapRole_ProcessGAPMsg_5:
        MOVX    A,@DPTR
        JNZ     ??gapRole_ProcessGAPMsg_24
        MOV     A,R2
        ADD     A,#0x6
        MOV     R0,A
        MOV     A,R3
        ADDC    A,#0x0
        MOV     R1,A
        MOV     ?V0 + 0,R0
        MOV     ?V0 + 1,R1
        MOV     DPL,R0
        MOV     DPH,A
        LCALL   ??Subroutine22_0 & 0xFFFF
??CrossCallReturnLabel_53:
        MOV     DPTR,#gapRole_MinConnInterval
        LCALL   ??Subroutine20_0 & 0xFFFF
??CrossCallReturnLabel_37:
        CLR     C
        MOV     A,R2
        SUBB    A,R0
        MOV     A,R3
        SUBB    A,R1
        JC      ??gapRole_ProcessGAPMsg_24
        MOV     DPTR,#gapRole_MaxConnInterval
        CLR     C
        MOVX    A,@DPTR
        SUBB    A,R2
        INC     DPTR
        MOVX    A,@DPTR
        SUBB    A,R3
        JC      ??gapRole_ProcessGAPMsg_24
        MOV     DPL,R6
        MOV     DPH,R7
        LCALL   ?Subroutine7 & 0xFFFF
??CrossCallReturnLabel_10:
        JNZ     ??gapRole_ProcessGAPMsg_25
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,R1
??gapRole_ProcessGAPMsg_25:
        JZ      ??gapRole_ProcessGAPMsg_26
??gapRole_ProcessGAPMsg_24:
        MOV     DPTR,#ParamUpdateNoSuccessOption
        MOVX    A,@DPTR
        DEC     A
        JZ      ??gapRole_ProcessGAPMsg_27
        DEC     A
        JZ      ??gapRole_ProcessGAPMsg_28
        LJMP    ??gapRole_ProcessGAPMsg_6 & 0xFFFF
??gapRole_ProcessGAPMsg_27:
        ; Setup parameters for call to function GAPRole_SendUpdateParam
        MOV     DPTR,#gapRole_TimeoutMultiplier
        LCALL   ?PUSH_XSTACK8_X_TWO
        MOV     DPTR,#gapRole_SlaveLatency
        LCALL   ?PUSH_XSTACK8_X_TWO
        MOV     R1,#0x1
        LCALL   ??Subroutine19_0 & 0xFFFF
??CrossCallReturnLabel_28:
        LCALL   ??GAPRole_SendUpdateParam?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
        LJMP    ??gapRole_ProcessGAPMsg_6 & 0xFFFF
??gapRole_ProcessGAPMsg_28:
        ; Setup parameters for call to function GAPRole_TerminateConnection
        LCALL   ??GAPRole_TerminateConnection?relay
        LJMP    ??gapRole_ProcessGAPMsg_6 & 0xFFFF
??gapRole_ProcessGAPMsg_26:
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x4
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        LCALL   ?Subroutine6 & 0xFFFF
??CrossCallReturnLabel_8:
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        LCALL   ??Subroutine20_0 & 0xFFFF
??CrossCallReturnLabel_38:
        MOV     DPTR,#gapRole_ConnSlaveLatency
        LCALL   ?Subroutine13 & 0xFFFF
??CrossCallReturnLabel_19:
        LCALL   ?Subroutine8 & 0xFFFF
??CrossCallReturnLabel_45:
        MOV     DPTR,#gapRole_ConnTimeout
        LCALL   ?Subroutine13 & 0xFFFF
??CrossCallReturnLabel_20:
        LJMP    ??gapRole_ProcessGAPMsg_6 & 0xFFFF

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine17:
        MOV     DPL,R6
        MOV     DPH,R7
        REQUIRE ??Subroutine21_0
        ; // Fall through to label ??Subroutine21_0

        RSEG BANKED_CODE:CODE:NOROOT(0)
??Subroutine21_0:
        MOVX    A,@DPTR
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R5,A
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine13:
        MOV     A,R0
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R1
        MOVX    @DPTR,A
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine11:
        MOV     DPTR,#gapRole_ConnectionHandle
        REQUIRE ??Subroutine22_0
        ; // Fall through to label ??Subroutine22_0

        RSEG BANKED_CODE:CODE:NOROOT(0)
??Subroutine22_0:
        LCALL   ?Subroutine18 & 0xFFFF
??CrossCallReturnLabel_60:
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine18:
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine7:
        LCALL   ?Subroutine16 & 0xFFFF
??CrossCallReturnLabel_68:
        MOV     DPTR,#gapRole_TimeoutMultiplier
        MOVX    A,@DPTR
        XRL     A,R0
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine6:
        LCALL   ?Subroutine16 & 0xFFFF
??CrossCallReturnLabel_67:
        MOV     DPTR,#gapRole_ConnInterval
        MOV     A,R0
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R1
        MOVX    @DPTR,A
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine5:
        MOVX    A,@DPTR
        MOV     ?V0 + 0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
        CLR     A
        MOV     ?V0 + 2,A
        MOV     ?V0 + 3,A
        MOV     R0,#?V0 + 0
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine4:
        MOV     DPTR,#gapRole_RSSIReadRate
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        CLR     A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 4
        RET

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine1:
        MOV     DPTR,#pGapRoles_AppCGs
        REQUIRE ??Subroutine23_0
        ; // Fall through to label ??Subroutine23_0

        RSEG BANKED_CODE:CODE:NOROOT(0)
??Subroutine23_0:
        LCALL   ?Subroutine16 & 0xFFFF
??CrossCallReturnLabel_70:
        MOV     A,R0
        ORL     A,R1
        RET
// 1086 
// 1087 /*********************************************************************
// 1088  * @fn      gapRole_SetupGAP
// 1089  *
// 1090  * @brief   Call the GAP Device Initialization function using the
// 1091  *          Profile Parameters.
// 1092  *
// 1093  * @param   none
// 1094  *
// 1095  * @return  none
// 1096  */
// 1097 static void gapRole_SetupGAP( void )
// 1098 {
// 1099   VOID GAP_DeviceInit( gapRole_TaskID,
// 1100           gapRole_profileRole, 0,
// 1101           gapRole_IRK, gapRole_SRK,
// 1102           &gapRole_signCounter );
// 1103 }
// 1104 
// 1105 /********************************************************************
// 1106  * @fn          GAPRole_SendUpdateParam
// 1107  *
// 1108  * @brief       Update the parameters of an existing connection
// 1109  *
// 1110  * @param       minConnInterval - the new min connection interval
// 1111  * @param       maxConnInterval - the new max connection interval
// 1112  * @param       latency - the new slave latency
// 1113  * @param       connTimeout - the new timeout value
// 1114  * @param       handleFailure - what to do if the update does not occur.
// 1115  *              Method may choose to terminate connection, try again, or take no action
// 1116  *
// 1117  * @return      SUCCESS, bleNotConnected, or bleInvalidRange
// 1118  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1119 bStatus_t GAPRole_SendUpdateParam( uint16 minConnInterval, uint16 maxConnInterval,
GAPRole_SendUpdateParam:
        CODE
// 1120                                    uint16 latency, uint16 connTimeout, uint8 handleFailure )
// 1121 {
        MOV     A,#-0x14
        LCALL   ?BANKED_ENTER_XDATA
        ; Saved register size: 20
        ; Auto size: 8
        MOV     A,#-0x8
        LCALL   ?ALLOC_XSTACK8
// 1122   // If there is no existing connection no update need be sent
// 1123   if ( gapRole_state != GAPROLE_CONNECTED )
        MOV     DPTR,#gapRole_state
        MOVX    A,@DPTR
        XRL     A,#0x5
        JZ      ??GAPRole_SendUpdateParam_0
// 1124   {
// 1125     return ( bleNotConnected );
        MOV     R1,#0x14
        LJMP    ??GAPRole_SendUpdateParam_1 & 0xFFFF
// 1126   }
// 1127 
// 1128   ParamUpdateNoSuccessOption = handleFailure;
??GAPRole_SendUpdateParam_0:
        MOV     A,R1
        MOV     DPTR,#ParamUpdateNoSuccessOption
        MOVX    @DPTR,A
// 1129 
// 1130   l2capParamUpdateReq_t updateReq;  // Space for Conn Update parameters
// 1131   uint32 timeout;                   // Calculated response timeout
// 1132 
// 1133   // Calculate the current interval
// 1134   uint16 effectiveOldInterval = (gapRole_ConnInterval * (gapRole_ConnSlaveLatency + 1));
        MOV     DPTR,#gapRole_ConnInterval
        MOVX    A,@DPTR
        MOV     R6,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R7,A
        MOV     DPTR,#gapRole_ConnSlaveLatency
        MOVX    A,@DPTR
        ADD     A,#0x1
        MOV     ?V0 + 0,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     ?V0 + 1,A
        MOV     A,R6
        MOV     B,?V0 + 0
        MUL     AB
        XCH     A,R6
        MOV     R0,B
        MOV     B,?V0 + 1
        MUL     AB
        ADD     A,R0
        MOV     R0,A
        MOV     B,?V0 + 0
        MOV     A,R7
        MUL     AB
        ADD     A,R0
        MOV     R7,A
        MOV     A,#0x1c
        LCALL   ?XSTACK_DISP0_8
        LCALL   ??Subroutine20_0 & 0xFFFF
// 1135 
// 1136   // Calculate the interval we want
// 1137   uint16 effectiveNewMaxInterval = (maxConnInterval * (latency + 1));
??CrossCallReturnLabel_39:
        MOV     ?V0 + 0,R4
        MOV     A,R0
        ADD     A,#0x1
        MOV     ?V0 + 4,A
        MOV     A,R1
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     A,R4
        MOV     B,?V0 + 4
        MUL     AB
        XCH     A,?V0 + 0
        MOV     ?V0 + 3,B
        MOV     B,?V0 + 5
        MUL     AB
        ADD     A,?V0 + 3
        MOV     ?V0 + 3,A
        MOV     B,?V0 + 4
        MOV     A,R5
        MUL     AB
        ADD     A,?V0 + 3
        MOV     ?V0 + 1,A
// 1138 
// 1139   // Check that all parameters are in range before sending request
// 1140   if ( ( minConnInterval >= DEFAULT_MIN_CONN_INTERVAL ) &&
// 1141        ( minConnInterval < DEFAULT_MAX_CONN_INTERVAL  ) &&
// 1142        ( maxConnInterval >= DEFAULT_MIN_CONN_INTERVAL ) &&
// 1143        ( maxConnInterval < DEFAULT_MAX_CONN_INTERVAL  ) &&
// 1144        ( latency         < MAX_SLAVE_LATENCY          ) &&
// 1145        ( connTimeout     >= MIN_TIMEOUT_MULTIPLIER    ) &&
// 1146        ( connTimeout     < MAX_TIMEOUT_MULTIPLIER     ) )
        MOV     A,R2
        ADD     A,#-0x6
        MOV     ?V0 + 4,A
        MOV     A,R3
        LCALL   ?Subroutine15 & 0xFFFF
??CrossCallReturnLabel_26:
        JC      $+5
        LJMP    ??GAPRole_SendUpdateParam_2 & 0xFFFF
        MOV     A,R4
        ADD     A,#-0x6
        MOV     ?V0 + 4,A
        MOV     A,R5
        LCALL   ?Subroutine15 & 0xFFFF
??CrossCallReturnLabel_27:
        JC      $+5
        LJMP    ??GAPRole_SendUpdateParam_2 & 0xFFFF
        CLR     C
        MOV     A,R0
        SUBB    A,#-0xc
        MOV     A,R1
        SUBB    A,#0x1
        JC      $+5
        LJMP    ??GAPRole_SendUpdateParam_2 & 0xFFFF
        MOV     A,#0x1e
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 6,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 7,A
        MOV     A,?V0 + 6
        ADD     A,#-0xa
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 7
        ADDC    A,#-0x1
        MOV     ?V0 + 5,A
        CLR     C
        MOV     A,?V0 + 4
        SUBB    A,#0x76
        MOV     A,?V0 + 5
        SUBB    A,#0xc
        JNC     ??GAPRole_SendUpdateParam_2
// 1147   {
// 1148     updateReq.intervalMin = gapRole_MinConnInterval = minConnInterval;
        MOV     DPTR,#gapRole_MinConnInterval
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
        MOVX    @DPTR,A
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
        MOVX    @DPTR,A
// 1149     updateReq.intervalMax = gapRole_MaxConnInterval = maxConnInterval;
        MOV     DPTR,#gapRole_MaxConnInterval
        MOV     A,R4
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R5
        MOVX    @DPTR,A
        MOV     DPTR,#gapRole_MaxConnInterval
        LCALL   ??Subroutine22_0 & 0xFFFF
??CrossCallReturnLabel_54:
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
        MOVX    @DPTR,A
// 1150     updateReq.slaveLatency = gapRole_SlaveLatency = latency;
        MOV     DPTR,#gapRole_SlaveLatency
        LCALL   ?Subroutine13 & 0xFFFF
??CrossCallReturnLabel_21:
        MOV     A,#0x4
        LCALL   ?XSTACK_DISP0_8
        LCALL   ?Subroutine13 & 0xFFFF
// 1151     updateReq.timeoutMultiplier = gapRole_TimeoutMultiplier = connTimeout;
??CrossCallReturnLabel_22:
        MOV     DPTR,#gapRole_TimeoutMultiplier
        MOV     A,?V0 + 6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,?V0 + 7
        MOVX    @DPTR,A
        MOV     DPTR,#gapRole_TimeoutMultiplier
        LCALL   ??Subroutine20_0 & 0xFFFF
// 1152   }
??CrossCallReturnLabel_40:
        MOV     A,#0x6
        LCALL   ?XSTACK_DISP0_8
        LCALL   ?Subroutine13 & 0xFFFF
// 1153   else
// 1154   {
// 1155     return ( bleInvalidRange );
// 1156   }
// 1157 
// 1158   VOID L2CAP_ConnParamUpdateReq( gapRole_ConnectionHandle, &updateReq, gapRole_TaskID );
??CrossCallReturnLabel_23:
        ; Setup parameters for call to function L2CAP_ConnParamUpdateReq
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R4,DPL
        MOV     R5,DPH
        LCALL   ?Subroutine11 & 0xFFFF
??CrossCallReturnLabel_56:
        LCALL   ??L2CAP_ConnParamUpdateReq?relay
// 1159 
// 1160   // Set up the timeout for expected response
// 1161   if ( effectiveOldInterval > effectiveNewMaxInterval )
        CLR     C
        MOV     A,?V0 + 0
        SUBB    A,R6
        MOV     A,?V0 + 1
        SUBB    A,R7
        JNC     ??GAPRole_SendUpdateParam_3
// 1162   {
// 1163     timeout = (uint32)(effectiveOldInterval) * CONN_INTERVAL_MULTIPLIER;
        MOV     ?V0 + 4,R6
        MOV     ?V0 + 5,R7
        SJMP    ??GAPRole_SendUpdateParam_4
// 1164   }
??GAPRole_SendUpdateParam_2:
        MOV     R1,#0x18
        SJMP    ??GAPRole_SendUpdateParam_1
// 1165   else
// 1166   {
// 1167     timeout = (uint32)(effectiveNewMaxInterval) * CONN_INTERVAL_MULTIPLIER;
??GAPRole_SendUpdateParam_3:
        MOV     ?V0 + 4,?V0 + 0
        MOV     ?V0 + 5,?V0 + 1
??GAPRole_SendUpdateParam_4:
        CLR     A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     DPTR,#__Constant_6
        MOV     R0,#?V0 + 8
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 4
        MOV     R1,#?V0 + 8
        LCALL   ?L_MUL
// 1168   }
// 1169 
// 1170   if ( timeout > MAX_TIMEOUT_VALUE )
        MOV     DPTR,#__Constant_10000
        MOV     R0,#?V0 + 4
        LCALL   ?UL_GE_X
        JNC     ??GAPRole_SendUpdateParam_5
// 1171   {
// 1172     timeout = MAX_TIMEOUT_VALUE;
        MOV     ?V0 + 4,#-0x1
        MOV     ?V0 + 5,#-0x1
// 1173   }
// 1174 
// 1175   //start param update timeout timer
// 1176   VOID osal_start_timerEx( gapRole_TaskID, UPDATE_PARAMS_TIMEOUT_EVT, (uint16)(timeout) );
??GAPRole_SendUpdateParam_5:
        ; Setup parameters for call to function osal_start_timerEx
        CLR     A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_FOUR
        MOV     R2,#0x4
        MOV     R3,#0x0
        MOV     DPTR,#gapRole_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_timerEx?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
// 1177 
// 1178   return ( SUCCESS );
        MOV     R1,#0x0
??GAPRole_SendUpdateParam_1:
        MOV     A,#0x8
        LCALL   ?DEALLOC_XSTACK8
        MOV     R7,#0xc
        LJMP    ?BANKED_LEAVE_XDATA
// 1179 }

        RSEG BANKED_CODE:CODE:NOROOT(0)
?Subroutine15:
        ADDC    A,#-0x1
        MOV     ?V0 + 5,A
        CLR     C
        MOV     A,?V0 + 4
        SUBB    A,#0x7a
        MOV     A,?V0 + 5
        SUBB    A,#0xc
        RET

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for gapRole_AdvEnabled>`:
        DATA8
        DB 1

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for gapRole_AdvertOffTime>`:
        DATA16
        DW 30000

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for gapRole_AdvertDataLen>`:
        DATA8
        DB 3

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for gapRole_AdvertData>`:
        DATA8
        DB 2
        DB 1
        DB 6
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0
        DB 0

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for gapRole_ConnectionHandle>`:
        DATA16
        DW 65535

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for gapRole_MinConnInterval>`:
        DATA16
        DW 6

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for gapRole_MaxConnInterval>`:
        DATA16
        DW 3200

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for gapRole_TimeoutMultiplier>`:
        DATA16
        DW 1000

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_6:
        DD 6

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_10000:
        DD 65536

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??GAPRole_SetParameter?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    GAPRole_SetParameter

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??GAPRole_GetParameter?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    GAPRole_GetParameter

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??GAPRole_StartDevice?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    GAPRole_StartDevice

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??GAPRole_TerminateConnection?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    GAPRole_TerminateConnection

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??GAPRole_Init?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    GAPRole_Init

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??GAPRole_ProcessEvent?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    GAPRole_ProcessEvent

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??gapRole_ProcessGAPMsg?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    gapRole_ProcessGAPMsg

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??GAPRole_SendUpdateParam?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    GAPRole_SendUpdateParam

        END
// 1180 
// 1181 /*********************************************************************
// 1182 *********************************************************************/
// 
// 3 467 bytes in segment BANKED_CODE
//    48 bytes in segment BANK_RELAYS
//    43 bytes in segment XDATA_I
//    43 bytes in segment XDATA_ID
//     8 bytes in segment XDATA_ROM_C
//   107 bytes in segment XDATA_Z
// 
// 3 558 bytes of CODE  memory
//     0 bytes of CONST memory (+ 8 bytes shared)
//   150 bytes of XDATA memory
//
//Errors: none
//Warnings: none
